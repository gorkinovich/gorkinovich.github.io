<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commodore 64</title>
  <link rel="stylesheet" href="style.css" />
  <script type="text/javascript" src="util.js"></script>
  <script>LoadTableOfContents([{url:'C64bas.html',name:'Lenguaje BASIC V2'},{url:'C64mm.html',name:'Mapa de memoria'}]);</script>

  <meta name="author" content="Gorka Suárez García" lang="es">
  <meta name="copyright" content="© 2021-2023 Gorka Suárez García" lang="es">
  <meta name="description" content="Commodore 64: Apuntes de programación" lang="es">
  <meta name="keywords" content="C64,commodore 64,programación,videojuegos,juegos,manuales" lang="es">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@gorkinovich">
  <meta name="twitter:creator" content="@gorkinovich">
  <meta name="twitter:title" content="Commodore 64: Apuntes de programación">
  <meta name="twitter:description" content="Apuntes de programación en ensamblador del Commodore 64.">
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div id="TableOfContents" class="stackedit__toc">
      
<ul>
<li><a href="#commodore-64">Commodore 64</a>
<ul>
<li><a href="#especificaciones">Especificaciones</a></li>
<li><a href="#herramientas">Herramientas</a></li>
<li><a href="#lenguaje-ensamblador">Lenguaje ensamblador</a></li>
<li><a href="#memoria">Memoria</a></li>
<li><a href="#interfaz-gráfica">Interfaz gráfica</a></li>
<li><a href="#interfaz-sonora">Interfaz sonora</a></li>
<li><a href="#entrada-y-salida">Entrada y salida</a></li>
<li><a href="#kernal">KERNAL</a></li>
</ul>
</li>
<!-- <li><a href="C64bas.html">Lenguaje BASIC V2</a></li> -->
<!-- <li><a href="C64mm.html">Mapa de memoria</a></li> -->
<!-- <li><a href="index.html">Volver</a></li> -->
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="commodore-64">Commodore 64</h1>
<p>El Commodore 64 fue una computadora de 8 bits lanzada en 1982 que gozó de gran popularidad. Este manual busca ser una referencia básica para poder programar juegos para esta máquina. Para ello el manual está dividido en tres documentos, empezando por el presente que contiene los aspectos de bajo nivel y del lenguaje ensamblador, seguido de un manual del <a href="https://gorkinovich.github.io/learn/C64bas.html">lenguaje BASIC V2</a> y por último un <a href="https://gorkinovich.github.io/learn/C64mm.html">mapa de la memoria</a> del C64.</p>
<h2 id="especificaciones">Especificaciones</h2>

<table>
<thead>
<tr>
<th align="center">Elemento</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">CPU</td>
<td>MOS Technology 6510 <br> - PAL: 0,9852486 MHz <br> - NTSC: 1,0227273 MHz</td>
</tr>
<tr>
<td align="center">RAM</td>
<td>64 KB</td>
</tr>
<tr>
<td align="center">ROM</td>
<td>20 KB dividido en 3 chips <br> - 8 KB BASIC V2 ($A000-$BFFF) <br> - 8 KB KERNAL ($E000-$FFFF) <br> - 4 KB FONTS ($D000-$DFFF)</td>
</tr>
<tr>
<td align="center">Gráficos</td>
<td>VIC-II (MOS 6567/6569) <br> - Resolución: 320x200 <br> - Colores: 16 <br> - Sprites: 8 de 24x21 (2 colores) o 12x21 (4 colores) <br> - Interrupciones del rasterizado</td>
</tr>
<tr>
<td align="center">Sonido</td>
<td>SID (MOS 6581) <br> - 3x Osciladores (8 octavas, 16-4.000 Hz) <br> - 4x Formas de onda (sierra, triángulo, cuadrada y ruido) <br> - Filtros: paso-bajo (LPF), paso-alto (HPF) y paso-banda (BPF) <br> - Envolvente (ADSR) <br> - Modulación por anillo (Ring Modulation)</td>
</tr>
<tr>
<td align="center">E/S</td>
<td>- 2x CIA 6526 (joystick, teclado, RS-232, GPIO) <br> - Bus en serie IEEE 488 (disqueteras e impresoras) <br> - Cintas de casete (datasette) <br> - Cartuchos de ROM</td>
</tr>
<tr>
<td align="center">Disco</td>
<td>Commodore 1541 (5¼ SS-SD, 170 KB) <br> - Formato: GCR <br> - Máximo de ficheros: 144 <br> - Sectores en total: 683 (664 libres) <br> - Tamaño de sector: 256 bytes <br> - Tamaño total: 174.848 bytes <br> - Tamaño libre: 168.656 bytes (254 bytes/sector) <br> - Velocidad: 300-400 B/s (C64 DOS)</td>
</tr>
</tbody>
</table><p>Para más información consulta la Wikipedia <a href="https://en.wikipedia.org/wiki/Commodore_64">inglesa</a> o la <a href="https://es.wikipedia.org/wiki/Commodore_64">española</a>. También existe una <a href="https://www.c64-wiki.com/wiki/Main_Page">Wiki</a> dedicada al C64 en inglés, donde poder consultar información sobre programar en la plataforma.</p>
<h2 id="herramientas">Herramientas</h2>
<ul>
<li><a href="https://vice-emu.sourceforge.io">VICE</a>: Emulador del C64 para PC.</li>
<li><a href="http://www.ccs64.com">CCS64</a>: Emulador alternativo del C64 para PC.</li>
<li><a href="https://www.ajordison.co.uk">CBM prg Studio</a>: Entorno de desarrollo para C64 (BASIC y ensamblador).</li>
<li><a href="https://cc65.github.io">CC65</a> (<a href="https://github.com/cc65/cc65">GitHub</a>): Compilador de C para C64.</li>
<li><a href="https://theyamo.kapsi.fi/ccutter/">CheeseCutter</a> (<a href="https://github.com/theyamo/CheeseCutter">GitHub</a>): Editor de música SID para C64.</li>
<li><a href="https://cadaver.github.io/tools.html">GoatTracker 2</a> (<a href="https://sourceforge.net/projects/goattracker2/">SourceForge</a>): Editor de música SID para C64.</li>
<li><a href="http://multipaint.kameli.net">Multipaint</a>: Programa para dibujar usando los modos gráficos del C64.</li>
<li><a href="https://subchristsoftware.itch.io/charpad-free-edition">CharPad</a>: Editor de mapas para el C64.</li>
<li><a href="https://csdb.dk/release/?id=132081">SpritePad</a>: Editor de sprites para el C64.</li>
<li><a href="https://www.spritemate.com/">SpriteMate</a>: Editor de sprites online para el C64.</li>
</ul>
<p>El emulador VICE tiene varias configuraciones para el teclado: modo simbólico y modo posicional. Para esta documentación asumimos que se está usando el modo simbólico.</p>
<h3 id="comandos-útiles-para-trabajar">Comandos útiles para trabajar</h3>
<p>Si queremos compilar un programa con el CC65 usaremos:</p>
<pre><code>cl65.exe -O -o game.prg -t c64 main.c
</code></pre>
<p>Para ejecutar luego el programa con VICE usaremos:</p>
<pre><code>x64sc.exe game.prg
</code></pre>
<p>Si queremos generar un disquete virtual usaremos:</p>
<pre><code>c1541 -format game,42 d64 GAME.D64 -attach GAME.D64 -write game.prg game
</code></pre>
<h2 id="lenguaje-ensamblador">Lenguaje ensamblador</h2>
<p>Las máquinas de 8 bits no son especialmente potentes, por ello es recomendable usar código máquina para desarrollar juegos, en lugar de usar BASIC. Esto implica una mayor dificultad y no disponer de algunas comodidades que sí tiene BASIC, como es el cálculo flotante u operadores de enteros de 16 bits, entre otros. Sin embargo, el aumento de velocidad, a la hora de ejecutar una misma aplicación escrita en BASIC o en ensamblador, es superlativo.</p>
<blockquote>
<p><strong>NOTA:</strong> Hay una diferencia entre lenguaje máquina y lenguaje ensamblador. El lenguaje máquina o código máquina, es una secuencia de bytes que la CPU puede interpretar. Mientras que el lenguaje ensamblador requiere ser compilado a código máquina, porque son cadenas de texto con las que un humano puede trabajar para programar.</p>
</blockquote>
<h3 id="hola-mundo">Hola mundo</h3>
<p>Para entender, por qué decimos que programar en ensamblador conlleva una mayor dificultad, veamos el “hola mundo” como ejemplo:</p>
<pre><code>*=$0801 ; 10 SYS2064
        BYTE $0B,$08,$0A,$00,$9E,$32,$30,$36,$34,$00,$00,$00

*=$0810
main    jsr $E544 ; KERNAL: Limpiar terminal
        ldx #$00
@loop   lda Message,x
        beq @end
        jsr $E716 ; KERNAL: Poner carácter
        inx
        jmp @loop
@end    rts

Message  TEXT "hola mundo"
         BYTE 13,0
</code></pre>
<p>Primero, para poner un <strong>comentario</strong> se utiliza el punto y coma (<code>;</code>). Segundo, el compilador de ensamblador dispone de una serie de <strong>directivas</strong>, que permiten configurar diversos parámetros. En el ejemplo se usa la directiva <code>*=</code>, seguida de una dirección de memoria, que permite al programador definir la ubicación del código en la memoria.</p>
<p>Las dos primeras líneas son una directiva con un comentario. La dirección inicial es la <code>$0801</code>, que es la primera posición de memoria donde puede iniciarse un programa BASIC. A continuación, vemos un comentario que dice <code>10 SYS2064</code>, que sería el programa BASIC que necesitamos para invocar nuestro programa máquina. Pero en lugar de escribirlo a mano, para ejecutar la aplicación, vemos que en la segunda línea hay una serie de bytes escritos en <a href="https://es.wikipedia.org/wiki/Sistema_hexadecimal">hexadecimal</a>, que da la casualidad que es la codificación del programa BASIC del comentario anterior. De este modo, al cargar el programa e introducir el comando <code>RUN</code>, se ejecutará la instrucción <code>SYS</code> y por lo tanto nuestra aplicación.</p>
<p>El siguiente bloque empieza ubicando el programa en la dirección <code>$0810</code> (<code>2064</code>). Cada línea del programa puede empezar por una etiqueta identificadora (<code>main</code>, <code>@loop</code>, <code>@end</code> o <code>Message</code>), seguido de una <a href="http://6502.org/tutorials/6502opcodes.html">instrucción</a> o una definición de datos. La primera instrucción llama a una subrutina del KERNAL para limpiar la pantalla. Después se inicializa a cero el registro X de la CPU, para iniciar un bucle donde se carga de forma indexada valores almacenados a partir de la dirección que representa <code>Message</code>. Es decir, toda etiqueta identificadora lo que representa es una dirección de memoria. Si el valor es un cero, se activará un <em>flag</em> dentro del registro de <em>flags</em> de la CPU, y podemos saltar a <code>@end</code> con la instrucción <code>beq</code>. Si no se realiza el salto, se invoca otra subrutina del KERNAL para pintar en pantalla un carácter. Por último, se incrementa el valor del registro X y se vuelve al principio del bucle. Cuando termina el bucle, con <code>rts</code> volveremos al programa BASIC.</p>
<p>El bloque final, define una cadena de texto en la posición <code>Message</code>. Salvando las distancias, esto sería como declarar una variable de programa en una región de la memoria. Después de la cadena tenemos dos bytes, el primero para realizar el salto de línea en la pantalla y el último un cero para finalizar la cadena.</p>
<blockquote>
<p><strong>NOTA:</strong> Para simplificar los ejemplos siguientes, se va a asumir que el inicio del fichero va a ser siempre el mismo cargador de BASIC del hola mundo y que el programa máquina se inicia en la dirección <code>$0810</code>.</p>
</blockquote>
<h3 id="codificación-numérica">Codificación numérica</h3>
<p>Para una computadora todo son ceros y unos, pero es el programa que se está ejecutando el que da una semántica concreta a los valores con los que se están trabajando. Esto permite que podamos representar números, letras y otros tipos de información. Pero para lograrlo hace falta establecer una codificación binaria para representar dichos valores.</p>
<p>La forma natural que tenemos para trabajar con números es el <a href="https://es.wikipedia.org/wiki/Sistema_de_numeraci%C3%B3n_decimal">sistema decimal</a>, un <a href="https://es.wikipedia.org/wiki/Notaci%C3%B3n_posicional">sistema de numeración</a> que utiliza como base el 10 para descomponer los números en relación a su posición:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>123</mn><mo>=</mo><mn>1</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup><mo>+</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>1</mn></msup><mo>+</mo><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">
123 = 1 \times 10^{2} + 2 \times 10^{1} + 3 \times 10^{0}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">123</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.947438em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.947438em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.864108em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>Mediante el uso de divisiones se puede transformar de una base a otra, pudiendo convertir un número decimal a <a href="https://es.wikipedia.org/wiki/Sistema_binario">binario</a> (base 2), <a href="https://es.wikipedia.org/wiki/Sistema_octal">octal</a> (base 8) o <a href="https://es.wikipedia.org/wiki/Sistema_hexadecimal">hexadecimal</a> (base 16). El uso del sistema octal es menos común que el binario o el hexadecimal, pero es conocido su uso en sistemas operativos de la familia UNIX, por ejemplo.</p>

<table>
<thead>
<tr>
<th align="center">Dec</th>
<th align="center">Bin</th>
<th align="center">Oct</th>
<th align="center">Hex</th>
<th align="center">Dec</th>
<th align="center">Bin</th>
<th align="center">Oct</th>
<th align="center">Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0</strong></td>
<td align="center">0000</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center"><strong>8</strong></td>
<td align="center">1000</td>
<td align="center">10</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center"><strong>1</strong></td>
<td align="center">0001</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center"><strong>9</strong></td>
<td align="center">1001</td>
<td align="center">11</td>
<td align="center">9</td>
</tr>
<tr>
<td align="center"><strong>2</strong></td>
<td align="center">0010</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center"><strong>10</strong></td>
<td align="center">1010</td>
<td align="center">12</td>
<td align="center">A</td>
</tr>
<tr>
<td align="center"><strong>3</strong></td>
<td align="center">0011</td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center"><strong>11</strong></td>
<td align="center">1011</td>
<td align="center">13</td>
<td align="center">B</td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td align="center">0100</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center"><strong>12</strong></td>
<td align="center">1100</td>
<td align="center">14</td>
<td align="center">C</td>
</tr>
<tr>
<td align="center"><strong>5</strong></td>
<td align="center">0101</td>
<td align="center">5</td>
<td align="center">5</td>
<td align="center"><strong>13</strong></td>
<td align="center">1101</td>
<td align="center">15</td>
<td align="center">D</td>
</tr>
<tr>
<td align="center"><strong>6</strong></td>
<td align="center">0110</td>
<td align="center">6</td>
<td align="center">6</td>
<td align="center"><strong>14</strong></td>
<td align="center">1110</td>
<td align="center">16</td>
<td align="center">E</td>
</tr>
<tr>
<td align="center"><strong>7</strong></td>
<td align="center">0111</td>
<td align="center">7</td>
<td align="center">7</td>
<td align="center"><strong>15</strong></td>
<td align="center">1111</td>
<td align="center">17</td>
<td align="center">F</td>
</tr>
</tbody>
</table><p>Como sólo tenemos dígitos para representar del cero al nueve, en bases superiores al 10, utilizamos letras para representar los valores siguientes, de ahí que los números hexadecimales usen el intervalo de letras A-F.</p>
<p>Lo común es que <strong>1 byte</strong> son <strong>8 bits</strong> y se pueden separar en dos <a href="https://es.wikipedia.org/wiki/Nibble"><em><strong>nibbles</strong></em></a>, es decir, en dos mitades de <strong>4 bits</strong>. Se puede representar cada mitad con un solo dígito hexadecimal, para mayor comodidad. Esta división también se utiliza para la codificación <a href="https://es.wikipedia.org/wiki/Decimal_codificado_en_binario">BCD</a>, donde cada mitad puede tomar valores entre 0 y 9, de modo que un byte puede representar valores del 0 al 99. Aunque esto claramente hace que se desperdicie espacio en la memoria, en máquinas antiguas era habitual trabajar de esta forma para facilitar la conversión de número a texto en pantalla.</p>
<p>De momento podemos representar el conjunto de los <a href="https://es.wikipedia.org/wiki/N%C3%BAmero_natural">números naturales</a>, pero para poder utilizar <a href="https://es.wikipedia.org/wiki/N%C3%BAmero_entero">números enteros</a> necesitamos representar valores negativos. De las diferentes aproximaciones que existen, la mejor opción es el <a href="https://es.wikipedia.org/wiki/Complemento_a_dos"><strong>complemento a dos</strong></a>, que consiste en invertir cada bit y sumarle una unidad para obtener el valor negativo. Para que esto funcione necesitamos trabajar con un tamaño fijo de bits, que nos lleva a la siguiente terminología de tamaños:</p>

<table>
<thead>
<tr>
<th align="center">Nombre</th>
<th align="center">Bits</th>
<th align="center">stdint.h</th>
<th align="center">CC65 (8/16 bits)</th>
<th align="center">C/C++ (32/64 bits)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">BYTE</td>
<td align="center">8</td>
<td align="center">int8_t<br>uint8_t</td>
<td align="center">char<br>unsigned char</td>
<td align="center">char<br>unsigned char</td>
</tr>
<tr>
<td align="center">WORD</td>
<td align="center">16</td>
<td align="center">int16_t<br>uint16_t</td>
<td align="center">int<br>unsigned int</td>
<td align="center">short<br>unsigned short</td>
</tr>
<tr>
<td align="center">DWORD</td>
<td align="center">32</td>
<td align="center">int32_t<br>uint32_t</td>
<td align="center">long<br>unsigned long</td>
<td align="center">int<br>unsigned int</td>
</tr>
<tr>
<td align="center">QWORD</td>
<td align="center">64</td>
<td align="center">int64_t<br>uint64_t</td>
<td align="center">-</td>
<td align="center">long long<br>unsigned long long</td>
</tr>
</tbody>
</table><p>En el C64 el ancho del bus de datos es un BYTE, mientras que el ancho de las direcciones de memoria es un WORD. También se usa un WORD como tamaño para los enteros en BASIC, por ejemplo. Teniendo esto en cuenta, los rangos numéricos que podemos representar son:</p>

<table>
<thead>
<tr>
<th align="center">Tamaño</th>
<th align="center">Naturales</th>
<th align="center">Enteros</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">BYTE</td>
<td align="center">0 ⋯ 256</td>
<td align="center">-128 ⋯ 127</td>
</tr>
<tr>
<td align="center">WORD</td>
<td align="center">0 ⋯ 65.535</td>
<td align="center">-32.768 ⋯ 32.767</td>
</tr>
<tr>
<td align="center">DWORD</td>
<td align="center">0 ⋯ 4.294.967.295</td>
<td align="center">-2.147.483.648 ⋯ 2.147.483.647</td>
</tr>
</tbody>
</table><p>Veamos ahora un ejemplo de cómo se codifican los números negativos, con un tamaño de 4 bits para limitar la cantidad de datos:</p>

<table>
<thead>
<tr>
<th align="center">Binario</th>
<th align="center">Naturales</th>
<th align="center">Enteros</th>
<th align="center">Binario</th>
<th align="center">Naturales</th>
<th align="center">Enteros</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0000</strong></td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center"><strong>1000</strong></td>
<td align="center">8</td>
<td align="center">-8</td>
</tr>
<tr>
<td align="center"><strong>0001</strong></td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center"><strong>1001</strong></td>
<td align="center">9</td>
<td align="center">-7</td>
</tr>
<tr>
<td align="center"><strong>0010</strong></td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center"><strong>1010</strong></td>
<td align="center">10</td>
<td align="center">-6</td>
</tr>
<tr>
<td align="center"><strong>0011</strong></td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center"><strong>1011</strong></td>
<td align="center">11</td>
<td align="center">-5</td>
</tr>
<tr>
<td align="center"><strong>0100</strong></td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center"><strong>1100</strong></td>
<td align="center">12</td>
<td align="center">-4</td>
</tr>
<tr>
<td align="center"><strong>0101</strong></td>
<td align="center">5</td>
<td align="center">5</td>
<td align="center"><strong>1101</strong></td>
<td align="center">13</td>
<td align="center">-3</td>
</tr>
<tr>
<td align="center"><strong>0110</strong></td>
<td align="center">6</td>
<td align="center">6</td>
<td align="center"><strong>1110</strong></td>
<td align="center">14</td>
<td align="center">-2</td>
</tr>
<tr>
<td align="center"><strong>0111</strong></td>
<td align="center">7</td>
<td align="center">7</td>
<td align="center"><strong>1111</strong></td>
<td align="center">15</td>
<td align="center">-1</td>
</tr>
</tbody>
</table><p>Por ejemplo, si cogemos el número <code>2</code>, en binario <code>0010</code>, y lo pasamos a negativo, primero invertimos los bits a <code>1101</code>, entonces le sumamos <code>1</code> y obtenemos <code>1110</code>. Una ventaja de esta codificación es que podemos usar la suma binaria para sumar números enteros, por ejemplo <code>-2 + 4</code> sería sumar <code>1110</code> y <code>0100</code>, que daría como resultado <code>0010</code> que es <code>2</code>.</p>
<blockquote>
<p><strong>NOTA:</strong> Aunque compiladores como el CC65 nos dejen usar números de 32 bits, es recomendable evitarlo en la medida de lo posible, ya que la CPU sólo dispone de operaciones aritméticas para números de 8 bits, por lo que los cálculos se hacen vía software. También se hace por software las operaciones con números de 16 bits, pero su uso se hace imperativo al querer manipular punteros a la memoria.</p>
</blockquote>
<p>También podemos utilizar codificaciones para representar números reales, como hace BASIC con los números de coma flotante. Pero dada su complejidad, y su coste computacional, no son recomendables para hacer juegos en plataformas de 8 bits.</p>
<h3 id="etiquetas-literales-y-variables">Etiquetas, literales y variables</h3>
<p>Cada ensamblador tiene algunas peculiaridades propias aunque compartan la plataforma de destino. Por ello nos centramos en el que usa el <em>CBM prg Studio</em>, frente al que usa el <em>CC65</em>.</p>
<p>Como se explicó en el <em>hola mundo</em>, una línea de programa puede empezar con una etiqueta identificadora. Las etiquetas lo que hacen es asociar a un nombre identificador una dirección de memoria, para hacer más fácil al programador el utilizar ciertas secciones del programa. Los nombres de las etiquetas se definen como los nombres de variables en C, pero hay un par de modificadores que se pueden incorporar a estos nombres:</p>
<ul>
<li>
<p><strong>Etiqueta global:</strong> Lleva un <code>$</code> al final y es visible en todos los ficheros del proyecto, mientras que una local sólo lo es dentro del fichero donde se declaró.</p>
</li>
<li>
<p><strong>Etiqueta “barata”:</strong> Lleva un <code>@</code> al inicio y hace que sea local al bloque de código actual. Esto hace posible tener una misma etiqueta varias veces en un mismo fichero, siempre que estén separadas por etiquetas normales que definen el inicio de cada bloque de código.</p>
</li>
</ul>
<p>Los valores literales que dispone el lenguaje son:</p>

<table>
<thead>
<tr>
<th align="center">Tipo</th>
<th align="center">Símbolo</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Decimal</td>
<td align="center"></td>
<td><code>65</code></td>
</tr>
<tr>
<td align="center">Hexadecimal</td>
<td align="center"><code>$</code></td>
<td><code>$41</code></td>
</tr>
<tr>
<td align="center">Binario</td>
<td align="center"><code>%</code></td>
<td><code>%01000001</code></td>
</tr>
<tr>
<td align="center">Octal</td>
<td align="center"><code>@</code></td>
<td><code>101</code></td>
</tr>
<tr>
<td align="center">PETSCII</td>
<td align="center"><code>"</code></td>
<td><code>"a"</code></td>
</tr>
<tr>
<td align="center">Cod. Pantalla</td>
<td align="center"><code>'</code></td>
<td><code>'a'</code></td>
</tr>
</tbody>
</table><p>Los cuatro primeros ejemplos son el número <code>65</code> en sus diferentes representaciones de base. Los dos últimos ejemplos son el carácter <code>A</code>, que en códigos <a href="https://sta.c64.org/cbm64pet.html">PETSCII</a> es el <code>65</code> y en códigos de pantalla el <code>1</code>. La codificación <a href="https://en.wikipedia.org/wiki/PETSCII">PETSCII</a> es un equivalente al <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a> que la empresa Commodore tenía para sus máquinas. Las rutinas del <a href="https://sta.c64.org/cbmdocs.html">KERNAL</a> trabajan con esta codificación internamente. Sin embargo, el buffer de pantalla del modo texto trabaja con índices al mapa de caracteres. Por ello, dependiendo de cómo se trabaje, se tiene que decidir usar una codificación o la otra.</p>
<p>Para definir una variable de programa tenemos que usar una etiqueta y una definición de datos, como muestran los siguientes ejemplos:</p>
<pre><code>var1 BYTE 123
var2 WORD 321
var3 TEXT "cadena petscii",0
var4 TEXT 'cadena pantalla',0
</code></pre>
<p>Hay más opciones de tipos de datos en la ayuda del compilador, pero esencialmente estos son los más básicos que disponemos. Para las cadenas de texto, se ha optado por añadir un cero al final como terminación, cosa que permite el compilador.</p>
<p>También se pueden declarar variables para el compilador, que podemos utilizar como valores constantes para evitar los famosos <a href="https://en.wikipedia.org/wiki/Magic_number_%28programming%29">números mágicos</a> al programar:</p>
<pre><code>CLRSCR = $E544

*=$0810
main
        jsr CLRSCR
        rts
</code></pre>
<p>Estas variables permiten usar diferentes operadores para trabajar con ellas y que el compilador calcule su valor final, pero este uso no es tan común. Sin embargo, hay dos operadores muy importantes que podemos utilizar con literales, etiquetas o variables de compilador, que son:</p>
<ul>
<li><code>&gt;</code>: Devuelve el byte alto de un WORD.</li>
<li><code>&lt;</code>: Devuelve el byte bajo de un WORD.</li>
</ul>
<p>Porque recordemos que el ancho de palabra de los datos es de 8 bits, por lo tanto necesitaremos estos operadores para trabajar con aquellas expresiones que den un valor de 16 bits. También existen operadores lógicos (<code>and</code>, <code>or</code>, <code>not</code>, <code>xor</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>) y aritméticos (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>) que se pueden utilizar con diferentes expresiones para que el compilador calcule el valor final. El mecanismo sería similar al de una plantilla en C++, ya que no es código que se ejecuta con el programa, sino que se ejecuta durante la compilación.</p>
<h3 id="macros">Macros</h3>
<p>Se pueden definir macros para unificar aquellas secciones de código que sean duplicados y tener una relativa sensación de modularidad. Para definir una macro hace falta un nombre identificador, de forma similar a las etiquetas, y añadiendo <code>$</code> al final se puede hacer la macro global al proyecto. Por ejemplo:</p>
<pre><code>CLRSCR = $E544 ; KERNAL: Limpiar terminal
PUTCHR = $E716 ; KERNAL: Poner carácter

defm WriteLine
        ldx #$00
@loop   lda /1,x
        beq @end
        jsr PUTCHR
        inx
        jmp @loop
@end    lda #13
        jsr PUTCHR
endm

*=$0810
main
        jsr CLRSCR
        WriteLine STRING1
        WriteLine STRING2
        rts

STRING1 TEXT "1. hola mundo",0
STRING2 TEXT "2. adios mundo",0
</code></pre>
<p>Con las palabras claves <code>defm</code> y <code>endm</code> definimos la macro, poniéndole como nombre <code>WriteLine</code> en el ejemplo. Si queremos poner etiquetas dentro de una macro, estas tendrán que ser etiquetas baratas. Luego con <code>/1</code> se hace referencia al primer parámetro y podemos tener un máximo de 20. Si no se indica un valor para el parámetro, se asume por defecto el valor <code>0</code>. Otro detalle es que no se puede llamar a una macro dentro de otra, lo cual puede dificultad su modularidad con operaciones complejas.</p>
<h3 id="registros-de-la-cpu">Registros de la CPU</h3>
<p>Estos son los registros internos de la CPU:</p>

<table>
<thead>
<tr>
<th align="center">Nombre</th>
<th align="center">Tamaño</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>A</strong></td>
<td align="center">8 bits</td>
<td>Registro acumulador.</td>
</tr>
<tr>
<td align="center"><strong>X</strong></td>
<td align="center">8 bits</td>
<td>Registro X.</td>
</tr>
<tr>
<td align="center"><strong>Y</strong></td>
<td align="center">8 bits</td>
<td>Registro Y.</td>
</tr>
<tr>
<td align="center"><strong>P</strong></td>
<td align="center">8 bits</td>
<td>Registro de estado.</td>
</tr>
<tr>
<td align="center"><strong>S</strong></td>
<td align="center">8 bits</td>
<td>Puntero de la pila.</td>
</tr>
<tr>
<td align="center"><strong>PC</strong></td>
<td align="center">16 bits</td>
<td>Contador de programa.</td>
</tr>
<tr>
<td align="center"><strong>DDR</strong></td>
<td align="center">8 bits</td>
<td>Registro de Dirección de Datos.<br>Accesible en la dirección: <strong>$0000</strong></td>
</tr>
<tr>
<td align="center"><strong>IOP</strong></td>
<td align="center">8 bits</td>
<td>Puerto de Entrada/Salida.<br>Accesible en la dirección: <strong>$0001</strong></td>
</tr>
</tbody>
</table><p>Podemos acceder y manipular los registros <strong>A</strong>, <strong>X</strong> e <strong>Y</strong> directamente  con las instrucciones de la CPU. La mayor parte de las operaciones aritméticas y lógicas se realizan contra el acumulador, que se denomina así ya que se carga un valor y se manipula con un segundo valor extraído de memoria para hacer la operación, guardando el resultado en el registro, sobrescribiendo el valor previo. Los registros X e Y se utilizan para temas auxiliares como algunos de los modos de direccionamiento a la hora de acceder a la memoria.</p>
<p>El <strong>registro de estado</strong> de la CPU sirve para poder consultar si se han producido algunos eventos o para modificar el comportamiento de algunas instrucciones. Estos son los <em>flags</em> que hay en el registro:</p>

<table>
<thead>
<tr>
<th align="center">Bit</th>
<th align="center">Flag</th>
<th align="center">Nombre</th>
<th align="center">0</th>
<th align="center">1</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">C</td>
<td align="center">Acarreo</td>
<td align="center">No</td>
<td align="center">Sí</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">Z</td>
<td align="center">Cero</td>
<td align="center">No es cero</td>
<td align="center">Cero</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">I</td>
<td align="center">IRQ</td>
<td align="center">Activadas</td>
<td align="center">Desactivadas</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">D</td>
<td align="center">Modo BCD</td>
<td align="center">Deshabilitado</td>
<td align="center">Habilitado</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">B</td>
<td align="center">BREAK</td>
<td align="center">Hardware</td>
<td align="center">Software</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">V</td>
<td align="center">Desbordamiento</td>
<td align="center">No</td>
<td align="center">Sí</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">N</td>
<td align="center">Negativo</td>
<td align="center">Positivo</td>
<td align="center">Negativo</td>
</tr>
</tbody>
</table><p>Al ejecutar algunas operaciones se pueden activar los <em>flags</em>:</p>
<ul>
<li><strong>C:</strong> El resultado de una suma ocupa más de 8 bits por un <a href="https://es.wikipedia.org/wiki/Acarreo">acarreo</a>.</li>
<li><strong>V:</strong> El resultado de una operación con signo ha dado un valor fuera del rango de 8 bits.</li>
<li><strong>Z:</strong> El resultado es el cero.</li>
<li><strong>N:</strong> El resultado es negativo.</li>
</ul>
<p>Luego para activar o desactivar las interrupciones de tipo IRQ se usa el <em>flag</em> <strong>I</strong>. Si está activado el <em>flag</em> I y se produce una interrupción, con el <em>flag</em> <strong>B</strong> sabremos si su origen es hardware o software. Por último, el <em>flag</em> <strong>D</strong> activa el modo BCD para las operaciones aritméticas.</p>
<p>El <strong>contador de programa</strong> indica a la CPU la dirección de la siguiente instrucción de programa que ejecutar. Este registro se puede manipular mediante instrucciones de salto durante la ejecución.</p>
<p>El <strong>puntero de la pila</strong> apunta a la primera posición libre dentro de la <strong>pila de programa</strong>, que está en la página de memoria <code>$01</code> y por ello sólo necesitamos 8 bits para indicar el byte bajo de la dirección final. La <a href="https://es.wikipedia.org/wiki/Pila_de_llamadas">pila de programa</a> es un segmento de memoria reservado para guardar información sobre el estado de la ejecución cuando se tiene que llamar a una rutina, para rescatar los valores guardados al terminar la rutina llamada. En el C64 la pila empieza apuntando a la posición <code>$FF</code> y va descendiendo hasta la <code>$00</code>. Además de las instrucciones para invocar una rutina y volver de ella, existen otras que nos permiten manipular la pila.</p>
<p>El registro <strong>DDR</strong> sirve para configurar qué bits son de escritura y/o lectura en el registro <strong>IOP</strong>, que es un registro para configurar el acceso a la memoria y consultar información sobre el <em>datasette</em>.</p>
<h3 id="modos-de-direccionamiento">Modos de direccionamiento</h3>
<p>Los modos de direccionamiento indican cómo se accede a los datos:</p>

<table>
<thead>
<tr>
<th align="center">Modo</th>
<th align="center">Forma</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Implícito</td>
<td align="center"></td>
<td>Con la propia instrucción se deduce dónde están los datos sobre los que se van a operar.</td>
</tr>
<tr>
<td align="center">Acumulador</td>
<td align="center">A</td>
<td>Es una forma de modo implícito que opera sobre el registro acumulador de la CPU.</td>
</tr>
<tr>
<td align="center">Inmediato</td>
<td align="center">#<em>VAL</em></td>
<td>El valor del operando acompaña a la instrucción y tiene un byte de tamaño.</td>
</tr>
<tr>
<td align="center">Absoluto</td>
<td align="center"><em>ABS</em></td>
<td>La instrucción está acompañada por la dirección de memoria sobre la que operar. Primero se encuentra el byte menos significativo (LSB) y después el más significativo (MSB), porque la arquitectura del 6510 es de tipo <a href="https://es.wikipedia.org/wiki/Endianness"><em>Little-Endian</em></a>.</td>
</tr>
<tr>
<td align="center">Indexado</td>
<td align="center"><em>ABS</em>,X<br><em>ABS</em>,Y</td>
<td>Es un modo absoluto que suma a la dirección de memoria el valor del registro X/Y.</td>
</tr>
<tr>
<td align="center">Indirecto</td>
<td align="center">(<em>ABS</em>)</td>
<td>La instrucción está acompañada por la dirección de memoria que contiene un puntero a la dirección final sobre la que operar.</td>
</tr>
<tr>
<td align="center">Página Cero</td>
<td align="center"><em>ZP</em></td>
<td>Es un modo absoluto pero trabajando con la página cero, por ello sólo necesita un byte para la dirección de memoria.</td>
</tr>
<tr>
<td align="center">Indexado Pág. Cero</td>
<td align="center"><em>ZP</em>,X<br><em>ZP</em>,Y</td>
<td>Es un modo absoluto sobre la página cero que suma a la dirección de memoria el valor del registro X/Y.</td>
</tr>
<tr>
<td align="center">Indexado Indirecto</td>
<td align="center">(<em>ZP</em>,X)</td>
<td>Es un modo indirecto al que, antes de obtener la dirección almacenada en el puntero, se le suma el valor del registro X para calcular la dirección del puntero. También se puede entender como una tabla de punteros a valores.</td>
</tr>
<tr>
<td align="center">Indirecto Indexado</td>
<td align="center">(<em>ZP</em>),Y</td>
<td>Es un modo indirecto al que, después de obtener la dirección almacenada en el puntero, se le suma el valor del registro Y para calcular la dirección final. También se puede entender como un puntero a una tabla de valores.</td>
</tr>
<tr>
<td align="center">Relativo</td>
<td align="center"><em>REL</em></td>
<td>La instrucción está acompañada por un valor de desplazamiento relativo a la posición actual de memoria. Como el tamaño de valor es de un byte, sólo se pueden indicar rangos entre <code>-128</code> y <code>127</code>.</td>
</tr>
</tbody>
</table><blockquote>
<p><strong>NOTA:</strong> Con el modo indirecto no se debe usar como dirección el último byte de la página, por ejemplo <code>$C0FF</code>, pues el byte alto de la dirección no lo consultaría en <code>$C100</code>, sino que lo hace en <code>$C000</code>. Esto ocurre porque el acarreo del incremento no es tenido en cuenta.</p>
</blockquote>
<h3 id="instrucciones-de-datos">Instrucciones de datos</h3>
<p>El primer grupo de instrucciones nos permite <strong>mover bytes</strong> entre la <strong>memoria</strong> y los <strong>registros</strong> y viceversa:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">LDA<br>LDX<br>LDY</td>
<td align="center">N Z</td>
<td>Memoria → Registro</td>
<td><code>LDA #$44</code><br><code>LDA $44</code><br><code>LDA $44,X</code><br><code>LDA $4400</code><br><code>LDA $4400,X</code><br><code>LDA $4400,Y</code><br><code>LDA ($44,X)</code><br><code>LDA ($44),Y</code></td>
<td><code>LDX #$44</code><br><code>LDX $44</code><br><code>LDX $44,Y</code><br><code>LDX $4400</code><br><code>LDX $4400,Y</code></td>
<td><code>LDY #$44</code><br><code>LDY $44</code><br><code>LDY $44,X</code><br><code>LDY $4400</code><br><code>LDY $4400,X</code></td>
</tr>
<tr>
<td align="center">STA<br>STX <br>STY</td>
<td align="center">-</td>
<td>Registro → Memoria</td>
<td><code>STA $44</code><br><code>STA $44,X</code><br><code>STA $4400</code><br><code>STA $4400,X</code><br><code>STA $4400,Y</code><br><code>STA ($44,X)</code><br><code>STA ($44),Y</code></td>
<td><code>STX $44</code><br><code>STX $44,Y</code><br><code>STX $4400</code></td>
<td><code>STY $44</code><br><code>STY $44,X</code><br><code>STY $4400</code></td>
</tr>
</tbody>
</table><p>Hay que tener cuidado cuando se realice el indexado a la página cero, porque el acarreo de la suma no afecta al byte más significativo de la dirección de memoria final. El resultado de esta situación es como estar dando “vueltas en círculos”.</p>
<p>También podemos <strong>mover bytes</strong> entre <strong>registros</strong>:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">TAX</td>
<td align="center">N Z</td>
<td>A → X</td>
</tr>
<tr>
<td align="center">TAY</td>
<td align="center">N Z</td>
<td>A → X</td>
</tr>
<tr>
<td align="center">TXA</td>
<td align="center">N Z</td>
<td>X → A</td>
</tr>
<tr>
<td align="center">TYA</td>
<td align="center">N Z</td>
<td>Y → A</td>
</tr>
</tbody>
</table><p>El <strong>registro P</strong> de la CPU, que nos indica el estado de los <em>flags</em>, se puede <strong>modificar</strong> con:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">CLC</td>
<td align="center">C=0</td>
<td>Borra el flag de <em>carry</em>.</td>
</tr>
<tr>
<td align="center">SEC</td>
<td align="center">C=1</td>
<td>Activa el flag de <em>carry</em>.</td>
</tr>
<tr>
<td align="center">CLI</td>
<td align="center">I=0</td>
<td>Desactiva las interrupciones IRQ.</td>
</tr>
<tr>
<td align="center">SEI</td>
<td align="center">I=1</td>
<td>Activa las interrupciones IRQ.</td>
</tr>
<tr>
<td align="center">CLD</td>
<td align="center">D=0</td>
<td>Desactiva el modo BCD.</td>
</tr>
<tr>
<td align="center">SED</td>
<td align="center">D=1</td>
<td>Activa el modo BCD.</td>
</tr>
<tr>
<td align="center">CLV</td>
<td align="center">V=0</td>
<td>Borra el flag de <em>overflow</em>.</td>
</tr>
</tbody>
</table><h3 id="instrucciones-aritméticas">Instrucciones aritméticas</h3>
<p>Este segundo grupo de instrucciones nos permite realizar operaciones matemáticas:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ADC</td>
<td align="center">N V Z C</td>
<td>A += Memoria</td>
<td><code>ADC #$44</code><br><code>ADC $44</code><br><code>ADC $44,X</code><br><code>ADC $4400</code><br><code>ADC $4400,X</code><br><code>ADC $4400,Y</code><br><code>ADC ($44,X)</code><br><code>ADC ($44),Y</code></td>
</tr>
<tr>
<td align="center">SBC</td>
<td align="center">N V Z C</td>
<td>A -= Memoria</td>
<td><code>SBC #$44</code><br><code>SBC $44</code><br><code>SBC $44,X</code><br><code>SBC $4400</code><br><code>SBC $4400,X</code><br><code>SBC $4400,Y</code><br><code>SBC ($44,X)</code><br><code>SBC ($44),Y</code></td>
</tr>
</tbody>
</table><p>Con <code>ADC</code> se realizan las <strong>sumas</strong> y con <code>SBC</code> las <strong>restas</strong> de <strong>8 bits</strong>. Si queremos multiplicaciones y divisiones, o si queremos operaciones con operandos de 16 bits, hay que implementarlas vía software. Dependiendo del estado del <em>flag</em> D, se realizarán las operaciones en modo BCD o no. Hay que tener en cuenta que si el <em>flag</em> de <em>carry</em> está activado, se sumará o restará al valor del acumulador. Esto está pensado para realizar operaciones con operandos de varios bytes de tamaño, por lo tanto hay que borrar el <em>flag</em> de <em>carry</em> cada vez que se quiera iniciar una nueva operación matemática, para evitar la intromisión del acarreo de alguna operación previa.</p>
<blockquote>
<p><strong>NOTA:</strong> El <em>flag</em> de desbordamiento u <em>overflow</em> se utiliza para controlar operaciones de sumas y restas con enteros. Por lo tanto, si estamos sumando dos números y el resultado es superior a <code>127</code>, se se producirá un desbordamiento. También ocurre lo mismo si estamos restando dos números (o sumando dos números negativos) y el resultado es inferior a <code>-128</code>.</p>
</blockquote>
<p>El siguiente bloque de instrucciones sirve para <strong>incrementar</strong> o <strong>decrementar</strong> un <strong>valor</strong> en memoria o un registro:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">INC</td>
<td align="center">N Z</td>
<td>Memoria += 1</td>
<td><code>INC $44</code><br><code>INC $44,X</code><br><code>INC $4400</code><br><code>INC $4400,X</code></td>
</tr>
<tr>
<td align="center">DEC</td>
<td align="center">N Z</td>
<td>Memoria -= 1</td>
<td><code>DEC $44</code><br><code>DEC $44,X</code><br><code>DEC $4400</code><br><code>DEC $4400,X</code></td>
</tr>
<tr>
<td align="center">INX</td>
<td align="center">N Z</td>
<td>X += 1</td>
<td><code>INX</code></td>
</tr>
<tr>
<td align="center">INY</td>
<td align="center">N Z</td>
<td>Y += 1</td>
<td><code>INY</code></td>
</tr>
<tr>
<td align="center">DEX</td>
<td align="center">N Z</td>
<td>X -= 1</td>
<td><code>DEX</code></td>
</tr>
<tr>
<td align="center">DEY</td>
<td align="center">N Z</td>
<td>Y -= 1</td>
<td><code>DEY</code></td>
</tr>
</tbody>
</table><p>Es habitual tener que <strong>comparar valores</strong> entre sí y para ello tenemos:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">CMP</td>
<td align="center">N Z C</td>
<td>A - Memoria</td>
<td><code>CMP #$44</code><br><code>CMP $44</code><br><code>CMP $44,X</code><br><code>CMP $4400</code><br><code>CMP $4400,X</code><br><code>CMP $4400,Y</code><br><code>CMP ($44,X)</code><br><code>CMP ($44),Y</code></td>
</tr>
<tr>
<td align="center">CPX</td>
<td align="center">N Z C</td>
<td>X - Memoria</td>
<td><code>CPX #$44</code><br><code>CPX $44</code><br><code>CPX $4400</code></td>
</tr>
<tr>
<td align="center">CPY</td>
<td align="center">N Z C</td>
<td>Y - Memoria</td>
<td><code>CPY #$44</code><br><code>CPY $44</code><br><code>CPY $4400</code></td>
</tr>
</tbody>
</table><p>Se toma el valor del registro, se le resta el valor obtenido desde la memoria. El resultado modifica el estado de los <em>flags</em> de modo que:</p>

<table>
<thead>
<tr>
<th align="center">Naturales</th>
<th align="center">Z</th>
<th align="center">C</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Reg. = Mem.</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Reg. &lt; Mem.</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">Reg. &gt; Mem.</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table><p>Si el resultado de la resta da un número entre <code>128</code> y <code>255</code>, el <em>flag</em> N se activará, de lo contrario valdrá cero. Esto hace que para comparar números enteros haga falta algunos pasos más, para comparar primero los signos de cada operando y si coinciden ejecutar <code>CMP</code> para comprobar el <em>flag</em> C.</p>
<p>Este bloque de instrucciones nos permite realizar <strong>operaciones lógicas</strong> a nivel de bit:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AND</td>
<td align="center">N Z</td>
<td><a href="https://es.wikipedia.org/wiki/Conjunci%C3%B3n_l%C3%B3gica">Conjunción lógica</a>: A &amp;= Mem</td>
<td><code>AND #$44</code><br><code>AND $44</code><br><code>AND $44,X</code><br><code>AND $4400</code><br><code>AND $4400,X</code><br><code>AND $4400,Y</code><br><code>AND ($44,X)</code><br><code>AND ($44),Y</code></td>
</tr>
<tr>
<td align="center">ORA</td>
<td align="center">N Z</td>
<td><a href="https://es.wikipedia.org/wiki/Disyunci%C3%B3n_l%C3%B3gica">Disyunción lógica</a>: A |= Mem</td>
<td><code>ORA #$44</code><br><code>ORA $44</code><br><code>ORA $44,X</code><br><code>ORA $4400</code><br><code>ORA $4400,X</code><br><code>ORA $4400,Y</code><br><code>ORA ($44,X)</code><br><code>ORA ($44),Y</code></td>
</tr>
<tr>
<td align="center">EOR</td>
<td align="center">N Z</td>
<td><a href="https://es.wikipedia.org/wiki/Disyunci%C3%B3n_exclusiva">Disyunción exclusiva</a>: A ^= Mem</td>
<td><code>EOR #$44</code><br><code>EOR $44</code><br><code>EOR $44,X</code><br><code>EOR $4400</code><br><code>EOR $4400,X</code><br><code>EOR $4400,Y</code><br><code>EOR ($44,X)</code><br><code>EOR ($44),Y</code></td>
</tr>
</tbody>
</table><p>Veamos las <em>tablas de verdad</em> de cada operador lógico para entenderlos mejor:</p>

<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">A and B</th>
<th align="center">A or B</th>
<th align="center">A xor B</th>
<th align="center">A xor 1</th>
<th align="center">B xor 1</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table><p>Como se puede observar, la <a href="https://es.wikipedia.org/wiki/Negaci%C3%B3n_l%C3%B3gica">negación lógica</a> se puede alcanzar mediante el uso del operador <strong>xor</strong>, de modo que tenemos:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi>n</mi><mi>o</mi><mi>t</mi></mrow><mtext>&nbsp;</mtext><mi>A</mi><mo>=</mo><mi>A</mi><mtext>&nbsp;</mtext><mrow><mi>x</mi><mi>o</mi><mi>r</mi></mrow><mtext>&nbsp;</mtext><mn>1</mn></mrow><annotation encoding="application/x-tex">
\mathit{not}\ A = A\ \mathit{xor}\ 1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathit">not</span></span><span class="mspace">&nbsp;</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">A</span><span class="mspace">&nbsp;</span><span class="mord"><span class="mord mathit">xor</span></span><span class="mspace">&nbsp;</span><span class="mord">1</span></span></span></span></span></span></p>
<p>Otras operaciones a nivel de bit son los operadores de <strong>desplazamiento</strong> y <strong>rotación</strong> de <strong>bits</strong>:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ASL</td>
<td align="center">N Z C</td>
<td>Desplazamiento hacia la izquierda:<br>C = B<sub>7</sub>; B<sub>i</sub> = B<sub>i-1</sub>; B<sub>0</sub> = 0</td>
<td><code>ASL A</code><br><code>ASL $44</code><br><code>ASL $44,X</code><br><code>ASL $4400</code><br><code>ASL $4400,X</code></td>
</tr>
<tr>
<td align="center">LSR</td>
<td align="center">N=0 Z C</td>
<td>Desplazamiento hacia la derecha:<br>C = B<sub>0</sub>; B<sub>i</sub> = B<sub>i+1</sub>; B<sub>7</sub> = 0</td>
<td><code>LSR A</code><br><code>LSR $44</code><br><code>LSR $44,X</code><br><code>LSR $4400</code><br><code>LSR $4400,X</code></td>
</tr>
<tr>
<td align="center">ROL</td>
<td align="center">N Z C</td>
<td>Rotación hacia la izquierda:<br>C = B<sub>7</sub>; B<sub>i</sub> = B<sub>i-1</sub>; B<sub>0</sub> = C</td>
<td><code>ROL A</code><br><code>ROL $44</code><br><code>ROL $44,X</code><br><code>ROL $4400</code><br><code>ROL $4400,X</code></td>
</tr>
<tr>
<td align="center">ROR</td>
<td align="center">N Z C</td>
<td>Rotación hacia la derecha:<br>C = B<sub>0</sub>; B<sub>i</sub> = B<sub>i+1</sub>; B<sub>7</sub> = C</td>
<td><code>ROR A</code><br><code>ROR $44</code><br><code>ROR $44,X</code><br><code>ROR $4400</code><br><code>ROR $4400,X</code></td>
</tr>
</tbody>
</table><p>Con el desplazamiento se van moviendo los bits en una dirección para introducir un cero por un lado y sacar al <em>flag</em> de <em>carry</em> el bit que ha salido fuera. Mientras que la rotación, el bit que es empujado fuera se mete en el <em>carry</em> y se vuelve a introducir en el otro extremo.</p>
<h3 id="instrucciones-de-la-pila">Instrucciones de la pila</h3>
<p>Para manejar la pila de programa tenemos las siguientes instrucciones:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">PHA</td>
<td align="center">-</td>
<td>Meter A</td>
<td><code>PHA</code></td>
</tr>
<tr>
<td align="center">PHP</td>
<td align="center">-</td>
<td>Meter P</td>
<td><code>PHP</code></td>
</tr>
<tr>
<td align="center">PLA</td>
<td align="center">N Z</td>
<td>Sacar A</td>
<td><code>PLA</code></td>
</tr>
<tr>
<td align="center">PLP</td>
<td align="center">N V B D I Z C</td>
<td>Sacar P</td>
<td><code>PLP</code></td>
</tr>
<tr>
<td align="center">TSX</td>
<td align="center">N Z</td>
<td>S → X</td>
<td><code>TSX</code></td>
</tr>
<tr>
<td align="center">TXS</td>
<td align="center">-</td>
<td>X → S</td>
<td><code>TXS</code></td>
</tr>
</tbody>
</table><p>Las instrucciones <code>PHA</code> y <code>PHP</code> <strong>meten</strong> el contenido del registro en la pila, mientras que <code>PLA</code> y <code>PLP</code> <strong>sacan</strong> un byte de la pila y lo guardan en los registros. Si queremos consultar o modificar el <strong>puntero</strong> actual a la <strong>pila</strong>, tenemos que usar las instrucciones <code>TSX</code> y <code>TXS</code>.</p>
<h3 id="instrucciones-de-salto">Instrucciones de salto</h3>
<p>Mediante los <em><strong>flags</strong></em> del registro <strong>P</strong> podemos <strong>saltar condicionalmente</strong> con las siguientes instrucciones:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">BCC</td>
<td align="center">-</td>
<td>Salto si C = 0.</td>
<td><code>BCC etiqueta</code></td>
</tr>
<tr>
<td align="center">BCS</td>
<td align="center">-</td>
<td>Salto si C = 1.</td>
<td><code>BCS etiqueta</code></td>
</tr>
<tr>
<td align="center">BNE</td>
<td align="center">-</td>
<td>Salto si Z = 0.</td>
<td><code>BNE etiqueta</code></td>
</tr>
<tr>
<td align="center">BEQ</td>
<td align="center">-</td>
<td>Salto si Z = 1.</td>
<td><code>BEQ etiqueta</code></td>
</tr>
<tr>
<td align="center">BVC</td>
<td align="center">-</td>
<td>Salto si V = 0.</td>
<td><code>BVC etiqueta</code></td>
</tr>
<tr>
<td align="center">BVS</td>
<td align="center">-</td>
<td>Salto si V = 1.</td>
<td><code>BVS etiqueta</code></td>
</tr>
<tr>
<td align="center">BPL</td>
<td align="center">-</td>
<td>Salto si N = 0.</td>
<td><code>BPL etiqueta</code></td>
</tr>
<tr>
<td align="center">BMI</td>
<td align="center">-</td>
<td>Salto si N = 1.</td>
<td><code>BMI etiqueta</code></td>
</tr>
</tbody>
</table><p>La idea es realizar operaciones de comparación y lógicas e ir saltando en base a los resultados. Salvando mucho las distancias, sería parecido a hacer un <code>IF</code> de BASIC. Hay que tener en cuenta que estas instrucciones usan el direccionamiento relativo, por lo que no pueden saltar más de 127 bytes hacia delante y más de 128 hacia atrás.</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">JMP</td>
<td align="center">-</td>
<td>Salto incondicional.</td>
<td><code>JMP $5597</code><br><code>JMP ($5597)</code></td>
</tr>
<tr>
<td align="center">JSR</td>
<td align="center">-</td>
<td>Salto a rutina.</td>
<td><code>JSR $5597</code></td>
</tr>
<tr>
<td align="center">RTS</td>
<td align="center">-</td>
<td>Retorno de rutina.</td>
<td><code>RTS</code></td>
</tr>
</tbody>
</table><p>Con la instrucción <code>JMP</code> podemos <strong>saltar</strong> a cualquier lugar que queramos del programa. La única precaución, cuando se usa el modo de direccionamiento indirecto, es que la dirección no esté en el último byte de la página.</p>
<p>Para poder modularizar el código, en la medida que permite un programa escrito en ensamblador, tenemos las instrucciones <code>JSR</code> y <code>RTS</code>. La primera da un <strong>salto</strong> a una <strong>subrutina</strong> dentro de nuestro código, que cuando esta termine de ejecutarse utilizará <code>RTS</code> para volver al punto donde se invocó la rutina. Al utilizar <code>JSR</code>, se guarda en la pila la dirección a la que tiene que saltar cuando ejecute <code>RTS</code>, guardando primero el byte más significativo (MSB) en la pila y después el menos significativo (LSB).</p>
<p>En plataformas modernas, con lenguajes modernos, por debajo un programa usa también subrutinas junto con la pila. Antes de llamar a otra rutina, se guarda en la pila el estado actual, para rescatarlo más tarde, e incluso se guarda en la pila los parámetros de la llamada. Técnicamente podemos hacer también eso con el C64, pero en la realidad nos encontramos con una pila de 256 bytes, que se agotaría fulminantemente de hacer algo así.</p>
<h3 id="instrucciones-de-interrupción">Instrucciones de interrupción</h3>
<p>Mientras se está ejecutando el programa en la CPU, hay otros chips de E/S que están realizando operaciones de forma paralela. Cuando se cumple alguna condición o se termina alguna tarea concreta, el chip en cuestión se encarga de enviar una <strong>señal de interrupción</strong> a la CPU. Cuando se recibe esta señal se para lo que se está haciendo, se guarda el estado actual y se hace un salto a la rutina que esté encargada de gestionar las interrupciones. Hay <strong>dos tipos</strong> de interrupciones:</p>
<ul>
<li>
<p><strong>Enmascarables (IRQ):</strong> Se pueden desactivar poniendo a cero el <em>flag</em> I del registro de estado, porque la señal que las activa va al pin IRQ de la CPU.</p>
</li>
<li>
<p><strong>No enmascarables (NMI):</strong> No se pueden desactivar porque la señal que las activa va al pin NMI de la CPU.</p>
</li>
</ul>
<p>Para trabajar con interrupciones tenemos las siguientes instrucciones:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">CLI</td>
<td align="center">I=0</td>
<td>Desactiva las interrupciones IRQ.</td>
<td><code>CLI</code></td>
</tr>
<tr>
<td align="center">SEI</td>
<td align="center">I=1</td>
<td>Activa las interrupciones IRQ.</td>
<td><code>SEI</code></td>
</tr>
<tr>
<td align="center">BRK</td>
<td align="center">B=1</td>
<td>Interrupción por software.</td>
<td><code>BRK</code></td>
</tr>
<tr>
<td align="center">RTI</td>
<td align="center">N V B D I Z C</td>
<td>Retorno de interrupción.</td>
<td><code>RTI</code></td>
</tr>
</tbody>
</table><p>Las instrucciones <code>CLI</code> y <code>SEI</code> ya las vimos en una sección anterior, pero nos sirven para activar o desactivar las interrupciones enmascarables. La instrucción <code>RTI</code> es parecida al retorno de subrutina, pero se tiene que utilizar en aquellas rutinas que son invocadas por la CPU al producirse una interrupción. La instrucción <code>BRK</code> fuerza desde el programa a que se produzca una interrupción no enmascarable que se gestiona como si fuera una de tipo IRQ.</p>
<p>Cuando se produce una <strong>interrupción IRQ</strong>, ya sea por hardware o por software, se guarda el PC en la pila (primero el MSB y después el LSB), se guarda el registro de estado y se ejecuta la rutina apuntada por $FFFE-$FFFF, que es la rutina en $FF48 de la ROM del KERNAL. Esta rutina primero guarda en la pila los registros A, X e Y, y después comprueba si se trata de una interrupción de hardware o software con el <em>flag</em> B. Si es una <strong>interrupción hardware</strong> se salta a la dirección apuntada por <strong>$0314-$0315</strong>, si es <strong>software</strong> la apuntada por <strong>$0316-$0317</strong>, que por defecto son las rutinas en <strong>$EA31</strong> y <strong>$FE66</strong> respectivamente.</p>
<p>Hay que tener en cuenta que la instrucción <code>RTI</code> al ejecutarse recupera primero el registro de estado y después el PC de la pila, para continuar la ejecución en la dirección donde se produjo la interrupción. Sin embargo, si se modifica el puntero en $0314-$0315 o $0316-$0317, antes de ejecutar <code>RTI</code> hay que recuperar los registros Y, X y A, para evitar que falle la ejecución al saltar a una dirección equivocada de la memoria. No obstante, cuando redirijamos la rutina de interrupciones a una programada por nosotros, en lugar de utilizar <code>RTI</code> lo habitual es saltar con <code>JMP</code> a la rutina por defecto. Por ejemplo:</p>
<pre><code>*=$0810
main
        sei          ; Desactivar IRQ
        lda #&lt;update ; LSB
        sta $0314
        lda #&gt;update ; MSB
        sta $0315
        cli          ; Activar IRQ
        rts

update
        ; Actualizar pantalla
        inc Victim
        lda Victim
        sta $0400
        ; Rutina por defecto
        jmp $EA31

Victim  BYTE 0
</code></pre>
<p>Se desactivan primero las interrupciones, para evitar que se produzca ninguna mientras se modifica el valor del puntero, y una vez modificado se vuelven a activar. Ese es todo el programa por un lado y por el otro está la rutina que gestiona ahora las interrupciones, que actualiza un contador y modifica el buffer de pantalla, para luego proseguir con la rutina por defecto de gestión de interrupciones del KERNAL.</p>
<p>En cuanto a las <strong>interrupciones NMI</strong>, el mecanismo es similar a las de tipo IRQ, las diferencias es que no se pueden desactivar con el <em>flag</em> I como se ha comentado y que se ejecuta la rutina apuntada por $FFFA-$FFFB, que es la rutina en $FE43 de la ROM del KERNAL. Al final termina ejecutando la rutina apuntada por <strong>$0318-$0319</strong>, que por defecto es la rutina en <strong>$FE47</strong>.</p>
<h3 id="instrucciones-auxiliares">Instrucciones auxiliares</h3>
<p>En este grupo de instrucciones tenemos las que nos queda y que son de difícil clasificación:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th>Descripción</th>
<th>Ejemplos</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">BIT</td>
<td align="center">N=B7 V=B6 Z</td>
<td>Comprobar bits.</td>
<td><code>BIT $44</code><br><code>BIT $4400</code></td>
</tr>
<tr>
<td align="center">NOP</td>
<td align="center">-</td>
<td>No operar.</td>
<td><code>NOP</code></td>
</tr>
</tbody>
</table><p>La instrucción <code>BIT</code> es casi idéntica a <code>AND</code>, pero no almacena en el acumulador el resultado de la operación. Además, modifica el <em>flag</em> Z, dependiendo del resultado de la operación, y asigna los bits 6 y 7, a los <em>flags</em> V y N respectivamente.</p>
<p>La instrucción <code>NOP</code> no ejecuta ninguna acción y su única utilidad es rellenar zonas de la memoria de forma segura.</p>
<h3 id="detalles-de-bajo-nivel">Detalles de bajo nivel</h3>
<p>Existen un total de 56 <a href="http://6502.org/tutorials/6502opcodes.html">instrucciones</a> disponibles para el chip 6510. La siguiente tabla resume los flags que modifica, así como el código máquina de la instrucción en cada modo, el tamaño de la instrucción y el número de ciclos que tarda en ejecutarse:</p>

<table>
<thead>
<tr>
<th align="center">Ins.</th>
<th align="center">Flags</th>
<th align="center">-</th>
<th align="center">#</th>
<th align="center">ZP</th>
<th align="center">ZP,X</th>
<th align="center">ZP,Y</th>
<th align="center">(ZP,X)</th>
<th align="center">(ZP),Y</th>
<th align="center">ABS</th>
<th align="center">ABS,X</th>
<th align="center">ABS,Y</th>
<th align="center">(ABS)</th>
<th align="center">REL</th>
<th align="center">A</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ADC</td>
<td align="center">N V Z C</td>
<td align="center">-</td>
<td align="center">$69<br>2<br>2</td>
<td align="center">$65<br>2<br>3</td>
<td align="center">$75<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$61<br>2<br>6</td>
<td align="center">$71<br>2<br>5+</td>
<td align="center">$6D<br>3<br>4</td>
<td align="center">$7D<br>3<br>4+</td>
<td align="center">$79<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">AND</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$29<br>2<br>2</td>
<td align="center">$25<br>2<br>3</td>
<td align="center">$35<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$21<br>2<br>6</td>
<td align="center">$31<br>2<br>5+</td>
<td align="center">$2D<br>3<br>4</td>
<td align="center">$3D<br>3<br>4+</td>
<td align="center">$29<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">ASL</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$06<br>2<br>5</td>
<td align="center">$16<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$0E<br>3<br>6</td>
<td align="center">$1E<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$0A<br>1<br>2</td>
</tr>
<tr>
<td align="center">BCC</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$90<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BCS</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$B0<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BEQ</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$F0<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BIT</td>
<td align="center">N=B7 V=B6 Z</td>
<td align="center">-</td>
<td align="center">$24<br>2<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$2C<br>2<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BMI</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$30<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BNE</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$D0<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BPL</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$10<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BRK</td>
<td align="center">B=1</td>
<td align="center">$00<br>1<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BVC</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$50<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">BVS</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$70<br>2<br>2*+</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CLC</td>
<td align="center">C=0</td>
<td align="center">$18<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CLD</td>
<td align="center">D=0</td>
<td align="center">$D8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CLI</td>
<td align="center">I=0</td>
<td align="center">$58<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CLV</td>
<td align="center">V=0</td>
<td align="center">$B8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CMP</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">$C9<br>2<br>2</td>
<td align="center">$C5<br>2<br>3</td>
<td align="center">$D5<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$C1<br>2<br>6</td>
<td align="center">$D1<br>2<br>5+</td>
<td align="center">$CD<br>3<br>4</td>
<td align="center">$DD<br>3<br>4+</td>
<td align="center">$D9<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CPX</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">$E0<br>2<br>2</td>
<td align="center">$E4<br>2<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$EC<br>3<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">CPY</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">$C0<br>2<br>2</td>
<td align="center">$C4<br>2<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$CC<br>3<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">DEC</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$C6<br>2<br>5</td>
<td align="center">$D6<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$CE<br>3<br>6</td>
<td align="center">$DE<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">DEX</td>
<td align="center">N Z</td>
<td align="center">$CA<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">DEY</td>
<td align="center">N Z</td>
<td align="center">$88<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">EOR</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$49<br>2<br>2</td>
<td align="center">$45<br>2<br>3</td>
<td align="center">$55<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$41<br>2<br>6</td>
<td align="center">$51<br>2<br>5+</td>
<td align="center">$4D<br>3<br>4</td>
<td align="center">$5D<br>3<br>4+</td>
<td align="center">$59<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">INC</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$E6<br>2<br>5</td>
<td align="center">$F6<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$EE<br>3<br>6</td>
<td align="center">$FE<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">INX</td>
<td align="center">N Z</td>
<td align="center">$E8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">INY</td>
<td align="center">N Z</td>
<td align="center">$C8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">JMP</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$4C<br>3<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$6C<br>3<br>5</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">JSR</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$20<br>3<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">LDA</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$A9<br>2<br>2</td>
<td align="center">$A5<br>2<br>3</td>
<td align="center">$B5<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$A1<br>2<br>6</td>
<td align="center">$B1<br>2<br>5+</td>
<td align="center">$AD<br>3<br>4</td>
<td align="center">$BD<br>3<br>4+</td>
<td align="center">$B9<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">LDX</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$A2<br>2<br>2</td>
<td align="center">$A6<br>2<br>3</td>
<td align="center">-</td>
<td align="center">$B6<br>2<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$AE<br>3<br>4</td>
<td align="center">-</td>
<td align="center">$BE<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">LDY</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$A0<br>2<br>2</td>
<td align="center">$A4<br>2<br>3</td>
<td align="center">$B4<br>2<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$AC<br>3<br>4</td>
<td align="center">$BC<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">LSR</td>
<td align="center">N=0 Z C</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$46<br>2<br>5</td>
<td align="center">$56<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$4E<br>3<br>6</td>
<td align="center">$5E<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$4A<br>1<br>2</td>
</tr>
<tr>
<td align="center">NOP</td>
<td align="center">-</td>
<td align="center">$EA<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">ORA</td>
<td align="center">N Z</td>
<td align="center">-</td>
<td align="center">$09<br>2<br>2</td>
<td align="center">$05<br>2<br>3</td>
<td align="center">$15<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$01<br>2<br>6</td>
<td align="center">$11<br>2<br>5+</td>
<td align="center">$0D<br>3<br>4</td>
<td align="center">$1D<br>3<br>4+</td>
<td align="center">$19<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">PHA</td>
<td align="center">-</td>
<td align="center">$48<br>1<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">PHP</td>
<td align="center">-</td>
<td align="center">$08<br>1<br>3</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">PLA</td>
<td align="center">N Z</td>
<td align="center">$68<br>1<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">PLP</td>
<td align="center">N V B D I Z C</td>
<td align="center">$28<br>1<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">ROL</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$26<br>2<br>5</td>
<td align="center">$36<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$2E<br>3<br>6</td>
<td align="center">$3E<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$2A<br>1<br>2</td>
</tr>
<tr>
<td align="center">ROR</td>
<td align="center">N Z C</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$66<br>2<br>5</td>
<td align="center">$76<br>2<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$6E<br>3<br>6</td>
<td align="center">$7E<br>3<br>7</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$6A<br>1<br>2</td>
</tr>
<tr>
<td align="center">RTI</td>
<td align="center">N V B D I Z C</td>
<td align="center">$40<br>1<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">RTS</td>
<td align="center">-</td>
<td align="center">$60<br>1<br>6</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">SBC</td>
<td align="center">N V Z C</td>
<td align="center">-</td>
<td align="center">$E9<br>2<br>2</td>
<td align="center">$E5<br>2<br>3</td>
<td align="center">$F5<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$E1<br>2<br>6</td>
<td align="center">$F1<br>2<br>5+</td>
<td align="center">$ED<br>3<br>4</td>
<td align="center">$FD<br>3<br>4+</td>
<td align="center">$E9<br>3<br>4+</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">SEC</td>
<td align="center">C=1</td>
<td align="center">$38<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">SED</td>
<td align="center">D=1</td>
<td align="center">$F8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">SEI</td>
<td align="center">I=1</td>
<td align="center">$78<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">STA</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$85<br>2<br>3</td>
<td align="center">$95<br>2<br>4</td>
<td align="center">-</td>
<td align="center">$81<br>2<br>6</td>
<td align="center">$91<br>2<br>6</td>
<td align="center">$8D<br>3<br>4</td>
<td align="center">$9D<br>3<br>5</td>
<td align="center">$99<br>3<br>5</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">STX</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$86<br>2<br>3</td>
<td align="center">-</td>
<td align="center">$96<br>2<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$8E<br>3<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">STY</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$84<br>2<br>3</td>
<td align="center">$94<br>2<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">$8C<br>3<br>4</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TAX</td>
<td align="center">N Z</td>
<td align="center">$AA<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TAY</td>
<td align="center">N Z</td>
<td align="center">$A8<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TSX</td>
<td align="center">N Z</td>
<td align="center">$BA<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TXA</td>
<td align="center">N Z</td>
<td align="center">$8A<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TXS</td>
<td align="center">-</td>
<td align="center">$9A<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">TYA</td>
<td align="center">N Z</td>
<td align="center">$98<br>1<br>2</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
</tbody>
</table><p>Cuando el tiempo en ciclos tiene un <strong>+</strong> al final, significa que se ha de sumar un ciclo más si la operación tiene que cambiar de página. El símbolo <strong>*</strong> significa que se ha de sumar un ciclo más si se ejecuta el salto.</p>
<h2 id="memoria">Memoria</h2>
<p>El C64 nos permite configurar la memoria para hacer visible los diferentes chips de ROM y RAM del sistema. Para ello tenemos que configurar los <strong>bits 0-2</strong> de la dirección de memoria <strong>$0001</strong>, para configurar los bloques de memoria en $A000-$BFFF, $D000-$DFFF y $E000-$FFFF:</p>
<ul>
<li><strong>000;100</strong> = RAM visible en los tres bloques.</li>
<li><strong>x01</strong> = RAM visible en $A000-$BFFF y $E000-$FFFF.</li>
<li><strong>x10</strong> = RAM visible en $A000-$BFFF y KERNAL ROM visible en $E000-$FFFF.</li>
<li><strong>x11</strong> = BASIC ROM visible en $A000-$BFFF y KERNAL ROM visible en $E000-$FFFF.</li>
<li><strong>0xx</strong> = ROM de caracteres visible en $D000-$DFFF (excepto valor 000).</li>
<li><strong>1xx</strong> = Chips E/S visibles en $D000-$DFFF (excepto valor 100).</li>
</ul>
<p>El valor por defecto al arrancar la máquina es el <strong>111</strong>, es decir, que la ROM de BASIC, el KERNAL y los chips de E/S son visibles. Es recomendable no desactivar el KERNAL, ni los chips de E/S, para poder trabajar con la máquina, pero en cuanto al interprete de BASIC se puede prescindir del mismo si no necesitamos de ninguna de sus subrutinas.</p>
<p>Por defecto la distribución de la memoria es la siguiente:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$0000-$00FF</td>
<td>Página cero.</td>
</tr>
<tr>
<td align="center">$0100-$01FF</td>
<td>Pila de programa.</td>
</tr>
<tr>
<td align="center">$0200-$03FF</td>
<td>Operaciones del sistema (BASIC y E/S).</td>
</tr>
<tr>
<td align="center">$0400-$07FF</td>
<td>Buffer de pantalla y punteros de <em>sprites</em>.</td>
</tr>
<tr>
<td align="center">$0800-$9FFF</td>
<td>Memoria libre (38.912 bytes).</td>
</tr>
<tr>
<td align="center">$A000-$BFFF</td>
<td>ROM BASIC.</td>
</tr>
<tr>
<td align="center">$C000-$CFFF</td>
<td>Memoria libre (4.096 bytes).</td>
</tr>
<tr>
<td align="center">$D000-$D3FF</td>
<td>Chip VIC-II.</td>
</tr>
<tr>
<td align="center">$D400-$D7FF</td>
<td>Chip SID.</td>
</tr>
<tr>
<td align="center">$D800-$DBFF</td>
<td>Buffer de color de pantalla.</td>
</tr>
<tr>
<td align="center">$DC00-$DDFF</td>
<td>Chips CIA1 y CIA2.</td>
</tr>
<tr>
<td align="center">$DE00-$DFFF</td>
<td>E/S dispositivos externos opcionales.</td>
</tr>
<tr>
<td align="center">$E000-$FFFF</td>
<td>ROM KERNAL.</td>
</tr>
</tbody>
</table><p>Por defecto tenemos 43.008 bytes de memoria libre disponible, que se pueden ampliar a 51.200 bytes si desactivamos la ROM de BASIC.</p>
<h2 id="interfaz-gráfica">Interfaz gráfica</h2>
<p>El chip gráfico <a href="https://www.c64-wiki.com/wiki/VIC">VIC-II</a> tiene la capacidad de gestionar 16 KB de memoria RAM de los 64 KB que tiene en total el C64. Dentro del puerto A (<strong>$DD00</strong>) de la CIA2, modificando los <strong>bits 0-1</strong>, podemos configurar cual de los cuatro bancos de memoria puede acceder el chip:</p>
<ul>
<li><strong>00</strong> = Banco 3 $C000-$FFFF (49152-65535).</li>
<li><strong>01</strong> = Banco 2 $8000-$BFFF (32768-49151).</li>
<li><strong>10</strong> = Banco 1 $4000-$7FFF (16384-32767)</li>
<li><strong>11</strong> = Banco 0 $0000-$3FFF (0-16383).</li>
</ul>
<p>Esto define los bits 14 y 15 de las direcciones a las que va a acceder el chip VIC-II. Una vez seleccionado el banco, podemos desde los registros en <strong>$D011</strong> y <strong>$D016</strong> cambiar la configuración de la pantalla:</p>

<table>
<thead>
<tr>
<th align="center">Bits</th>
<th>$D011</th>
<th>$D016</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0-2</strong></td>
<td>Desplazamiento horizontal raster.</td>
<td>Desplazamiento vertical raster.</td>
</tr>
<tr>
<td align="center"><strong>3</strong></td>
<td>Altura pantalla (<strong>0</strong> = 24; <strong>1</strong> = 25).</td>
<td>Ancho pantalla (<strong>0</strong> = 38; <strong>1</strong> = 40).</td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td>Pantalla: <strong>0</strong> = Apagada; <strong>1</strong> = Encendida.</td>
<td>Modo: <strong>0</strong> = Monocolor; <strong>1</strong> = Multicolor.</td>
</tr>
<tr>
<td align="center"><strong>5</strong></td>
<td>Modo: <strong>0</strong> = Carácter; <strong>1</strong> = Bitmap.</td>
<td>-</td>
</tr>
<tr>
<td align="center"><strong>6</strong></td>
<td>Modo fondo extendido: <strong>0</strong> = Desactivado; <strong>1</strong> = Activado.</td>
<td>-</td>
</tr>
<tr>
<td align="center"><strong>7</strong></td>
<td>Bit 8 de la línea actual del <em>raster</em>.</td>
<td>-</td>
</tr>
</tbody>
</table><p>Como se puede observar hay diferentes modos de pantalla, que se resumen en dos categorías:</p>
<ul>
<li>
<p><strong>Modo carácter:</strong> La unidad de pantalla es el carácter, que tiene un tamaño de <strong>8x8 píxeles</strong>. Podemos llamar a este modo también mapa de baldosas o <em>tilemap</em>, para ajustarlo a la terminología actual. El juego de caracteres, al que podemos llamar también <em>tileset</em>, es un conjunto de <strong>256 elementos</strong> a los que se apunta desde el buffer de pantalla. Cada <em>tile</em> requiere <strong>8 bytes</strong> de tamaño para definirlo, donde cada byte representa la fila dentro de la matriz de 8x8 y cada bit la columna dentro de dicha fila. Para definir un <em>tileset</em> completo necesitaremos 8x256 = <strong>2.048 bytes</strong> (2 KB).</p>
</li>
<li>
<p><strong>Modo bitmap:</strong> La unidad de pantalla es el píxel, teniendo un total de <strong>320x200 píxeles</strong> el buffer de pantalla. Este modo consume muchos más recursos de la máquina, por ello muchos juegos lo utilizan sólo para la portada del juego y poco más.</p>
</li>
</ul>
<p>Para el modo carácter hace falta el buffer de pantalla, el de color y el juego de caracteres. Para el modo bitmap hace falta el buffer de píxeles y el de color. Algunas de estas regiones se pueden cambiar de ubicación dentro del banco de memoria seleccionado, para ello usaremos el registro en <strong>$D018</strong>:</p>

<table>
<thead>
<tr>
<th align="center">Bits</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>1-3</strong></td>
<td>Modo carácter: Ubicación del juego de caracteres (bits 11-13).<br>Modo bitmap: Ubicación del buffer de píxeles (bit 13).</td>
</tr>
<tr>
<td align="center"><strong>4-7</strong></td>
<td>Ubicación del buffer de pantalla (bits 10-13).</td>
</tr>
</tbody>
</table><p>La ubicación del juego de caracteres en la memoria RAM, dependiendo del banco de memoria elegido en <strong>$DD00</strong>, será:</p>

<table>
<thead>
<tr>
<th align="center">Valor</th>
<th>Banco 0 (11)</th>
<th>Banco 1 (10)</th>
<th>Banco 2 (01)</th>
<th>Banco 3 (00)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>000</strong></td>
<td>$0000-$07FF</td>
<td>$4000-$47FF</td>
<td>$8000-$87FF</td>
<td>$C000-$C7FF</td>
</tr>
<tr>
<td align="center"><strong>001</strong></td>
<td>$0800-$0FFF</td>
<td>$4800-$4FFF</td>
<td>$8800-$8FFF</td>
<td>$C800-$CFFF</td>
</tr>
<tr>
<td align="center"><strong>010</strong></td>
<td>$1000-$17FF</td>
<td>$5000-$57FF</td>
<td>$9000-$97FF</td>
<td>$D000-$D7FF</td>
</tr>
<tr>
<td align="center"><strong>011</strong></td>
<td>$1800-$1FFF</td>
<td>$5800-$5FFF</td>
<td>$9800-$9FFF</td>
<td>$D800-$DFFF</td>
</tr>
<tr>
<td align="center"><strong>100</strong></td>
<td>$2000-$27FF</td>
<td>$6000-$67FF</td>
<td>$A000-$A7FF</td>
<td>$E000-$E7FF</td>
</tr>
<tr>
<td align="center"><strong>101</strong></td>
<td>$2800-$2FFF</td>
<td>$6800-$6FFF</td>
<td>$A800-$AFFF</td>
<td>$E800-$EFFF</td>
</tr>
<tr>
<td align="center"><strong>110</strong></td>
<td>$3000-$37FF</td>
<td>$7000-$77FF</td>
<td>$B000-$B7FF</td>
<td>$F000-$F7FF</td>
</tr>
<tr>
<td align="center"><strong>111</strong></td>
<td>$3800-$3FFF</td>
<td>$7800-$7FFF</td>
<td>$B800-$BFFF</td>
<td>$F800-$FFFF</td>
</tr>
</tbody>
</table><blockquote>
<p><strong>AVISO:</strong> Con los valores <strong>010</strong> y <strong>011</strong> con el <strong>banco 0</strong> y <strong>2</strong> la implementación del chip VIC-II selecciona la ROM de caracteres en lugar de la RAM.</p>
</blockquote>
<p>La ubicación del buffer de píxeles en la memoria RAM será:</p>

<table>
<thead>
<tr>
<th align="center">Valor</th>
<th>Banco 0 (11)</th>
<th>Banco 1 (10)</th>
<th>Banco 2 (01)</th>
<th>Banco 3 (00)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0xx</strong></td>
<td>$0000-$1FFF</td>
<td>$4000-$5FFF</td>
<td>$8000-$9FFF</td>
<td>$C000-$DFFF</td>
</tr>
<tr>
<td align="center"><strong>1xx</strong></td>
<td>$2000-$3FFF</td>
<td>$6000-$7FFF</td>
<td>$A000-$BFFF</td>
<td>$E000-$FFFF</td>
</tr>
</tbody>
</table><p>La ubicación del buffer de pantalla en la memoria RAM será:</p>

<table>
<thead>
<tr>
<th align="center">Valor</th>
<th>Banco 0 (11)</th>
<th>Banco 1 (10)</th>
<th>Banco 2 (01)</th>
<th>Banco 3 (00)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0000</strong></td>
<td>$0000-$03FF</td>
<td>$4000-$43FF</td>
<td>$8000-$83FF</td>
<td>$C000-$C3FF</td>
</tr>
<tr>
<td align="center"><strong>0001</strong></td>
<td>$0400-$07FF</td>
<td>$4400-$47FF</td>
<td>$8400-$87FF</td>
<td>$C400-$C7FF</td>
</tr>
<tr>
<td align="center"><strong>0010</strong></td>
<td>$0800-$0BFF</td>
<td>$4800-$4BFF</td>
<td>$8800-$8BFF</td>
<td>$C800-$CBFF</td>
</tr>
<tr>
<td align="center"><strong>0011</strong></td>
<td>$0C00-$0FFF</td>
<td>$4C00-$4FFF</td>
<td>$8C00-$8FFF</td>
<td>$CC00-$CFFF</td>
</tr>
<tr>
<td align="center"><strong>0100</strong></td>
<td>$1000-$13FF</td>
<td>$5000-$53FF</td>
<td>$9000-$93FF</td>
<td>$D000-$D3FF</td>
</tr>
<tr>
<td align="center"><strong>0101</strong></td>
<td>$1400-$17FF</td>
<td>$5400-$57FF</td>
<td>$9400-$97FF</td>
<td>$D400-$D7FF</td>
</tr>
<tr>
<td align="center"><strong>0110</strong></td>
<td>$1800-$1BFF</td>
<td>$5800-$5BFF</td>
<td>$9800-$9BFF</td>
<td>$D800-$DBFF</td>
</tr>
<tr>
<td align="center"><strong>0111</strong></td>
<td>$1C00-$1FFF</td>
<td>$5C00-$5FFF</td>
<td>$9C00-$9FFF</td>
<td>$DC00-$DFFF</td>
</tr>
<tr>
<td align="center"><strong>1000</strong></td>
<td>$2000-$23FF</td>
<td>$6000-$63FF</td>
<td>$A000-$A3FF</td>
<td>$E000-$E3FF</td>
</tr>
<tr>
<td align="center"><strong>1001</strong></td>
<td>$2400-$27FF</td>
<td>$6400-$67FF</td>
<td>$A400-$A7FF</td>
<td>$E400-$E7FF</td>
</tr>
<tr>
<td align="center"><strong>1010</strong></td>
<td>$2800-$2BFF</td>
<td>$6800-$6BFF</td>
<td>$A800-$ABFF</td>
<td>$E800-$EBFF</td>
</tr>
<tr>
<td align="center"><strong>1011</strong></td>
<td>$2C00-$2FFF</td>
<td>$6C00-$6FFF</td>
<td>$AC00-$AFFF</td>
<td>$EC00-$EFFF</td>
</tr>
<tr>
<td align="center"><strong>1100</strong></td>
<td>$3000-$33FF</td>
<td>$7000-$73FF</td>
<td>$B000-$B3FF</td>
<td>$F000-$F3FF</td>
</tr>
<tr>
<td align="center"><strong>1101</strong></td>
<td>$3400-$37FF</td>
<td>$7400-$77FF</td>
<td>$B400-$B7FF</td>
<td>$F400-$F7FF</td>
</tr>
<tr>
<td align="center"><strong>1110</strong></td>
<td>$3800-$3BFF</td>
<td>$7800-$7BFF</td>
<td>$B800-$BBFF</td>
<td>$F800-$FBFF</td>
</tr>
<tr>
<td align="center"><strong>1111</strong></td>
<td>$3C00-$3FFF</td>
<td>$7C00-$7FFF</td>
<td>$BC00-$BFFF</td>
<td>$FC00-$FFFF</td>
</tr>
</tbody>
</table><p>En caso de cambiar la ubicación del buffer de pantalla, si queremos utilizar las subrutinas de la terminal tendemos que actualizar el valor en la dirección <strong>$0288</strong> (648), que por defecto tiene el valor <code>$04</code>.</p>
<h3 id="colores-del-sistema">Colores del sistema</h3>
<p>El C64 tiene 16 colores diferentes, cuyos valores van del 0 al 15, por lo que sólo requieren de 4 bits para definirlos. Por ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> VER LISTA DE COLORES</span>
<span class="token number">20</span>  TB<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">:</span>CB<span class="token operator">=</span><span class="token number">55296</span><span class="token punctuation">:</span>T<span class="token operator">=</span><span class="token number">160</span>
<span class="token number">30</span>  <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">24</span>
<span class="token number">40</span>  <span class="token keyword">FOR</span> J<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">39</span>
<span class="token number">50</span>  C<span class="token operator">=</span><span class="token function">INT</span><span class="token punctuation">(</span>J<span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token number">60</span>  <span class="token keyword">IF</span> I<span class="token operator">&gt;</span><span class="token number">12</span> <span class="token keyword">THEN</span> C<span class="token operator">=</span>C<span class="token operator">+</span><span class="token number">8</span>
<span class="token number">70</span>  <span class="token keyword">POKE</span> TB<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token operator">*</span>I<span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>T
<span class="token number">80</span>  <span class="token keyword">POKE</span> CB<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token operator">*</span>I<span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>C
<span class="token number">90</span>  <span class="token keyword">NEXT</span> J
<span class="token number">100</span> <span class="token keyword">NEXT</span> I
<span class="token number">110</span> <span class="token keyword">GET</span> K$
<span class="token number">120</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">""</span> <span class="token keyword">THEN</span> <span class="token number">110</span>
</code></pre>
<p>Este programa rellena el buffer de pantalla y de color para mostrar los 16 colores que soporta el chip gráfico VIC-II. Como resultado obtenemos la siguiente imagen:</p>
<p align="center"><img src="https://gorkinovich.github.io/learn/C64-Colors.png" alt="Colores del C64"></p>
<p>Además del buffer de color, podemos modificar el color del borde de la pantalla en la dirección <strong>$D020</strong> y el del fondo en <strong>$D021</strong>, independientemente del modo gráfico que esté seleccionado.</p>
<h3 id="modo-carácter">Modo carácter</h3>
<p>El modo carácter es un grupo de modos gráficos que gestionan el buffer de pantalla usando el carácter como unidad de información. Con este modo se puede representar, gastando poca memoria, los niveles de un juego. Hay tres modos de caracteres: el <strong>estándar</strong>, el <strong>multicolor</strong> y el de <strong>color de fondo extendido</strong>.</p>
<p>Los tres modos implican una representación de la pantalla como un tablero de <strong>40x25 celdas</strong>. Para ello hay un buffer de pantalla, que contiene los índices a los caracteres, y un buffer de color para la pantalla. Por defecto, el buffer de pantalla está en la región <strong>$0400-$07E7</strong>, aunque se puede reubicar si fuera necesario. El buffer de color siempre se encuentra en la región <strong>$D800-$DBE7</strong>. Ambos búferes tienen un tamaño de <strong>1.000 bytes</strong>, de modo que la posición 0 es la esquina superior izquierda y la posición 999 es la esquina inferior derecha.</p>
<p>Cada celda de la pantalla es un byte, por lo tanto podemos disponer de 256 posibles valores que referenciar en el juego de caracteres, desde el 0 al 255. Como cada carácter tiene unas dimensiones de <strong>8x8 píxeles</strong>, la resolución de la pantalla es de <strong>320x200 píxeles</strong>. No hay que confundir los códigos de pantalla, que son índices dentro del juego de caracteres, con los códigos PETSCII. Algunas rutinas del KERNAL funcionan con PETSCII, por lo que habrá que tenerlo en cuenta a la hora de trabajar, e incluso tener subrutinas de conversión entre ambos tipos de códigos.</p>
<p>El <strong>modo estándar</strong> es el que está activado por defecto al arrancar la máquina. Este nos permite por cada celda seleccionar un <em>tile</em> y un color. Dentro de la <strong>matriz</strong> de <strong>8x8</strong> del <em><strong>tile</strong></em>, si el píxel es <strong>0</strong> se utiliza el color de fondo (<strong>$D021</strong>), si es <strong>1</strong> se utiliza el color almacenado en la celda del buffer de color.</p>
<p>El <strong>modo multicolor</strong> es similar al estándar, pero nos permite utilizar hasta 4 colores por celda formando bloques de dos píxeles en horizontal. Para aquellos familiarizados con el C64 recordarán los “píxeles gordos” en sus gráficos. La activación de este modo depende del valor que tenga la celda en el buffer de color:</p>
<ul>
<li><strong>0-7:</strong> Tile en modo monocolor con color 0-7.</li>
<li><strong>8-15:</strong> Tile en modo multicolor con color 0-7.</li>
</ul>
<p>Esto nos permite tener <em>tiles</em> para pintar texto y otros para pintar el mundo del juego, aunque conlleva perder los colores del 8 al 15 para el color de la celda. En este modo, cuando un <em><strong>tile</strong></em> se pinta en modo multicolor, en vez de tener una <strong>matriz</strong> de 8x8 tenemos una de <strong>4x8</strong>, donde cada elemento representa <strong>2x1 píxeles</strong>. Ahora los valores de cada “píxel gordo” en la matriz del <em>tile</em> son:</p>
<ul>
<li><strong>00</strong> = Color de fondo (<strong>$D021</strong>).</li>
<li><strong>01</strong> = Color de fondo extra 1 (<strong>$D022</strong>).</li>
<li><strong>10</strong> = Color de fondo extra 2 (<strong>$D023</strong>).</li>
<li><strong>11</strong> = Color de la celda en el buffer de color (<strong>$D800-$DBE7</strong>).</li>
</ul>
<p>El <strong>modo de color de fondo extendido</strong> es una variación del modo estándar que nos permite tener cuatro colores de fondo distintos. Para ello, una vez es activado, el chip irá a la celda del buffer de pantalla y comprobará los <strong>bits 6-7</strong> para decidir qué color de fondo ha de usar. Los valores posibles son:</p>
<ul>
<li><strong>00</strong> = Color de fondo (<strong>$D021</strong>).</li>
<li><strong>01</strong> = Color de fondo extra 1 (<strong>$D022</strong>).</li>
<li><strong>10</strong> = Color de fondo extra 2 (<strong>$D023</strong>).</li>
<li><strong>11</strong> = Color de fondo extra 3 (<strong>$D024</strong>).</li>
</ul>
<p>La contrapartida de este sistema es que sólo podemos usar los 64 primeros elementos del mapa de caracteres, perdiendo la capacidad de usar los 192 restantes. Esto hace que este modo gráfico no sea especialmente popular.</p>
<p>Para poder ver en acción los diferentes modos tenemos el siguiente ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR VIC-II</span>
<span class="token number">20</span>  <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span><span class="token number">12</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR BORDE</span>
<span class="token number">30</span>  <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR FONDO</span>
<span class="token number">40</span>  <span class="token keyword">POKE</span> <span class="token number">53282</span><span class="token punctuation">,</span><span class="token number">2</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR EXTRA 1</span>
<span class="token number">50</span>  <span class="token keyword">POKE</span> <span class="token number">53283</span><span class="token punctuation">,</span><span class="token number">5</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR EXTRA 2</span>
<span class="token number">60</span>  <span class="token keyword">POKE</span> <span class="token number">53284</span><span class="token punctuation">,</span><span class="token number">3</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR EXTRA 3</span>
<span class="token number">70</span>  <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">1</span>    <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR CURSOR</span>
<span class="token number">80</span>  <span class="token keyword">GOSUB</span> <span class="token number">670</span>
<span class="token number">90</span>  <span class="token comment"><span class="token keyword">REM</span> PINTAR MENU</span>
<span class="token number">100</span> <span class="token function">PRINT</span> "{<span class="token number">147</span>}{<span class="token number">32</span><span class="token operator">*</span><span class="token number">10</span>}<span class="token punctuation">(</span>VIC<span class="token operator">-</span>II <span class="token function">TEXT</span> MODES<span class="token punctuation">)</span>"
<span class="token number">110</span> <span class="token function">PRINT</span>
<span class="token number">120</span> <span class="token function">PRINT</span> "{<span class="token number">32</span><span class="token operator">*</span><span class="token number">4</span>}F1<span class="token punctuation">:</span>MONO F2<span class="token punctuation">:</span>MULT F3<span class="token punctuation">:</span>EXBG F4<span class="token punctuation">:</span>BRCL"
<span class="token number">130</span> <span class="token function">PRINT</span> "{<span class="token number">32</span><span class="token operator">*</span><span class="token number">4</span>}F5<span class="token punctuation">:</span>BGCL F6<span class="token punctuation">:</span>E1CL F7<span class="token punctuation">:</span>E2CL F8<span class="token punctuation">:</span>E3CL"
<span class="token number">140</span> <span class="token function">PRINT</span> "{<span class="token number">32</span><span class="token operator">*</span><span class="token number">3</span>}<span class="token number">0</span><span class="token punctuation">:</span>CHCL <span class="token number">1</span><span class="token number">-8</span><span class="token punctuation">:</span>C0<span class="token operator">-</span>C7 SHIFT<span class="token operator">+</span><span class="token number">1</span><span class="token number">-8</span><span class="token punctuation">:</span>C8<span class="token operator">-</span>C15"
<span class="token number">150</span> <span class="token comment"><span class="token keyword">REM</span> PINTAR FUENTE</span>
<span class="token number">160</span> <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">15</span>
<span class="token number">170</span> TB<span class="token operator">=</span><span class="token number">1024</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> BUFFER PANTALLA</span>
<span class="token number">180</span> CB<span class="token operator">=</span><span class="token number">55296</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> BUFFER COLOR</span>
<span class="token number">190</span> C<span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">646</span><span class="token punctuation">)</span><span class="token punctuation">:</span>T<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">200</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">TO</span> <span class="token number">13</span>
<span class="token number">210</span> <span class="token keyword">FOR</span> J<span class="token operator">=</span><span class="token number">12</span> <span class="token keyword">TO</span> <span class="token number">27</span>
<span class="token number">220</span> <span class="token keyword">POKE</span> TB<span class="token operator">+</span><span class="token punctuation">(</span>I<span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>T
<span class="token number">230</span> <span class="token keyword">POKE</span> CB<span class="token operator">+</span><span class="token punctuation">(</span>I<span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>C
<span class="token number">240</span> <span class="token keyword">POKE</span> TB<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>I<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>T<span class="token operator">+</span><span class="token number">128</span>
<span class="token number">250</span> <span class="token keyword">POKE</span> CB<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>I<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>C
<span class="token number">260</span> T<span class="token operator">=</span>T<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">270</span> <span class="token keyword">NEXT</span> J<span class="token punctuation">,</span>I
<span class="token number">280</span> <span class="token comment"><span class="token keyword">REM</span> LOGICA MENU</span>
<span class="token number">290</span> MD<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">300</span> <span class="token keyword">GET</span> K$
<span class="token number">310</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F1}" <span class="token keyword">THEN</span> <span class="token keyword">GOSUB</span> <span class="token number">670</span>
<span class="token number">320</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F2}" <span class="token keyword">THEN</span> <span class="token keyword">GOSUB</span> <span class="token number">710</span>
<span class="token number">330</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F3}" <span class="token keyword">THEN</span> <span class="token keyword">GOSUB</span> <span class="token number">750</span>
<span class="token number">340</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F4}" <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">350</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F5}" <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">2</span>
<span class="token number">360</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F6}" <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">3</span>
<span class="token number">370</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F7}" <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">4</span>
<span class="token number">380</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F8}" <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">5</span>
<span class="token number">390</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"0"</span> <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">400</span> <span class="token keyword">IF</span> K$<span class="token operator">&gt;=</span><span class="token string">"1"</span> <span class="token operator">AND</span> K$<span class="token operator">&lt;=</span><span class="token string">"8"</span> <span class="token keyword">THEN</span> C<span class="token operator">=</span>ASC<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">GOTO</span> <span class="token number">460</span>
<span class="token number">410</span> <span class="token keyword">IF</span> K$<span class="token operator">&gt;=</span><span class="token string">"!"</span> <span class="token operator">AND</span> K$<span class="token operator">&lt;=</span><span class="token string">"("</span> <span class="token keyword">THEN</span> C<span class="token operator">=</span>ASC<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token number">-8</span><span class="token punctuation">:</span><span class="token keyword">GOTO</span> <span class="token number">460</span>
<span class="token number">420</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"/"</span> <span class="token keyword">THEN</span> K$<span class="token operator">=</span><span class="token string">"'"</span><span class="token punctuation">:</span>C<span class="token operator">=</span>ASC<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token number">-8</span><span class="token punctuation">:</span><span class="token keyword">GOTO</span> <span class="token number">460</span>
<span class="token number">430</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"Q"</span> <span class="token keyword">THEN</span> <span class="token number">550</span>
<span class="token number">440</span> <span class="token keyword">GOTO</span> <span class="token number">300</span>
<span class="token number">450</span> <span class="token comment"><span class="token keyword">REM</span> CAMBIAR EL COLOR</span>
<span class="token number">460</span> C<span class="token operator">=</span>ASC<span class="token punctuation">(</span>K$<span class="token punctuation">)</span><span class="token operator">-</span>C
<span class="token number">470</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span>C<span class="token punctuation">:</span><span class="token keyword">GOSUB</span> <span class="token number">590</span>
<span class="token number">480</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span>C
<span class="token number">490</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span>C
<span class="token number">500</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53282</span><span class="token punctuation">,</span>C
<span class="token number">510</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53283</span><span class="token punctuation">,</span>C
<span class="token number">520</span> <span class="token keyword">IF</span> MD<span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53284</span><span class="token punctuation">,</span>C
<span class="token number">530</span> <span class="token keyword">GOTO</span> <span class="token number">300</span>
<span class="token number">540</span> <span class="token comment"><span class="token keyword">REM</span> SALIR DEL PROGRAMA</span>
<span class="token number">550</span> <span class="token function">PRINT</span>"{<span class="token number">147</span>}"
<span class="token number">560</span> <span class="token keyword">GOSUB</span> <span class="token number">670</span>
<span class="token number">570</span> <span class="token keyword">END</span>
<span class="token number">580</span> <span class="token comment"><span class="token keyword">REM</span> ACTUALIZAR BUFFER COLOR</span>
<span class="token number">590</span> C<span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">646</span><span class="token punctuation">)</span>
<span class="token number">600</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">TO</span> <span class="token number">13</span>
<span class="token number">610</span> <span class="token keyword">FOR</span> J<span class="token operator">=</span><span class="token number">12</span> <span class="token keyword">TO</span> <span class="token number">27</span>
<span class="token number">620</span> <span class="token keyword">POKE</span> CB<span class="token operator">+</span><span class="token punctuation">(</span>I<span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>C
<span class="token number">630</span> <span class="token keyword">POKE</span> CB<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>I<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>J<span class="token punctuation">)</span><span class="token punctuation">,</span>C
<span class="token number">640</span> <span class="token keyword">NEXT</span> J<span class="token punctuation">,</span>I
<span class="token number">650</span> <span class="token keyword">RETURN</span>
<span class="token number">660</span> <span class="token comment"><span class="token keyword">REM</span> ACTIVAR MODO MONOCOLOR</span>
<span class="token number">670</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">159</span><span class="token punctuation">)</span>
<span class="token number">680</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">239</span><span class="token punctuation">)</span>
<span class="token number">690</span> <span class="token keyword">RETURN</span>
<span class="token number">700</span> <span class="token comment"><span class="token keyword">REM</span> ACTIVAR MODO MULTICOLOR</span>
<span class="token number">710</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">159</span><span class="token punctuation">)</span>
<span class="token number">720</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">239</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">16</span>
<span class="token number">730</span> <span class="token keyword">RETURN</span>
<span class="token number">740</span> <span class="token comment"><span class="token keyword">REM</span> ACTIVAR MODO FONDO EXTENDIDO</span>
<span class="token number">750</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">159</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">64</span>
<span class="token number">760</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">239</span><span class="token punctuation">)</span>
<span class="token number">770</span> <span class="token keyword">RETURN</span>
</code></pre>
<p>El ejemplo nos permite probar los diferentes modos de caracteres y modificar los diferentes colores de la pantalla. Además de su típica lentitud para actualizar el buffer de color y de pantalla, tiene añadida en la línea <code>420</code> una condición para facilitar la ejecución en el emulador VICE cuando el teclado está en modo simbólico, ya que el carácter que espera con <code>SHIFT+7</code> es la comilla simple (<code>'</code>).</p>
<h3 id="modo-bitmap">Modo bitmap</h3>
<p>El modo bitmap es un grupo de modos gráficos que gestionan el buffer de pantalla usando el píxel como unidad de información. Con este modo se puede representar imágenes gráficas más complejas que en la sección anterior, pero su coste de memoria es superior. Hay dos modos bitmap: el <strong>estándar</strong> y el <strong>multicolor</strong>.</p>
<p>El tamaño de pantalla en el C64 es de 320x200 píxeles, que son 64.000 píxeles en total. Si quisiéramos que cada uno pudiera representar los 16 colores que tiene la máquina, necesitaríamos 4 bits por píxel y como consecuencia harían falta 32.000 bytes de memoria. Obviamente es un coste excesivo en memoria y por ello los ingenieros que diseñaron el C64 optaron por un método más restringido.</p>
<p>En el modo bitmap tenemos un <strong>buffer de píxeles</strong>, que será de 320x200 de tamaño, pero cada píxel es de un bit de tamaño, por lo tanto el buffer ocupará <strong>8.000 bytes</strong>. Aunque sería lógico pensar que la distribución de los píxeles del buffer es lineal con respecto las coordenadas de pantalla, lo cierto es que no es así sino de la siguiente manera:</p>

<table>
<thead>
<tr>
<th align="center">Y\X</th>
<th>0</th>
<th>8</th>
<th>…</th>
<th>304</th>
<th>312</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0</strong></td>
<td>B0 (0-7)<br>B1 (8-15)<br>B2 (16-23)<br>B3 (24-31)<br>B4 (32-39)<br>B5 (40-47)<br>B6 (48-55)<br>B7 (56-63)</td>
<td>B8 (64-71)<br>B9 (72-79)<br>B10 (80-87)<br>B11 (88-95)<br>B12 (96-103)<br>B13 (104-111)<br>B14 (112-119)<br>B15 (120-127)</td>
<td>…</td>
<td>B304 (2432-2439)<br>B305 (2440-2447)<br>B306 (2448-2455)<br>B307 (2456-2463)<br>B308 (2464-2471)<br>B309 (2472-2479)<br>B310 (2480-2487)<br>B311 (2488-2495)</td>
<td>B312 (2496-2503)<br>B313 (2504-2511)<br>B314 (2512-2519)<br>B315 (2520-2527)<br>B316 (2528-2535)<br>B317 (2536-2543)<br>B318 (2544-2551)<br>B319 (2552-2559)</td>
</tr>
<tr>
<td align="center"><strong>8</strong></td>
<td>B320 (2560-2567)<br>B321 (2568-2575)<br>B322 (2576-2583)<br>B323 (2584-2591)<br>B324 (2592-2599)<br>B325 (2600-2607)<br>B326 (2608-2615)<br>B327 (2616-2623)</td>
<td>B328 (2624-2631)<br>B329 (2632-2639)<br>B330 (2640-2647)<br>B331 (2648-2655)<br>B332 (2656-2663)<br>B333 (2664-2671)<br>B334 (2672-2679)<br>B335 (2680-2687)</td>
<td>…</td>
<td>B624 (4992-4999)<br>B625 (5000-5007)<br>B626 (5008-5015)<br>B627 (5016-5023)<br>B628 (5024-5031)<br>B629 (5032-5039)<br>B630 (5040-5047)<br>B631 (5048-5055)</td>
<td>B632 (5056-5063)<br>B633 (5064-5071)<br>B634 (5072-5079)<br>B635 (5080-5087)<br>B636 (5088-5095)<br>B637 (5096-5103)<br>B638 (5104-5111)<br>B639 (5112-5119)</td>
</tr>
<tr>
<td align="center">…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td align="center"><strong>184</strong></td>
<td>B7360 (58880-58887)<br>B7361 (58888-58895)<br>B7362 (58896-58903)<br>B7363 (58904-58911)<br>B7364 (58912-58919)<br>B7365 (58920-58927)<br>B7366 (58928-58935)<br>B7367 (58936-58943)</td>
<td>B7368 (58944-58951)<br>B7369 (58952-58959)<br>B7370 (58960-58967)<br>B7371 (58968-58975)<br>B7372 (58976-58983)<br>B7373 (58984-58991)<br>B7374 (58992-58999)<br>B7375 (59000-59007)</td>
<td>…</td>
<td>B7664 (61312-61319)<br>B7665 (61320-61327)<br>B7666 (61328-61335)<br>B7667 (61336-61343)<br>B7668 (61344-61351)<br>B7669 (61352-61359)<br>B7670 (61360-61367)<br>B7671 (61368-61375)</td>
<td>B7672 (61376-61383)<br>B7673 (61384-61391)<br>B7674 (61392-61399)<br>B7675 (61400-61407)<br>B7676 (61408-61415)<br>B7677 (61416-61423)<br>B7678 (61424-61431)<br>B7679 (61432-61439)</td>
</tr>
<tr>
<td align="center"><strong>192</strong></td>
<td>B7680 (61440-61447)<br>B7681 (61448-61455)<br>B7682 (61456-61463)<br>B7683 (61464-61471)<br>B7684 (61472-61479)<br>B7685 (61480-61487)<br>B7686 (61488-61495)<br>B7687 (61496-61503)</td>
<td>B7688 (61504-61511)<br>B7689 (61512-61519)<br>B7690 (61520-61527)<br>B7691 (61528-61535)<br>B7692 (61536-61543)<br>B7693 (61544-61551)<br>B7694 (61552-61559)<br>B7695 (61560-61567)</td>
<td>…</td>
<td>B7984 (63872-63879)<br>B7985 (63880-63887)<br>B7986 (63888-63895)<br>B7987 (63896-63903)<br>B7988 (63904-63911)<br>B7989 (63912-63919)<br>B7990 (63920-63927)<br>B7991 (63928-63935)</td>
<td>B7992 (63936-63943)<br>B7993 (63944-63951)<br>B7994 (63952-63959)<br>B7995 (63960-63967)<br>B7996 (63968-63975)<br>B7997 (63976-63983)<br>B7998 (63984-63991)<br>B7999 (63992-63999)</td>
</tr>
</tbody>
</table><p>Como se puede intuir, la organización del buffer de píxeles sigue un patrón similar a la forma de trabajar del modo de caracteres. Una consecuencia de esto es que el número de colores disponibles en cada celda de 8x8 píxeles es limitado:</p>
<ul>
<li><strong>Modo estándar:</strong> 2 colores únicos por celda.
<ul>
<li><strong>0</strong> = <em>Nibble</em> bajo de la celda del buffer de pantalla.</li>
<li><strong>1</strong> = <em>Nibble</em> alto de la celda del buffer de pantalla.</li>
</ul>
</li>
<li><strong>Modo multicolor:</strong> 3 colores únicos por celda y 1 global a toda la pantalla.
<ul>
<li><strong>00</strong> = Color de fondo (<strong>$D021</strong>).</li>
<li><strong>01</strong> = <em>Nibble</em> alto de la celda del buffer de pantalla.</li>
<li><strong>10</strong> = <em>Nibble</em> bajo de la celda del buffer de pantalla.</li>
<li><strong>11</strong> = Celda del buffer de color (<strong>$D800-$DBE7</strong>).</li>
</ul>
</li>
</ul>
<p>Primero, el término <em>nibble</em> se utiliza para designar a una de las dos mitades de un byte. Segundo, podemos deducir que el modo multicolor trabaja de forma similar al visto en el modo carácter, agrupando los píxeles en bloques de dos para definir 4 posibles colores por “píxel gordo”.</p>
<p>No hay que olvidar que se debe configurar, en la dirección <strong>$D018</strong>, la ubicación del buffer de píxeles dentro del banco de memoria seleccionado del chip gráfico. Esto es importante, porque la configuración por defecto posiblemente apunta al banco 0, situando el buffer de píxeles en los primeros 8.000 bytes de la memoria, donde el sistema tiene varias páginas de la memoria reservadas para diferentes operaciones, como el caso de la pila de programa. También es recomendable ubicar correctamente el buffer de pantalla para evitar colisiones con el de píxeles.</p>
<p>Por motivos de implementación de la arquitectura, el buffer de color no se puede cambiar de ubicación y siempre mantiene la misma dirección. Además, el chip VIC-II sólo puede leer los 4 bits más bajos, como parte de las optimizaciones con las que fue diseñado. Por esta decisión no se puede utilizar su <em>nibble</em> alto para añadir un cuarto color único al modo multicolor.</p>
<p>El siguiente ejemplo nos muestra cómo trabajar con el modo multicolor:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR PROGRAMA</span>
<span class="token number">20</span>  <span class="token function">PRINT</span> "{<span class="token number">147</span>}LOADING..."
<span class="token number">30</span>  <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span><span class="token number">12</span>     <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR BORDE</span>
<span class="token number">40</span>  <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span><span class="token number">0</span>      <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR FONDO</span>
<span class="token number">50</span>  <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">1</span>        <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR CURSOR</span>
<span class="token number">60</span>  R%<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">56576</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> PUERTO A CIA2</span>
<span class="token number">70</span>  R%<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> REG1 VIC-II</span>
<span class="token number">80</span>  R%<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> REG2 VIC-II</span>
<span class="token number">90</span>  R%<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">53272</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> MEM VIC-II</span>
<span class="token number">100</span> <span class="token comment"><span class="token keyword">REM</span> BORRAR BUFFER PIXEL</span>
<span class="token number">110</span> SB<span class="token operator">=</span><span class="token number">23552</span><span class="token punctuation">:</span>PB<span class="token operator">=</span><span class="token number">24576</span><span class="token punctuation">:</span>CB<span class="token operator">=</span><span class="token number">55296</span>
<span class="token number">120</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7999</span>
<span class="token number">130</span> <span class="token keyword">POKE</span> PB<span class="token operator">+</span>I<span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">140</span> <span class="token function">PRINT</span> "{<span class="token number">19</span>}LOADING...<span class="token string">";STR$(INT(100*I/7999));"</span>%"
<span class="token number">150</span> <span class="token keyword">NEXT</span> I
<span class="token number">160</span> <span class="token comment"><span class="token keyword">REM</span> MODIFICAR MODO GRAFICO</span>
<span class="token number">170</span> <span class="token keyword">POKE</span> <span class="token number">56576</span><span class="token punctuation">,</span><span class="token punctuation">(</span>R%<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">252</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">2</span>
<span class="token number">180</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>R%<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">223</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">32</span>
<span class="token number">190</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>R%<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">239</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">16</span>
<span class="token number">200</span> <span class="token keyword">POKE</span> <span class="token number">53272</span><span class="token punctuation">,</span><span class="token punctuation">(</span>R%<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">120</span>
<span class="token number">210</span> <span class="token comment"><span class="token keyword">REM</span> BUCLE SALVA PANTALLAS</span>
<span class="token number">220</span> X<span class="token operator">=</span><span class="token number">0</span>  <span class="token punctuation">:</span> Y<span class="token operator">=</span><span class="token number">0</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COORDENADAS</span>
<span class="token number">230</span> VX<span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">:</span> VY<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> MOVIMIENTO</span>
<span class="token number">240</span> C<span class="token operator">=</span><span class="token number">1</span>  <span class="token punctuation">:</span> P<span class="token operator">=</span><span class="token number">1</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLORES</span>
<span class="token number">250</span> <span class="token comment"><span class="token keyword">REM</span> CALCULAR POSICION PIXEL</span>
<span class="token number">260</span> CX<span class="token operator">=</span><span class="token function">INT</span><span class="token punctuation">(</span>X<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLUMNA</span>
<span class="token number">270</span> DX<span class="token operator">=</span>X<span class="token operator">-</span>CX<span class="token operator">*</span><span class="token number">8</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SUBCOLUMNA</span>
<span class="token number">280</span> CY<span class="token operator">=</span><span class="token function">INT</span><span class="token punctuation">(</span>Y<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> FILA</span>
<span class="token number">290</span> DY<span class="token operator">=</span>Y<span class="token operator">-</span>CY<span class="token operator">*</span><span class="token number">8</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SUBFILA</span>
<span class="token number">300</span> CP<span class="token operator">=</span>CY<span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>CX <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> CELDA</span>
<span class="token number">310</span> <span class="token comment"><span class="token keyword">REM</span> MODIFICAR BUFFER PIXEL</span>
<span class="token number">320</span> ZZ<span class="token operator">=</span>PB<span class="token operator">+</span>CP<span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>DY
<span class="token number">330</span> CB%<span class="token operator">=</span>PEEK<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
<span class="token number">340</span> <span class="token keyword">IF</span> DX<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">AND</span> DX<span class="token operator">&lt;=</span><span class="token number">1</span> <span class="token keyword">THEN</span> CB%<span class="token operator">=</span><span class="token punctuation">(</span>CB% <span class="token operator">AND</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token operator">+</span>P<span class="token operator">*</span><span class="token number">64</span>
<span class="token number">350</span> <span class="token keyword">IF</span> DX<span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">AND</span> DX<span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token keyword">THEN</span> CB%<span class="token operator">=</span><span class="token punctuation">(</span>CB% <span class="token operator">AND</span> <span class="token number">207</span><span class="token punctuation">)</span><span class="token operator">+</span>P<span class="token operator">*</span><span class="token number">16</span>
<span class="token number">360</span> <span class="token keyword">IF</span> DX<span class="token operator">&gt;=</span><span class="token number">4</span> <span class="token operator">AND</span> DX<span class="token operator">&lt;=</span><span class="token number">5</span> <span class="token keyword">THEN</span> CB%<span class="token operator">=</span><span class="token punctuation">(</span>CB% <span class="token operator">AND</span> <span class="token number">243</span><span class="token punctuation">)</span><span class="token operator">+</span>P<span class="token operator">*</span><span class="token number">4</span>
<span class="token number">370</span> <span class="token keyword">IF</span> DX<span class="token operator">&gt;=</span><span class="token number">6</span> <span class="token operator">AND</span> DX<span class="token operator">&lt;=</span><span class="token number">7</span> <span class="token keyword">THEN</span> CB%<span class="token operator">=</span><span class="token punctuation">(</span>CB% <span class="token operator">AND</span> <span class="token number">252</span><span class="token punctuation">)</span><span class="token operator">+</span>P
<span class="token number">380</span> <span class="token keyword">POKE</span> ZZ<span class="token punctuation">,</span>CB%
<span class="token number">390</span> <span class="token comment"><span class="token keyword">REM</span> MODIFICAR BUFFER COLOR</span>
<span class="token number">400</span> <span class="token keyword">IF</span> P<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> ZZ<span class="token operator">=</span>SB<span class="token operator">+</span>CP <span class="token punctuation">:</span> <span class="token keyword">POKE</span> ZZ<span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">+</span>C<span class="token operator">*</span><span class="token number">16</span>
<span class="token number">410</span> <span class="token keyword">IF</span> P<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> ZZ<span class="token operator">=</span>SB<span class="token operator">+</span>CP <span class="token punctuation">:</span> <span class="token keyword">POKE</span> ZZ<span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token operator">+</span>C
<span class="token number">420</span> <span class="token keyword">IF</span> P<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">THEN</span> ZZ<span class="token operator">=</span>CB<span class="token operator">+</span>CP <span class="token punctuation">:</span> <span class="token keyword">POKE</span> ZZ<span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token operator">+</span>C
<span class="token number">430</span> P<span class="token operator">=</span>P<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token keyword">IF</span> P<span class="token operator">&gt;</span><span class="token number">3</span>  <span class="token keyword">THEN</span> P<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">440</span> C<span class="token operator">=</span>C<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token keyword">IF</span> C<span class="token operator">&gt;</span><span class="token number">15</span> <span class="token keyword">THEN</span> C<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">450</span> <span class="token comment"><span class="token keyword">REM</span> MOVER COORDENADAS</span>
<span class="token number">460</span> <span class="token keyword">IF</span> X<span class="token operator">&lt;=</span><span class="token number">0</span>   <span class="token keyword">THEN</span> X<span class="token operator">=</span><span class="token number">0</span>   <span class="token punctuation">:</span> VX<span class="token operator">=</span><span class="token number">2</span>
<span class="token number">470</span> <span class="token keyword">IF</span> X<span class="token operator">&gt;=</span><span class="token number">318</span> <span class="token keyword">THEN</span> X<span class="token operator">=</span><span class="token number">318</span> <span class="token punctuation">:</span> VX<span class="token operator">=</span><span class="token number">-2</span>
<span class="token number">480</span> <span class="token keyword">IF</span> Y<span class="token operator">&lt;=</span><span class="token number">0</span>   <span class="token keyword">THEN</span> Y<span class="token operator">=</span><span class="token number">0</span>   <span class="token punctuation">:</span> VY<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">490</span> <span class="token keyword">IF</span> Y<span class="token operator">&gt;=</span><span class="token number">199</span> <span class="token keyword">THEN</span> Y<span class="token operator">=</span><span class="token number">199</span> <span class="token punctuation">:</span> VY<span class="token operator">=</span><span class="token number">-1</span>
<span class="token number">500</span> X<span class="token operator">=</span>X<span class="token operator">+</span>VX <span class="token punctuation">:</span> Y<span class="token operator">=</span>Y<span class="token operator">+</span>VY
<span class="token number">510</span> <span class="token comment"><span class="token keyword">REM</span> COMPROBAR TECLADO</span>
<span class="token number">520</span> <span class="token keyword">GET</span> K$
<span class="token number">530</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">""</span> <span class="token keyword">THEN</span> <span class="token number">260</span>
<span class="token number">540</span> <span class="token comment"><span class="token keyword">REM</span> FINALIZAR PROGRAMA</span>
<span class="token number">550</span> <span class="token keyword">POKE</span> <span class="token number">56576</span><span class="token punctuation">,</span>R%<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">560</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span>R%<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">570</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span>R%<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">580</span> <span class="token keyword">POKE</span> <span class="token number">53272</span><span class="token punctuation">,</span>R%<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
<p>En <code>20</code>-<code>90</code> se cambian algunos colores y se guarda la configuración inicial del chip gráfico. En <code>120</code>-<code>150</code> se inicializa el buffer de píxeles para vaciarlo. En <code>170</code>-<code>200</code> se configura el chip gráfico para activar el modo bitmap multicolor, ubicando el buffer de píxeles en la segunda mitad del banco de memoria 1 ($6000-$7FFF) y el buffer de pantalla justo en los últimos 1024 bytes de la primera mitad ($5C00-$5FFF). En <code>260</code>-<code>300</code> se calcula la posición de la celda de la pantalla donde están las coordenadas <code>X</code> e <code>Y</code>. En <code>320</code>-<code>380</code> se calcula la posición en la memoria del bloque de píxeles a modificar, se modifica el valor y se guarda en la memoria. En <code>400</code>-<code>440</code> se actualiza los colores de pantalla. En <code>460</code>-<code>500</code> se mueven las coordenadas de pintado. Por último, en <code>520</code>-<code>530</code> se comprueba si se ha pulsado alguna tecla del teclado y en <code>550</code>-<code>580</code> se restaura la configuración inicial del chip gráfico.</p>
<blockquote>
<p><strong>AVISO:</strong> Al trabajar con BASIC hay que tener en cuenta que la <a href="https://www.c64-wiki.com/wiki/Memory_%28BASIC%29">memoria</a> ocupada por las cadenas de texto crece desde la dirección $9FFF hacia abajo. Analizando el ejemplo vemos que nos quedan 8.192 bytes para cadenas y 21.503 bytes para código BASIC, variables y arrays, hasta colisionar con el buffer de píxeles. En caso de colisión el programa puede desembocar en comportamientos inesperados y fallar en ejecución. Por ello hay que analizar con detenimiento la ubicación de los búferes del VIC-II.</p>
</blockquote>
<h3 id="gestión-de-sprites">Gestión de sprites</h3>
<p>Los <em>sprites</em> son un mecanismo del chip gráfico para pintar objetos en la pantalla que se pueden mover libremente. De este modo por un lado tenemos el fondo del escenario, representado por el buffer de pantalla o de píxeles, y por el otro las entidades que se mueven por la pantalla.</p>
<p>El C64 dispone de un máximo de <strong>8 <em>sprites</em></strong> por hardware, pero existe una técnica llamada <em>multiplexación de sprites</em> que permite por software aumentar la cantidad de <em>sprites</em> simultáneos por pantalla.</p>
<p>Para poder <strong>definir</strong> un <em><strong>sprite</strong></em> tenemos que definir su matriz de <strong>24x21 píxeles</strong>. Cada píxel se define usando un bit, por lo tanto cada fila de 24 píxeles se define con 3 bytes, y multiplicando por 21 filas necesitamos <strong>63 bytes</strong> en total. Sin embargo, para que el VIC-II pueda localizar cualquier <em>sprite</em> en el banco de memoria seleccionado, estas matrices de puntos han de ubicarse en <strong>direcciones</strong> que sean <strong>múltiplo</strong> de <strong>64</strong>. Haciendo las cuentas nos sale que, dentro de un banco de memoria de 16 KB, pueden almacenarse hasta <strong>256 <em>sprites</em></strong>. Obviamente es imposible tener 256 <em>sprites</em>, porque necesitamos al menos 3 KB para el buffer de pantalla y el juego de caracteres si usamos el modo carácter, con el modo bitmap son 9 KB los que necesitamos.</p>
<p>Sabemos que el <strong>buffer de pantalla</strong> ocupa 1.000 bytes, pero se ubica en direcciones que son múltiplo de 1.024, es decir, que quedan 24 bytes aparentemente libres. En realidad, los últimos <strong>8 bytes</strong> de la región donde se ubica el buffer de pantalla, se utilizan como <strong>punteros</strong> para que el VIC-II pueda localizar los <em><strong>sprites</strong></em> en el banco de memoria. En la configuración por defecto el buffer de pantalla se encuentra en las direcciones <strong>$0400-$07E7</strong>, por lo tanto los punteros están en las direcciones <strong>$07F8-$07FF</strong>, donde la primera dirección corresponde al <em>sprite</em> 0 y la última al <em>sprite</em> 7.</p>
<p>El VIC-II tiene los siguientes registros para configurar los <em>sprites</em>:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D015</td>
<td>Registro de activación de <em>sprites</em>:<br><strong>0</strong> = <em>Sprite</em> desactivado.<br><strong>1</strong> = <em>Sprite</em> activado.</td>
</tr>
<tr>
<td align="center">$D017</td>
<td>Registro de doble altura de <em>sprites</em>:<br><strong>0</strong> = Alto normal.<br><strong>1</strong> = Alto doble.</td>
</tr>
<tr>
<td align="center">$D01B</td>
<td>Registro de prioridad de <em>sprites</em>:<br><strong>0</strong> = Pintar delante de la pantalla.<br><strong>1</strong> = Pintar detrás de la pantalla.</td>
</tr>
<tr>
<td align="center">$D01C</td>
<td>Registro de modo multicolor de <em>sprites</em>:<br><strong>0</strong> = Modo monocolor.<br><strong>1</strong> = Modo multicolor.</td>
</tr>
<tr>
<td align="center">$D01D</td>
<td>Registro de doble anchura de <em>sprites</em>:<br><strong>0</strong> = Ancho normal.<br><strong>1</strong> = Ancho doble.</td>
</tr>
</tbody>
</table><p>El bit 0 corresponde al <em>sprite</em> 0 y así sucesivamente hasta llegar al bit 7 que corresponde al <em>sprite</em> 7. El registro de prioridad determina si el <em>sprite</em> se debe pintar encima del contenido del buffer de pantalla o detrás del mismo, pero por encima del color de fondo. Es decir, que si un <em>sprite</em> se pinta por detrás de la “pantalla”, este sólo será visible en aquellos píxeles que usen el color de fondo. Podemos alterar el ancho y el alto de un <em>sprite</em> duplicando sus dimensiones a la hora de ser pintado. Una vez configurado el <em>sprite</em> lo podemos activar para que sea pintado en pantalla.</p>
<p>Para poder mover por la pantalla los <em>sprites</em> el VIC-II necesita conocer las coordenadas y para ello tiene los siguientes registros:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D000</td>
<td>Coordenada X del <em>sprite</em> 0 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D001</td>
<td>Coordenada Y del <em>sprite</em> 0.</td>
</tr>
<tr>
<td align="center">$D002</td>
<td>Coordenada X del <em>sprite</em> 1 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D003</td>
<td>Coordenada Y del <em>sprite</em> 1.</td>
</tr>
<tr>
<td align="center">$D004</td>
<td>Coordenada X del <em>sprite</em> 2 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D005</td>
<td>Coordenada Y del <em>sprite</em> 2.</td>
</tr>
<tr>
<td align="center">$D006</td>
<td>Coordenada X del <em>sprite</em> 3 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D007</td>
<td>Coordenada Y del <em>sprite</em> 3.</td>
</tr>
<tr>
<td align="center">$D008</td>
<td>Coordenada X del <em>sprite</em> 4 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D009</td>
<td>Coordenada Y del <em>sprite</em> 4.</td>
</tr>
<tr>
<td align="center">$D00A</td>
<td>Coordenada X del <em>sprite</em> 5 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D00B</td>
<td>Coordenada Y del <em>sprite</em> 5.</td>
</tr>
<tr>
<td align="center">$D00C</td>
<td>Coordenada X del <em>sprite</em> 6 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D00D</td>
<td>Coordenada Y del <em>sprite</em> 6.</td>
</tr>
<tr>
<td align="center">$D00E</td>
<td>Coordenada X del <em>sprite</em> 7 (bits del 0-7).</td>
</tr>
<tr>
<td align="center">$D00F</td>
<td>Coordenada Y del <em>sprite</em> 7.</td>
</tr>
<tr>
<td align="center">$D010</td>
<td>Bit 8 de la coordenada X de los <em>sprites</em> 0-7.</td>
</tr>
</tbody>
</table><p>El <strong>eje X</strong> va desde el valor <strong>0</strong> al <strong>511</strong>, pero como un byte sólo contiene 256 valores hace falta un bit extra, que es el que se almacena en la dirección $D010. El <strong>eje Y</strong> va desde el valor <strong>0</strong> al <strong>255</strong>. Por lo tanto, tenemos coordenadas que van de la posición <strong>(0,0)</strong>, en la esquina superior izquierda, a la <strong>(511,255)</strong>, en la esquina inferior derecha. Sin embargo, no todas las coordenadas son visibles en la pantalla, el <strong>área visible</strong> va desde la posición <strong>(24,50)</strong> a la <strong>(343,249)</strong>, que tiene unas dimensiones de <strong>320x200 píxeles</strong>.</p>
<p>Otra información que necesita el VIC-II es la información sobre los colores de los <em>sprites</em>. Para ello se usan los siguientes registros:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D025</td>
<td>Color extra 1 de <em>sprites</em>.</td>
</tr>
<tr>
<td align="center">$D026</td>
<td>Color extra 2 de <em>sprites</em>.</td>
</tr>
<tr>
<td align="center">$D027</td>
<td>Color del <em>sprite</em> 0.</td>
</tr>
<tr>
<td align="center">$D028</td>
<td>Color del <em>sprite</em> 1.</td>
</tr>
<tr>
<td align="center">$D029</td>
<td>Color del <em>sprite</em> 2.</td>
</tr>
<tr>
<td align="center">$D02A</td>
<td>Color del <em>sprite</em> 3.</td>
</tr>
<tr>
<td align="center">$D02B</td>
<td>Color del <em>sprite</em> 4.</td>
</tr>
<tr>
<td align="center">$D02C</td>
<td>Color del <em>sprite</em> 5.</td>
</tr>
<tr>
<td align="center">$D02D</td>
<td>Color del <em>sprite</em> 6.</td>
</tr>
<tr>
<td align="center">$D02E</td>
<td>Color del <em>sprite</em> 7.</td>
</tr>
</tbody>
</table><p>Dependiendo de si el <em>sprite</em> está en modo <strong>monocolor</strong> o <strong>multicolor</strong>, tenemos dos o cuatro colores posibles. Como ya sospechará el lector, el modo multicolor agrupa los píxeles en bloques de dos, haciendo uso de los “píxeles gordos” que vimos en los modos gráficos. Por lo tanto, los valores de los píxeles son:</p>
<ul>
<li><strong>Modo estándar:</strong>
<ul>
<li><strong>0</strong> = Color transparente.</li>
<li><strong>1</strong> = Color del <em>sprite</em> (<strong>$D027-$D02E</strong>).</li>
</ul>
</li>
<li><strong>Modo multicolor:</strong>
<ul>
<li><strong>00</strong> = Color transparente.</li>
<li><strong>01</strong> = Color extra 1 (<strong>$D025</strong>).</li>
<li><strong>10</strong> = Color del <em>sprite</em> (<strong>$D027-$D02E</strong>).</li>
<li><strong>11</strong> = Color extra 2 (<strong>$D026</strong>).</li>
</ul>
</li>
</ul>
<p>El siguiente ejemplo muestra cómo trabajar con <em>sprites</em></p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR COLORES</span>
<span class="token number">20</span>  <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span><span class="token number">12</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR BORDE</span>
<span class="token number">30</span>  <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span><span class="token number">0</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR FONDO</span>
<span class="token number">40</span>  <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">1</span>     <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR CURSOR</span>
<span class="token number">50</span>  <span class="token keyword">POKE</span> <span class="token number">53285</span><span class="token punctuation">,</span><span class="token number">15</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITES EX1</span>
<span class="token number">60</span>  <span class="token keyword">POKE</span> <span class="token number">53286</span><span class="token punctuation">,</span><span class="token number">12</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITES EX2</span>
<span class="token number">70</span>  <span class="token keyword">POKE</span> <span class="token number">53287</span><span class="token punctuation">,</span><span class="token number">1</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 0</span>
<span class="token number">80</span>  <span class="token keyword">POKE</span> <span class="token number">53288</span><span class="token punctuation">,</span><span class="token number">2</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 1</span>
<span class="token number">90</span>  <span class="token keyword">POKE</span> <span class="token number">53289</span><span class="token punctuation">,</span><span class="token number">5</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 2</span>
<span class="token number">100</span> <span class="token keyword">POKE</span> <span class="token number">53290</span><span class="token punctuation">,</span><span class="token number">6</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 3</span>
<span class="token number">110</span> <span class="token keyword">POKE</span> <span class="token number">53291</span><span class="token punctuation">,</span><span class="token number">1</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 4</span>
<span class="token number">120</span> <span class="token keyword">POKE</span> <span class="token number">53292</span><span class="token punctuation">,</span><span class="token number">2</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 5</span>
<span class="token number">130</span> <span class="token keyword">POKE</span> <span class="token number">53293</span><span class="token punctuation">,</span><span class="token number">5</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 6</span>
<span class="token number">140</span> <span class="token keyword">POKE</span> <span class="token number">53294</span><span class="token punctuation">,</span><span class="token number">6</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR SPRITE 7</span>
<span class="token number">150</span> <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR COORDENADAS</span>
<span class="token number">160</span> <span class="token keyword">POKE</span> <span class="token number">53248</span><span class="token punctuation">,</span><span class="token number">79</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X0</span>
<span class="token number">170</span> <span class="token keyword">POKE</span> <span class="token number">53249</span><span class="token punctuation">,</span><span class="token number">90</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y0</span>
<span class="token number">180</span> <span class="token keyword">POKE</span> <span class="token number">53250</span><span class="token punctuation">,</span><span class="token number">141</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X1</span>
<span class="token number">190</span> <span class="token keyword">POKE</span> <span class="token number">53251</span><span class="token punctuation">,</span><span class="token number">90</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y1</span>
<span class="token number">200</span> <span class="token keyword">POKE</span> <span class="token number">53252</span><span class="token punctuation">,</span><span class="token number">203</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X2</span>
<span class="token number">210</span> <span class="token keyword">POKE</span> <span class="token number">53253</span><span class="token punctuation">,</span><span class="token number">90</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y2</span>
<span class="token number">220</span> <span class="token keyword">POKE</span> <span class="token number">53254</span><span class="token punctuation">,</span><span class="token number">9</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X3 (265)</span>
<span class="token number">230</span> <span class="token keyword">POKE</span> <span class="token number">53255</span><span class="token punctuation">,</span><span class="token number">90</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y3</span>
<span class="token number">240</span> <span class="token keyword">POKE</span> <span class="token number">53256</span><span class="token punctuation">,</span><span class="token number">79</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X4</span>
<span class="token number">250</span> <span class="token keyword">POKE</span> <span class="token number">53257</span><span class="token punctuation">,</span><span class="token number">197</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y4</span>
<span class="token number">260</span> <span class="token keyword">POKE</span> <span class="token number">53258</span><span class="token punctuation">,</span><span class="token number">141</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X5</span>
<span class="token number">270</span> <span class="token keyword">POKE</span> <span class="token number">53259</span><span class="token punctuation">,</span><span class="token number">197</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y5</span>
<span class="token number">280</span> <span class="token keyword">POKE</span> <span class="token number">53260</span><span class="token punctuation">,</span><span class="token number">203</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X6</span>
<span class="token number">290</span> <span class="token keyword">POKE</span> <span class="token number">53261</span><span class="token punctuation">,</span><span class="token number">197</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y6</span>
<span class="token number">300</span> <span class="token keyword">POKE</span> <span class="token number">53262</span><span class="token punctuation">,</span><span class="token number">9</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X7 (265)</span>
<span class="token number">310</span> <span class="token keyword">POKE</span> <span class="token number">53263</span><span class="token punctuation">,</span><span class="token number">197</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE Y7</span>
<span class="token number">320</span> <span class="token keyword">POKE</span> <span class="token number">53264</span><span class="token punctuation">,</span><span class="token number">136</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SPRITE X0-7 (B8)</span>
<span class="token number">330</span> <span class="token comment"><span class="token keyword">REM</span> CARGAR SPRITE EN MEMORIA</span>
<span class="token number">340</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">350</span> <span class="token keyword">POKE</span> <span class="token number">2040</span><span class="token operator">+</span>I<span class="token punctuation">,</span><span class="token number">255</span>
<span class="token number">360</span> <span class="token keyword">NEXT</span> I
<span class="token number">370</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">62</span>
<span class="token number">380</span> <span class="token keyword">READ</span> A%
<span class="token number">390</span> <span class="token keyword">POKE</span> <span class="token number">16320</span><span class="token operator">+</span>I<span class="token punctuation">,</span>A%
<span class="token number">400</span> <span class="token keyword">NEXT</span> I
<span class="token number">410</span> <span class="token comment"><span class="token keyword">REM</span> CONFIGURAR SPRITES</span>
<span class="token number">420</span> <span class="token keyword">POKE</span> <span class="token number">53271</span><span class="token punctuation">,</span><span class="token number">0</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ALTO DOBLE SPRITES</span>
<span class="token number">430</span> <span class="token keyword">POKE</span> <span class="token number">53277</span><span class="token punctuation">,</span><span class="token number">0</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ANCHO DOBLE SPRITES</span>
<span class="token number">440</span> <span class="token keyword">POKE</span> <span class="token number">53275</span><span class="token punctuation">,</span><span class="token number">0</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> PRIORIDAD SPRITES</span>
<span class="token number">450</span> <span class="token keyword">POKE</span> <span class="token number">53276</span><span class="token punctuation">,</span><span class="token number">240</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> MODO COLOR SPRITES</span>
<span class="token number">460</span> <span class="token keyword">POKE</span> <span class="token number">53269</span><span class="token punctuation">,</span><span class="token number">255</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ACTIVAR SPRITES</span>
<span class="token number">470</span> <span class="token comment"><span class="token keyword">REM</span> PINTAR TEXTO PANTALLA</span>
<span class="token number">480</span> <span class="token function">PRINT</span> "{<span class="token number">147</span>}" <span class="token punctuation">:</span> <span class="token function">PRINT</span>
<span class="token number">490</span> <span class="token function">PRINT</span> "              {white}sprites test"
<span class="token number">500</span> <span class="token function">PRINT</span> "{pink}"
<span class="token number">510</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">TO</span> <span class="token number">18</span>
<span class="token number">520</span> <span class="token function">PRINT</span> "      {<span class="token number">191</span><span class="token operator">*</span><span class="token number">28</span>}"
<span class="token number">530</span> <span class="token keyword">NEXT</span> I
<span class="token number">540</span> <span class="token function">PRINT</span> "{white}"
<span class="token number">550</span> <span class="token comment"><span class="token keyword">REM</span> GESTION TECLADO</span>
<span class="token number">560</span> <span class="token keyword">GET</span> K$
<span class="token number">570</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F1}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53271</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">580</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F2}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53271</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">590</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F3}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53277</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">600</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F4}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53277</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">610</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F5}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53275</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">620</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span>"{F6}" <span class="token keyword">THEN</span> <span class="token keyword">POKE</span> <span class="token number">53275</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">630</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"Q"</span> <span class="token operator">OR</span> K$<span class="token operator">=</span><span class="token string">" "</span> <span class="token keyword">THEN</span> <span class="token number">660</span>
<span class="token number">640</span> <span class="token keyword">GOTO</span> <span class="token number">560</span>
<span class="token number">650</span> <span class="token comment"><span class="token keyword">REM</span> FINALIZAR PROGRAMA</span>
<span class="token number">660</span> <span class="token keyword">POKE</span> <span class="token number">53269</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">670</span> <span class="token function">PRINT</span> "{<span class="token number">147</span>}"
<span class="token number">680</span> <span class="token comment"><span class="token keyword">REM</span> SEÑOR CARTA (255:16320)</span>
<span class="token number">690</span> <span class="token keyword">DATA</span> <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span>
<span class="token number">700</span> <span class="token keyword">DATA</span> <span class="token number">192</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token number">710</span> <span class="token keyword">DATA</span> <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token number">720</span> <span class="token keyword">DATA</span> <span class="token number">144</span><span class="token punctuation">,</span><span class="token number">195</span><span class="token punctuation">,</span><span class="token number">9</span>
<span class="token number">730</span> <span class="token keyword">DATA</span> <span class="token number">136</span><span class="token punctuation">,</span><span class="token number">195</span><span class="token punctuation">,</span><span class="token number">17</span>
<span class="token number">740</span> <span class="token keyword">DATA</span> <span class="token number">132</span><span class="token punctuation">,</span><span class="token number">195</span><span class="token punctuation">,</span><span class="token number">33</span>
<span class="token number">750</span> <span class="token keyword">DATA</span> <span class="token number">130</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">65</span>
<span class="token number">760</span> <span class="token keyword">DATA</span> <span class="token number">145</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">137</span>
<span class="token number">770</span> <span class="token keyword">DATA</span> <span class="token number">168</span><span class="token punctuation">,</span><span class="token number">129</span><span class="token punctuation">,</span><span class="token number">21</span>
<span class="token number">780</span> <span class="token keyword">DATA</span> <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token number">790</span> <span class="token keyword">DATA</span> <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token number">800</span> <span class="token keyword">DATA</span> <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token number">810</span> <span class="token keyword">DATA</span> <span class="token number">152</span><span class="token punctuation">,</span><span class="token number">129</span><span class="token punctuation">,</span><span class="token number">25</span>
<span class="token number">820</span> <span class="token keyword">DATA</span> <span class="token number">129</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">129</span>
<span class="token number">830</span> <span class="token keyword">DATA</span> <span class="token number">130</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">65</span>
<span class="token number">840</span> <span class="token keyword">DATA</span> <span class="token number">132</span><span class="token punctuation">,</span><span class="token number">126</span><span class="token punctuation">,</span><span class="token number">33</span>
<span class="token number">850</span> <span class="token keyword">DATA</span> <span class="token number">136</span><span class="token punctuation">,</span><span class="token number">129</span><span class="token punctuation">,</span><span class="token number">17</span>
<span class="token number">860</span> <span class="token keyword">DATA</span> <span class="token number">144</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">9</span>
<span class="token number">870</span> <span class="token keyword">DATA</span> <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token number">880</span> <span class="token keyword">DATA</span> <span class="token number">192</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token number">890</span> <span class="token keyword">DATA</span> <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span>
</code></pre>
<p>Primero se inicializan los colores, coordenadas, la matriz de píxeles del <em>sprite</em> y se termina de configurar todos los ocho <em>sprites</em> del hardware. Segundo se pinta en la pantalla un texto para poder comprobar el cambio de prioridad en el <em>sprite</em> 0. Con la gestión del teclado cambiamos algunas propiedades gráficas del <em>sprite</em> 0. Lo siguiente es desactivar los <em>sprites</em> en <code>660</code> y limpiar la pantalla. El último bloque son byte a byte la definición de la matriz de píxeles del <em>sprite</em>.</p>
<h3 id="interrupciones-gráficas">Interrupciones gráficas</h3>
<p>Existen varios elementos que pueden generar interrupciones en el chip VIC-II, para ello necesitamos tener en cuenta las siguientes direcciones de memoria:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D011<br>(Bit 7)</td>
<td>Lectura: Línea actual del <em>raster</em> (bit 8).<br>Escritura: Línea de interrupción del <em>raster</em> (bit 8).</td>
</tr>
<tr>
<td align="center">$D012</td>
<td>Lectura: Línea actual del <em>raster</em> (bits 0-7).<br>Escritura: Línea de interrupción del <em>raster</em> (bits 0-7).</td>
</tr>
<tr>
<td align="center">$D019</td>
<td>Registro de estado de interrupciones.<br>Lectura:<br>+ <strong>Bit 0:</strong> <strong>1</strong> = Línea de interrupción del <em>raster</em> alcanzada.<br>+ <strong>Bit 1:</strong> <strong>1</strong> = Colisión <em>sprite</em>-fondo.<br>+ <strong>Bit 2:</strong> <strong>1</strong> = Colisión <em>sprite</em>-<em>sprite</em>.<br>+ <strong>Bit 7:</strong> <strong>1</strong> = Interrupción generada sin admitir.<br>Escritura:<br>+ <strong>Bit 0:</strong> <strong>1</strong> = Admitir interrupción de <em>raster</em>.<br>+ <strong>Bit 1:</strong> <strong>1</strong> = Admitir interrupción de colisión <em>sprite</em>-fondo.<br>+ <strong>Bit 2:</strong> <strong>1</strong> = Admitir interrupción de colisión <em>sprite</em>-<em>sprite</em>.</td>
</tr>
<tr>
<td align="center">$D01A</td>
<td>Registro de control de interrupciones:<br>+ <strong>Bit 0:</strong> <strong>1</strong> = Activar interrupciones de <em>raster</em>.<br>+ <strong>Bit 1:</strong> <strong>1</strong> = Activar interrupciones de colisión <em>sprite</em>-fondo.<br>+ <strong>Bit 2:</strong> <strong>1</strong> = Activar interrupciones de colisión <em>sprite</em>-<em>sprite</em>.</td>
</tr>
<tr>
<td align="center">$D01E</td>
<td>Registro de colisión <em>sprite</em>-<em>sprite</em>.<br>Lectura: <strong>1</strong> = El <em>sprite</em> ha colisionado con otro <em>sprite</em>.<br>Escritura: <strong>1</strong> = Activar la detección de colisiones.</td>
</tr>
<tr>
<td align="center">$D01F</td>
<td>Registro de colisión <em>sprite</em>-fondo.<br>Lectura: <strong>1</strong> = El <em>sprite</em> ha colisionado con el fondo.<br>Escritura: <strong>1</strong> = Activar la detección de colisiones.</td>
</tr>
</tbody>
</table><p>Podemos controlar mediante interrupciones la localización del <em>raster</em> y las colisiones de los <em>sprites</em>. Una vez configurados los registros del chip gráfico, se deberá configurar la gestión de las interrupciones indicando en $0314-$0315 la dirección de la subrutina encargada de ello. Por defecto el sistema tiene una subrutina en $EA31 para procesar interrupciones.</p>
<p>El <em><strong>raster</strong></em> representa el <a href="https://es.wikipedia.org/wiki/Rayos_cat%C3%B3dicos">rayo catódico</a>, en los <a href="https://es.wikipedia.org/wiki/Tubo_de_rayos_cat%C3%B3dicos">monitores CRT</a>, que recorre la pantalla actualizando cada punto de la imagen. La actualización recorre cada línea de la pantalla, de izquierda a derecha, y lo hace a una frecuencia de 50/60 Hz (PAL/NTSC). A partir de la <strong>línea 250</strong>, el rayo está fuera de la zona visible del VIC-II, limitándose a pintar el color del borde de la pantalla. Activando las interrupciones del <em>raster</em>, podemos actualizar la zona visible de la pantalla mientras no se esté actualizando el monitor, evitando así que parpadeen los gráficos de forma molesta. Para lograrlo hay que escribir, en los registros en <strong>$D011</strong> (bit 7) y <strong>$D012</strong>, el número de línea que debe generar la interrupción. Luego se activa el <strong>bit 0</strong> del registro <strong>$D01A</strong> y cuando se invoque la rutina de gestión de interrupciones se consulta el <strong>bit 0</strong> de <strong>$D019</strong> para saber si ha sido la causa de la interrupción actual, para finalmente escribir un <strong>1</strong> en el <strong>bit 0</strong> para comunicar que la interrupción ha sido admitida.</p>
<p>En un acto visionario, varias décadas antes, el chip gráfico del C64 nos alerta si un <em>sprite</em> ha colisionado con otro <em>sprite</em> o con el contenido de la pantalla. La <strong>colisión</strong> consiste en detectar si uno o más <strong>píxeles activos</strong>, es decir, que no valgan cero, de un <em><strong>sprite</strong></em> ocupan la misma posición que otros píxeles activos. Para ello, tenemos que activar en <strong>$D01E</strong> y/o <strong>$D01F</strong> los <em>sprites</em> que queremos vigilar. Una vez activado podemos consultar estos dos registros para comprobar si ha colisionado los <em>sprites</em> que hemos activado, si necesidad obligatoria de usar interrupciones. Una limitación de este mecanismo es, en caso de haber una colisión múltiple, que no sabremos con qué otro <em>sprite</em> ha colisionado. No obstante, es de gran utilidad esta herramienta. Si queremos utilizar interrupciones con las colisiones, tenemos que activar los bits correspondientes en el registro <strong>$D01A</strong>. Entonces, cuando se invoque la rutina de gestión de interrupciones, consultaremos en <strong>$D019</strong> los <strong>bits 1</strong> y <strong>2</strong>, para después escribir un <strong>1</strong> en ellos cuando queramos avisar al VIC-II que la interrupción ha sido admitida.</p>
<blockquote>
<p><strong>AVISO:</strong> A diferencia de otras interrupciones, por ejemplo las provocadas por las CIA1 y CIA2, las generadas por el VIC-II requieren escribir en el registro $D019 el valor 1 en aquellos bits de las interrupciones que hayamos gestionado. Si no se realiza esta acción, se seguirá invocando la rutina de gestión de interrupciones continuamente. Si sólo se van a manejar interrupciones del <em>raster</em>, se puede utilizar la instrucción <code>LSR</code> y comprobar con <code>BCS</code> si en efecto se ha producido una interrupción por el <em>raster</em>. El motivo por el que esto funciona es porque la instrucción <code>LSR</code>, que tiene 6 ciclos de ejecución, en el 4º lee de la memoria el valor, en el 5º escribe el valor leído en la memoria y rota el valor, y en el 6º escribe el nuevo valor obtenido.</p>
</blockquote>
<h3 id="desplazamiento-de-pantalla">Desplazamiento de pantalla</h3>
<p>Muchos juegos requieren desplazar la pantalla (<em>scroll</em>) para ir recorriendo los niveles. Dada las limitaciones de velocidad, que había en la época, el C64 dispone de un mecanismo especial para facilitar el movimiento de la pantalla. Entonces, tenemos dos registros en memoria:</p>

<table>
<thead>
<tr>
<th align="center">Bits</th>
<th>$D011</th>
<th>$D016</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0-2</strong></td>
<td>Desplazamiento horizontal raster.</td>
<td>Desplazamiento vertical raster.</td>
</tr>
<tr>
<td align="center"><strong>3</strong></td>
<td>Altura pantalla (<strong>0</strong> = 24; <strong>1</strong> = 25).</td>
<td>Ancho pantalla (<strong>0</strong> = 38; <strong>1</strong> = 40).</td>
</tr>
</tbody>
</table><p>Ya vimos previamente estos dos registros, pues se utilizan también para configurar los modos gráficos del VIC-II. Ahora lo que nos interesa es que podemos cambiar el tamaño de la pantalla, que por defecto es una tabla de 40x25 celdas. Podemos reducir con el <strong>bit 3</strong> de <strong>$D011</strong> a <strong>24 filas</strong> la pantalla y con el de <strong>$D016</strong> a <strong>38 columnas</strong>. En ambos registros, los <strong>bits 0-2</strong> controlan el <strong>desplazamiento</strong> de la pantalla a la hora de pintarla en el monitor, que serían de <strong>0 a 7 píxeles</strong>, que se traduce en:</p>

<table>
<thead>
<tr>
<th align="center"><em>Scroll</em></th>
<th align="center">Columnas</th>
<th align="center">Filas</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0 px</td>
<td align="center">Visibles: 1-38<br>Ocultas: 0 y 39</td>
<td align="center">Visibles: 1-24<br>Oculta: 0</td>
</tr>
<tr>
<td align="center">7 px</td>
<td align="center">Visibles: 0-37<br>Ocultas: 38 y 39</td>
<td align="center">Visibles: 0-23<br>Oculta: 24</td>
</tr>
</tbody>
</table><p>De este modo podemos mover en una dirección determinada y al alcanzar el tope, desplazar el contenido, meter la nueva fila o columna en el lateral correspondiente y restaurar a la posición de desplazamiento inicial, para volver a repetir el ciclo de movimiento:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th align="center"><em>Scroll</em> inicial</th>
<th align="center"><em>Scroll</em> final</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Abajo/Derecha</td>
<td align="center">0</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">Arriba/Izquierda</td>
<td align="center">7</td>
<td align="center">0</td>
</tr>
</tbody>
</table><p>Para verlo en acción, tenemos el siguiente ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> PINTAR PANTALLA</span>
<span class="token number">20</span>  <span class="token function">PRINT</span> "{<span class="token keyword">clear</span>}{white}{<span class="token number">215</span><span class="token operator">*</span><span class="token number">40</span>}"<span class="token punctuation">;</span>
<span class="token number">30</span>  <span class="token function">PRINT</span> "{<span class="token number">215</span>}{<span class="token number">209</span><span class="token operator">*</span><span class="token number">38</span>}{<span class="token number">215</span>}"<span class="token punctuation">;</span>
<span class="token number">40</span>  <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">TO</span> <span class="token number">21</span>
<span class="token number">50</span>  <span class="token function">PRINT</span> "{<span class="token number">215</span>}{<span class="token number">209</span>}{space<span class="token operator">*</span><span class="token number">36</span>}{<span class="token number">209</span>}{<span class="token number">215</span>}"<span class="token punctuation">;</span>
<span class="token number">60</span>  <span class="token keyword">NEXT</span> I
<span class="token number">70</span>  <span class="token function">PRINT</span> "{<span class="token number">215</span>}{<span class="token number">209</span><span class="token operator">*</span><span class="token number">38</span>}{<span class="token number">215</span>}"<span class="token punctuation">;</span>
<span class="token number">80</span>  <span class="token function">PRINT</span> "{<span class="token number">215</span><span class="token operator">*</span><span class="token number">39</span>}"<span class="token punctuation">;</span>
<span class="token number">90</span>  <span class="token keyword">POKE</span> <span class="token number">2023</span><span class="token punctuation">,</span><span class="token number">87</span>
<span class="token number">100</span> <span class="token keyword">POKE</span> <span class="token number">56295</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">110</span> <span class="token comment"><span class="token keyword">REM</span> CONFIGURAR PANTALLA</span>
<span class="token number">120</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span>
<span class="token number">130</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span>
<span class="token number">140</span> <span class="token comment"><span class="token keyword">REM</span> BUCLE DEL MOVIMIENTO</span>
<span class="token number">150</span> D<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span>M<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">160</span> <span class="token keyword">GET</span> K$
<span class="token number">170</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">" "</span> <span class="token keyword">THEN</span> <span class="token number">350</span>
<span class="token number">180</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"1"</span> <span class="token keyword">THEN</span> M<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">190</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">"2"</span> <span class="token keyword">THEN</span> M<span class="token operator">=</span><span class="token number">0</span>
<span class="token number">200</span> <span class="token keyword">IF</span> M<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token number">160</span>
<span class="token number">210</span> <span class="token keyword">IF</span> D<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">53265</span><span class="token punctuation">:</span>LM<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token keyword">GOSUB</span> <span class="token number">280</span>
<span class="token number">220</span> <span class="token keyword">IF</span> D<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">53270</span><span class="token punctuation">:</span>LM<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token keyword">GOSUB</span> <span class="token number">280</span>
<span class="token number">230</span> <span class="token keyword">IF</span> D<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">53265</span><span class="token punctuation">:</span>LM<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">GOSUB</span> <span class="token number">280</span>
<span class="token number">240</span> <span class="token keyword">IF</span> D<span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">THEN</span> MD<span class="token operator">=</span><span class="token number">53270</span><span class="token punctuation">:</span>LM<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">GOSUB</span> <span class="token number">280</span>
<span class="token number">250</span> <span class="token keyword">IF</span> D<span class="token operator">&gt;</span><span class="token number">4</span> <span class="token keyword">THEN</span> D<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">260</span> <span class="token keyword">GOTO</span> <span class="token number">160</span>
<span class="token number">270</span> <span class="token comment"><span class="token keyword">REM</span> MOVER DESPLAZAMIENTO</span>
<span class="token number">280</span> V<span class="token operator">=</span>PEEK<span class="token punctuation">(</span>MD<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">7</span>
<span class="token number">290</span> <span class="token keyword">IF</span> LM<span class="token operator">=</span><span class="token number">7</span> <span class="token operator">AND</span> V<span class="token operator">&lt;</span><span class="token number">7</span> <span class="token keyword">THEN</span> V<span class="token operator">=</span>V<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">300</span> <span class="token keyword">IF</span> LM<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> V<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">THEN</span> V<span class="token operator">=</span>V<span class="token operator">-</span><span class="token number">1</span>
<span class="token number">310</span> <span class="token keyword">POKE</span> MD<span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span>MD<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">248</span><span class="token punctuation">)</span><span class="token operator">+</span>V
<span class="token number">320</span> <span class="token keyword">IF</span> V<span class="token operator">=</span>LM <span class="token keyword">THEN</span> D<span class="token operator">=</span>D<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">330</span> <span class="token keyword">RETURN</span>
<span class="token number">340</span> <span class="token comment"><span class="token keyword">REM</span> FINALIZAR PROGRAMA</span>
<span class="token number">350</span> <span class="token keyword">POKE</span> <span class="token number">53265</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53265</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">8</span>
<span class="token number">360</span> <span class="token keyword">POKE</span> <span class="token number">53270</span><span class="token punctuation">,</span><span class="token punctuation">(</span>PEEK<span class="token punctuation">(</span><span class="token number">53270</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token number">240</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">8</span>
</code></pre>
<p>Después de pintar y configurar la pantalla, podemos con el teclado activar o desactivar el movimiento. Cuando está activado el movimiento (<code>M=1</code>), dependiendo de la dirección se accederá a uno de los dos registros y se tendrá como límite el valor <code>0</code> o el <code>7</code>, se hacen los cálculos para actualizar el desplazamiento actual y si hay que cambiar de dirección, para repetir el bucle. Si se sale de la aplicación, pulsando espacio, se restaura la configuración de pantalla anterior.</p>
<h2 id="interfaz-sonora">Interfaz sonora</h2>
<p>El chip <a href="https://www.c64-wiki.com/wiki/SID">SID</a> se encarga de las capacidades sonoras del C64. Debido a sus avanzadas prestaciones, para lo que era común entre las máquinas de la época, gozó de gran popularidad y prestigio. Como resultado, ha tenido una gran influencia en el mundo de la <a href="https://en.wikipedia.org/wiki/Demoscene"><em>demoscene</em></a> y del <a href="https://en.wikipedia.org/wiki/Chiptune"><em>chiptune</em></a>.</p>
<h3 id="síntesis-de-sonido">Síntesis de sonido</h3>
<p>Antes de explicar cómo funciona el chip de sonido, vamos a introducir algunos conceptos básicos sobre la síntesis de sonido. A modo de resumen, el sonido es un tipo de <a href="https://es.wikipedia.org/wiki/Onda_sonora">onda</a> que se propaga por el aire, provocando variaciones en la presión que el cerebro interpreta como sonidos. Las <strong>ondas sonoras</strong> se pueden expresar como funciones matemáticas, algunas de ellas en relación a la posición y otras al tiempo. Las magnitudes físicas que cambian con el paso del tiempo y se emplean para transportar información se las conoce también como <strong>señales</strong>. Hay señales que son analógicas, que son <a href="https://es.wikipedia.org/wiki/Funci%C3%B3n_continua">funciones continuas</a>, y otras que son digitales, que son <a href="https://es.wikipedia.org/wiki/Funci%C3%B3n_discreta">funciones discretas</a>. Por lo tanto, el sonido es un tipo de señal analógica, aunque se pueda digitalizar.</p>
<p>Existen varias propiedades que definen una señal. La <strong>amplitud</strong> o <strong>volumen</strong> nos indica la fuerza del sonido. La <strong>frecuencia</strong> es el número de repeticiones por unidad de tiempo que tiene la onda sonora. Además, toda señal se puede descomponer en diferentes frecuencias, teniendo por un lado una frecuencia principal <em>F</em> y por el otro múltiplos de dicha <em>F</em>, que son sus <strong>armónicos</strong>.</p>
<p>El <strong>timbre</strong>, o estructura de armónicos, depende de los armónicos que tenga el sonido y el nivel de energía de cada uno de ellos. Cada instrumento musical dispone de un timbre característico propio. El timbre y la forma de onda se relacionan entre sí. Algunas de las formas de onda básicas que tenemos son:</p>
<p align="center"><img src="https://gorkinovich.github.io/learn/Sound-Waveforms.png" alt="Formas de onda"></p>
<p>Otra propiedad de la señal es su <strong>dinámica</strong>, que define la evolución temporal de cada nota. El volumen no suele ser fijo durante la duración de una nota, sino que puede variar con el tiempo. Este comportamiento se modela usando una <strong>envolvente ADSR</strong>:</p>
<p align="center"><img src="https://gorkinovich.github.io/learn/Sound-ADSR.png" alt="Envolvente del sonido"></p>
<ul>
<li>El <strong>ataque</strong> o <em><strong>attack</strong></em> es el tiempo que tarda un sonido en alcanzar su máxima amplitud al pulsar una nota.</li>
<li>La <strong>decadencia</strong> o <em><strong>decay</strong></em> es el tiempo que tarda en decaer la amplitud hasta el nivel en el que se mantiene estabilizado la nota.</li>
<li>La <strong>suspensión</strong> o <em><strong>sustain</strong></em> es el nivel de amplitud que tiene el sonido en su fase estable.</li>
<li>La <strong>liberación</strong> o <em><strong>release</strong></em> es el tiempo que tarda el sonido en perder toda su amplitud al soltar la nota.</li>
</ul>
<p>Dentro del mundo de la <a href="https://en.wikipedia.org/wiki/Synthesizer">síntesis</a> de sonido hay diferentes modelos de generación. Por ejemplo, tenemos la <a href="https://en.wikipedia.org/wiki/Frequency_modulation_synthesis">síntesis FM</a>, popularizada por Yamaha, que se incorporó en consolas como la <a href="https://en.wikipedia.org/wiki/Sega_Genesis">Mega Drive</a> y que fue muy popular en la música de los años 80 con instrumentos como el <a href="https://en.wikipedia.org/wiki/Yamaha_DX7">DX7</a>. Pero el chip SID está en la familia de la <a href="https://en.wikipedia.org/wiki/Subtractive_synthesis">síntesis substractiva</a>, que es uno de los modelos más estándar de síntesis en instrumentos musicales, como es el caso del <a href="https://en.wikipedia.org/wiki/Minimoog">Minimoog</a>, el <a href="https://en.wikipedia.org/wiki/Korg_MS-20">MS-20</a> o el <a href="https://en.wikipedia.org/wiki/Roland_Jupiter-8">Jupiter-8</a>, entre muchos otros. Esta forma de trabajar recibe una onda sonora y modifica su timbre seleccionando un filtro, para eliminar algunas de sus frecuencias. Algunos de los filtros elementales que existen son:</p>
<p align="center"><img src="https://gorkinovich.github.io/learn/Sound-Filters.png" alt="Filtrado de frecuencias"></p>
<ul>
<li><strong>Filtro de paso bajo (LPF):</strong> Deja pasar aquellas frecuencias inferiores a la de corte.</li>
<li><strong>Filtro de paso alto (HPF):</strong> Deja pasar aquellas frecuencias superiores a la de corte.</li>
<li><strong>Filtro de paso banda (BPF):</strong> Deja pasar aquellas frecuencias cercanas a la central.</li>
<li><strong>Filtro de rechazo banda (BSF):</strong> Deja pasar aquellas frecuencias alejadas a la central.</li>
</ul>
<p>Con esto completamos lo que necesitamos saber sobre síntesis de sonido para trabajar con el chip SID.</p>
<h3 id="registros-del-sid">Registros del SID</h3>
<p>El chip de sonido dispone de tres osciladores independientes, que nos permiten tener tres voces a la vez y que podemos configurar con:</p>

<table>
<thead>
<tr>
<th align="center">Voz 1</th>
<th align="center">Voz 2</th>
<th align="center">Voz 3</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D400-$D401</td>
<td align="center">$D407-$D408</td>
<td align="center">$D40E-$D40F</td>
<td>Frecuencia (<em>Frequency</em>).</td>
</tr>
<tr>
<td align="center">$D402-$D403</td>
<td align="center">$D409-$D40A</td>
<td align="center">$D410-$D411</td>
<td>Ancho de pulso (<em>Pulse Width</em>).</td>
</tr>
<tr>
<td align="center">$D404</td>
<td align="center">$D40B</td>
<td align="center">$D412</td>
<td>Registros de control:<br>+ <strong>Bit 0:</strong> <strong>0</strong> = Desactivar <em>Gate</em> (<em>Release</em>); <strong>1</strong> = Activar <em>Gate</em> (<em>Attack-Decay-Sustain</em>).<br>+ <strong>Bit 1:</strong> <strong>1</strong> = Activar sincronización con la voz anterior.<br>+ <strong>Bit 2:</strong> <strong>1</strong> = Activar modulación de anillo con la voz anterior (<em>Ring Modulation</em>).<br>+ <strong>Bit 3:</strong> <strong>1</strong> = Silenciar voz y reiniciar generador de ruido.<br>+ <strong>Bit 4:</strong> <strong>1</strong> = Activar onda triangular (<em>Triangle</em>).<br>+ <strong>Bit 5:</strong> <strong>1</strong> = Activar onda en sierra ascendente (<em>Saw</em>).<br>+ <strong>Bit 6:</strong> <strong>1</strong> = Activar onda cuadrada (<em>Square</em>).<br>+ <strong>Bit 7:</strong> <strong>1</strong> = Activar ruido (<em>Noise</em>).</td>
</tr>
<tr>
<td align="center">$D405</td>
<td align="center">$D40C</td>
<td align="center">$D413</td>
<td><em>Attack</em> y <em>Decay</em>:<br>+ <strong>Bits 0-3:</strong> Nivel de <em>Decay</em> (0-15).<br>+ <strong>Bits 4-7:</strong> Nivel de <em>Attack</em> (0-15).</td>
</tr>
<tr>
<td align="center">$D406</td>
<td align="center">$D40D</td>
<td align="center">$D414</td>
<td><em>Sustain</em> y <em>Release</em>:<br>+ <strong>Bits 0-3:</strong> Nivel de <em>Release</em> (0-15).<br>+ <strong>Bits 4-7:</strong> Volumen de <em>Sustain</em> (0-15).</td>
</tr>
</tbody>
</table><p>Primero, hay que tener en cuenta que todos los registros anteriores son sólo de escritura. La única solución para poder consultar el estado, de este tipo de registros, es tener una copia en memoria con la que trabajar y que se envíe a los registros sonoros cuando se tenga que actualizar la información escrita.</p>
<p>Para usar cada voz hay que configurarla con el <strong>registro de control</strong>, seleccionando la combinación de <strong>formas</strong> de la onda que queremos tener con los <strong>bits 4-7</strong> y abriendo o cerrando la <em><strong>gate</strong></em> del sonido con el <strong>bit 0</strong>. La “puerta” o <em>gate</em> es la señal con la que en un sintetizador se comunica al sistema si se ha pulsado una nota o no. Cuando se activa se inicia el modo <em>Attack-Decay-Sustain</em>, utilizando la <strong>frecuencia</strong> indicada en su registro, y cuando se desactiva se pasa al modo <em>Release</em>. Para configurar la <strong>envolvente</strong> de cada voz, tenemos que tener en cuenta la siguiente tabla de valores:</p>

<table>
<thead>
<tr>
<th align="center">Nivel</th>
<th align="center">Binario</th>
<th align="center">Hexadecimal</th>
<th align="center">Attack</th>
<th align="center">Decay</th>
<th align="center">Release</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">0000</td>
<td align="center">0</td>
<td align="center">2 ms</td>
<td align="center">6 ms</td>
<td align="center">6 ms</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0001</td>
<td align="center">1</td>
<td align="center">8 ms</td>
<td align="center">24 ms</td>
<td align="center">24 ms</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">0010</td>
<td align="center">2</td>
<td align="center">16 ms</td>
<td align="center">48 ms</td>
<td align="center">48 ms</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">0011</td>
<td align="center">3</td>
<td align="center">24 ms</td>
<td align="center">72 ms</td>
<td align="center">72 ms</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">0100</td>
<td align="center">4</td>
<td align="center">38 ms</td>
<td align="center">114 ms</td>
<td align="center">114 ms</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">0101</td>
<td align="center">5</td>
<td align="center">56 ms</td>
<td align="center">168 ms</td>
<td align="center">168 ms</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">0110</td>
<td align="center">6</td>
<td align="center">68 ms</td>
<td align="center">204 ms</td>
<td align="center">204 ms</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">0111</td>
<td align="center">7</td>
<td align="center">80 ms</td>
<td align="center">240 ms</td>
<td align="center">240 ms</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">1000</td>
<td align="center">8</td>
<td align="center">100 ms</td>
<td align="center">300 ms</td>
<td align="center">300 ms</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">1001</td>
<td align="center">9</td>
<td align="center">250 ms</td>
<td align="center">750 ms</td>
<td align="center">750 ms</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">1010</td>
<td align="center">A</td>
<td align="center">500 ms</td>
<td align="center">1,5 s</td>
<td align="center">1,5 s</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">1011</td>
<td align="center">B</td>
<td align="center">800 ms</td>
<td align="center">2,4 s</td>
<td align="center">2,4 s</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">1100</td>
<td align="center">C</td>
<td align="center">1 s</td>
<td align="center">3 s</td>
<td align="center">3 s</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">1101</td>
<td align="center">D</td>
<td align="center">3 s</td>
<td align="center">9 s</td>
<td align="center">9 s</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">1110</td>
<td align="center">E</td>
<td align="center">5 s</td>
<td align="center">15 s</td>
<td align="center">15 s</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">1111</td>
<td align="center">F</td>
<td align="center">8 s</td>
<td align="center">24 s</td>
<td align="center">24 s</td>
</tr>
</tbody>
</table><p>Al ser el <em><strong>sustain</strong></em> un nivel de volumen, este tomará valores entre 0 y 15, donde el <strong>0</strong> es <strong>silencio</strong> y <strong>15</strong> el <strong>máximo volumen</strong>. Volviendo al registro de control, podemos usar la voz 3 para <strong>sincronizar</strong> (<strong>bit 1</strong>) y/o aplicar una <strong>modulación de anillo</strong> (<strong>bit 2</strong>) sobre la voz 1. Lo mismo podemos hacer con la voz 2 aplicada a la 1 y la voz 1 aplicada a la 3.</p>
<p>Cuando se selecciona la forma de onda cuadrada, se puede indicar el ancho del pulso, es decir, cuánto porcentaje del ciclo pasa la onda en la parte alta en lugar de la baja. Para ello hay que tener en cuenta la siguiente fórmula:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mo>=</mo><mn>40</mn><mo separator="true">,</mo><mn>95</mn><mo>×</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">
N = 40,95 \times P
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">40</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">95</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">P</span></span></span></span></span></span></p>
<p>Donde <em>P</em> es el porcentaje que queremos, de modo que para un ancho del 100% obtenemos el valor 4.095 (<code>$0FFF</code>) y para el 50% sería 2.048 (<code>$0800</code>), etcétera. Hay que tener en cuenta que la parte menos significativa de la <em>palabra</em> iría en la dirección más baja del registro y la más significativa  en la más alta.</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th align="center">Modo L/E</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D415</td>
<td align="center">Escritura</td>
<td>Frecuencia de corte (<em>Cut Off</em>).<br><strong>Bits 0-2:</strong> Bits 0-2 del valor final.</td>
</tr>
<tr>
<td align="center">$D416</td>
<td align="center">Escritura</td>
<td>Frecuencia de corte (<em>Cut Off</em>).<br><strong>Bits 0-7:</strong> Bits 3-10 del valor final.</td>
</tr>
<tr>
<td align="center">$D417</td>
<td align="center">Escritura</td>
<td>Control del filtro:<br>+ <strong>Bit 0:</strong> <strong>1</strong> = Voz 1 filtrada.<br>+ <strong>Bit 1:</strong> <strong>1</strong> = Voz 2 filtrada.<br>+ <strong>Bit 2:</strong> <strong>1</strong> = Voz 3 filtrada.<br>+ <strong>Bit 3:</strong> <strong>1</strong> = Voz externa filtrada.<br>+ <strong>Bits 4-7:</strong> Resonancia del filtro (<em>Resonance</em>).</td>
</tr>
<tr>
<td align="center">$D418</td>
<td align="center">Escritura</td>
<td>Volumen y modos de filtrado:<br>+ <strong>Bits 0-3:</strong> Volumen.<br>+ <strong>Bit 4:</strong> <strong>1</strong> = Filtro de paso bajo activado (LPF).<br>+ <strong>Bit 5:</strong> <strong>1</strong> = Filtro de paso banda activado (BPF).<br>+ <strong>Bit 6:</strong> <strong>1</strong> = Filtro de paso alto activado (HPF).<br>+ <strong>Bit 7:</strong> Voz 3 silenciada.</td>
</tr>
</tbody>
</table><p>De nuevo todos los registros son sólo de escritura. Podemos configurar el modo de filtrado que queremos, aunque se puede activar una combinación de ellos que compartirán la misma frecuencia de corte, para luego indicar qué voces van a ser filtradas o no. Además de la frecuencia de corte (<em>cut off</em>), que tiene 11 bits, se puede indicar el nivel de resonancia del filtrado. También tenemos un registro para configurar el nivel de volumen global del sonido.</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th align="center">Modo L/E</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$D419</td>
<td align="center">Lectura</td>
<td>Conversor analógico-digital X.</td>
</tr>
<tr>
<td align="center">$D41A</td>
<td align="center">Lectura</td>
<td>Conversor analógico-digital Y.</td>
</tr>
<tr>
<td align="center">$D41B</td>
<td align="center">Lectura</td>
<td>Salida de la voz 3.</td>
</tr>
<tr>
<td align="center">$D41C</td>
<td align="center">Lectura</td>
<td>Salida de la envolvente ADSR para la voz 3.</td>
</tr>
</tbody>
</table><p>Por último tenemos estos registros que son sólo de lectura. Los dos primeros se utilizan para la E/S de periféricos que utilizan potenciómetros. El registro $D41B tiene una utilidad secundaria, ya que se puede utilizar como generador de números aleatorios cuando la voz 3 está configurada con la forma de onda de ruido.</p>
<h3 id="notas-musicales">Notas musicales</h3>
<p>La <a href="https://es.wikipedia.org/wiki/Escala_crom%C3%A1tica">escala cromática</a> dispone de doce notas:</p>

<table>
<thead>
<tr>
<th align="center">Nombre</th>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
<th align="center">8</th>
<th align="center">9</th>
<th align="center">10</th>
<th align="center">11</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Inglés</td>
<td align="center">C</td>
<td align="center">C♯/D♭</td>
<td align="center">D</td>
<td align="center">D♯/E♭</td>
<td align="center">E</td>
<td align="center">F</td>
<td align="center">F♯/G♭</td>
<td align="center">G</td>
<td align="center">G♯/A♭</td>
<td align="center">A</td>
<td align="center">A♯/B♭</td>
<td align="center">B</td>
</tr>
<tr>
<td align="center">Latino</td>
<td align="center">Do</td>
<td align="center">Do♯/Re♭</td>
<td align="center">Re</td>
<td align="center">Re♯/Mi♭</td>
<td align="center">Mi</td>
<td align="center">Fa</td>
<td align="center">Fa♯/Sol♭</td>
<td align="center">Sol</td>
<td align="center">Sol♯/La♭</td>
<td align="center">La</td>
<td align="center">La♯/Si♭</td>
<td align="center">Si</td>
</tr>
</tbody>
</table><p>El símbolo sostenido (♯) añade medio tono a una nota y el bemol (♭) le resta medio tono. Entonces, para calcular las frecuencias de cada nota, tenemos que partir de una <strong>frecuencia base</strong> para la nota LA en la cuarta octava de un piano (A4), que es la octava central en un piano de 88 teclas (las tres primeras teclas son de la octava cero y la última de la octava ocho). La frecuencia habitual para afinar la nota <strong>A4</strong> es la <strong>440 Hz</strong>, pero también existen históricamente otras afinaciones que utilizan la 435 Hz por ejemplo. Con esta frecuencia base podemos usar la siguiente fórmula:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mn>2</mn><mfrac><mrow><mi>n</mi><mo>−</mo><mn>49</mn></mrow><mn>12</mn></mfrac></msup><mo>×</mo><mn>440</mn><mtext>&nbsp;Hz</mtext></mrow><annotation encoding="application/x-tex">
f(n) = 2^{\frac{n-49}{12}} \times 440\ \text{Hz}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08735em; vertical-align: -0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.00402em;"><span class="" style="top: -3.413em; margin-right: 0.05em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.844314em;"><span class="" style="top: -2.656em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span><span class="" style="top: -3.2255em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em;"></span></span><span class="" style="top: -3.384em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">49</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">440</span><span class="mspace">&nbsp;</span><span class="mord text"><span class="mord">Hz</span></span></span></span></span></span></span></p>
<p>Donde <em>n</em> es el número de la nota, representando como la nota cero a la tecla A0. Esto nos permite calcular desde C0 hasta C8, pero el chip SID nos permite emitir sonidos desde la octava 0 hasta la 7, porque sus osciladores soportan frecuencias de 16 Hz a 4 kHz, por lo que no necesitamos calcular todas las notas.</p>
<p>También hay otro método para calcular las frecuencias, siempre que tengamos las frecuencias de cada nota en una octava. Para subir una octava una nota, hay que duplicar su frecuencia, y por lo tanto, para bajar una octava hay que dividir a la mitad su frecuencia. De esto obtenemos que:</p>

<table>
<thead>
<tr>
<th align="center">Octava</th>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
<th align="center">8</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">32</td>
<td align="center">64</td>
<td align="center">128</td>
<td align="center">256</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">32</td>
<td align="center">64</td>
<td align="center">128</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">32</td>
<td align="center">64</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">32</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">32</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">64</td>
<td align="center">32</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">128</td>
<td align="center">64</td>
<td align="center">32</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">256</td>
<td align="center">128</td>
<td align="center">64</td>
<td align="center">32</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">-</td>
</tr>
</tbody>
</table><p>La tabla de frecuencias, para el <a href="https://en.wikipedia.org/wiki/Concert_pitch">tono</a> estándar (440 Hz) y el francés (435 Hz), es la siguiente:</p>

<table>
<thead>
<tr>
<th align="center">Nota</th>
<th align="center">Frecuencia (440 Hz)</th>
<th align="center">Frecuencia (435 Hz)</th>
<th align="center">Nota</th>
<th align="center">Frecuencia (440 Hz)</th>
<th align="center">Frecuencia (435 Hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">C0</td>
<td align="center">15,4338531642539</td>
<td align="center">15,2584684692055</td>
<td align="center">C4</td>
<td align="center">246,941650628062</td>
<td align="center">244,135495507289</td>
</tr>
<tr>
<td align="center">C#0</td>
<td align="center">16,3515978312874</td>
<td align="center">16,1657842195682</td>
<td align="center">C#4</td>
<td align="center">261,625565300599</td>
<td align="center">258,652547513092</td>
</tr>
<tr>
<td align="center">D0</td>
<td align="center">17,3239144360545</td>
<td align="center">17,1270517720084</td>
<td align="center">D4</td>
<td align="center">277,182630976872</td>
<td align="center">274,032828352135</td>
</tr>
<tr>
<td align="center">D#0</td>
<td align="center">18,354047994838</td>
<td align="center">18,1454792676239</td>
<td align="center">D#4</td>
<td align="center">293,664767917408</td>
<td align="center">290,327668281982</td>
</tr>
<tr>
<td align="center">E0</td>
<td align="center">19,4454364826301</td>
<td align="center">19,2244656135093</td>
<td align="center">E4</td>
<td align="center">311,126983722081</td>
<td align="center">307,591449816148</td>
</tr>
<tr>
<td align="center">F0</td>
<td align="center">20,6017223070544</td>
<td align="center">20,3676118262924</td>
<td align="center">F4</td>
<td align="center">329,62755691287</td>
<td align="center">325,881789220678</td>
</tr>
<tr>
<td align="center">F#0</td>
<td align="center">21,8267644645627</td>
<td align="center">21,5787330501927</td>
<td align="center">F#4</td>
<td align="center">349,228231433004</td>
<td align="center">345,259728803083</td>
</tr>
<tr>
<td align="center">G0</td>
<td align="center">23,1246514194772</td>
<td align="center">22,8618712897104</td>
<td align="center">G4</td>
<td align="center">369,994422711634</td>
<td align="center">365,789940635366</td>
</tr>
<tr>
<td align="center">G#0</td>
<td align="center">24,4997147488593</td>
<td align="center">24,2213088994405</td>
<td align="center">G#4</td>
<td align="center">391,995435981749</td>
<td align="center">387,540942391048</td>
</tr>
<tr>
<td align="center">A0</td>
<td align="center">25,9565435987466</td>
<td align="center">25,6615828760336</td>
<td align="center">A4</td>
<td align="center">415,304697579945</td>
<td align="center">410,585326016537</td>
</tr>
<tr>
<td align="center">A#0</td>
<td align="center">27,5</td>
<td align="center">27,1875</td>
<td align="center">A#4</td>
<td align="center">440</td>
<td align="center">435</td>
</tr>
<tr>
<td align="center">B0</td>
<td align="center">29,1352350948806</td>
<td align="center">28,8041528778933</td>
<td align="center">B4</td>
<td align="center">466,16376151809</td>
<td align="center">460,866446046293</td>
</tr>
<tr>
<td align="center">C1</td>
<td align="center">30,8677063285078</td>
<td align="center">30,5169369384111</td>
<td align="center">C5</td>
<td align="center">493,883301256124</td>
<td align="center">488,270991014577</td>
</tr>
<tr>
<td align="center">C#1</td>
<td align="center">32,7031956625748</td>
<td align="center">32,3315684391365</td>
<td align="center">C#5</td>
<td align="center">523,251130601197</td>
<td align="center">517,305095026184</td>
</tr>
<tr>
<td align="center">D1</td>
<td align="center">34,647828872109</td>
<td align="center">34,2541035440169</td>
<td align="center">D5</td>
<td align="center">554,365261953744</td>
<td align="center">548,06565670427</td>
</tr>
<tr>
<td align="center">D#1</td>
<td align="center">36,7080959896759</td>
<td align="center">36,2909585352478</td>
<td align="center">D#5</td>
<td align="center">587,329535834815</td>
<td align="center">580,655336563965</td>
</tr>
<tr>
<td align="center">E1</td>
<td align="center">38,8908729652601</td>
<td align="center">38,4489312270185</td>
<td align="center">E5</td>
<td align="center">622,253967444162</td>
<td align="center">615,182899632296</td>
</tr>
<tr>
<td align="center">F1</td>
<td align="center">41,2034446141088</td>
<td align="center">40,7352236525848</td>
<td align="center">F5</td>
<td align="center">659,25511382574</td>
<td align="center">651,763578441356</td>
</tr>
<tr>
<td align="center">F#1</td>
<td align="center">43,6535289291255</td>
<td align="center">43,1574661003854</td>
<td align="center">F#5</td>
<td align="center">698,456462866008</td>
<td align="center">690,519457606167</td>
</tr>
<tr>
<td align="center">G1</td>
<td align="center">46,2493028389543</td>
<td align="center">45,7237425794207</td>
<td align="center">G5</td>
<td align="center">739,988845423269</td>
<td align="center">731,579881270732</td>
</tr>
<tr>
<td align="center">G#1</td>
<td align="center">48,9994294977187</td>
<td align="center">48,442617798881</td>
<td align="center">G#5</td>
<td align="center">783,990871963499</td>
<td align="center">775,081884782095</td>
</tr>
<tr>
<td align="center">A1</td>
<td align="center">51,9130871974931</td>
<td align="center">51,3231657520671</td>
<td align="center">A5</td>
<td align="center">830,60939515989</td>
<td align="center">821,170652033073</td>
</tr>
<tr>
<td align="center">A#1</td>
<td align="center">55</td>
<td align="center">54,375</td>
<td align="center">A#5</td>
<td align="center">880</td>
<td align="center">870</td>
</tr>
<tr>
<td align="center">B1</td>
<td align="center">58,2704701897613</td>
<td align="center">57,6083057557867</td>
<td align="center">B5</td>
<td align="center">932,32752303618</td>
<td align="center">921,732892092587</td>
</tr>
<tr>
<td align="center">C2</td>
<td align="center">61,7354126570155</td>
<td align="center">61,0338738768222</td>
<td align="center">C6</td>
<td align="center">987,766602512248</td>
<td align="center">976,541982029154</td>
</tr>
<tr>
<td align="center">C#2</td>
<td align="center">65,4063913251497</td>
<td align="center">64,663136878273</td>
<td align="center">C#6</td>
<td align="center">1.046,50226120239</td>
<td align="center">1.034,61019005237</td>
</tr>
<tr>
<td align="center">D2</td>
<td align="center">69,295657744218</td>
<td align="center">68,5082070880337</td>
<td align="center">D6</td>
<td align="center">1.108,73052390749</td>
<td align="center">1.096,13131340854</td>
</tr>
<tr>
<td align="center">D#2</td>
<td align="center">73,4161919793519</td>
<td align="center">72,5819170704956</td>
<td align="center">D#6</td>
<td align="center">1.174,65907166963</td>
<td align="center">1.161,31067312793</td>
</tr>
<tr>
<td align="center">E2</td>
<td align="center">77,7817459305202</td>
<td align="center">76,897862454037</td>
<td align="center">E6</td>
<td align="center">1.244,50793488832</td>
<td align="center">1.230,36579926459</td>
</tr>
<tr>
<td align="center">F2</td>
<td align="center">82,4068892282175</td>
<td align="center">81,4704473051696</td>
<td align="center">F6</td>
<td align="center">1.318,51022765148</td>
<td align="center">1.303,52715688271</td>
</tr>
<tr>
<td align="center">F#2</td>
<td align="center">87,307057858251</td>
<td align="center">86,3149322007708</td>
<td align="center">F#6</td>
<td align="center">1.396,91292573202</td>
<td align="center">1.381,03891521233</td>
</tr>
<tr>
<td align="center">G2</td>
<td align="center">92,4986056779086</td>
<td align="center">91,4474851588415</td>
<td align="center">G6</td>
<td align="center">1.479,97769084654</td>
<td align="center">1.463,15976254146</td>
</tr>
<tr>
<td align="center">G#2</td>
<td align="center">97,9988589954373</td>
<td align="center">96,8852355977619</td>
<td align="center">G#6</td>
<td align="center">1.567,981743927</td>
<td align="center">1.550,16376956419</td>
</tr>
<tr>
<td align="center">A2</td>
<td align="center">103,826174394986</td>
<td align="center">102,646331504134</td>
<td align="center">A6</td>
<td align="center">1.661,21879031978</td>
<td align="center">1.642,34130406615</td>
</tr>
<tr>
<td align="center">A#2</td>
<td align="center">110</td>
<td align="center">108,75</td>
<td align="center">A#6</td>
<td align="center">1.760</td>
<td align="center">1.740</td>
</tr>
<tr>
<td align="center">B2</td>
<td align="center">116,540940379522</td>
<td align="center">115,216611511573</td>
<td align="center">B6</td>
<td align="center">1.864,65504607236</td>
<td align="center">1.843,46578418517</td>
</tr>
<tr>
<td align="center">C3</td>
<td align="center">123,470825314031</td>
<td align="center">122,067747753644</td>
<td align="center">C7</td>
<td align="center">1.975,5332050245</td>
<td align="center">1.953,08396405831</td>
</tr>
<tr>
<td align="center">C#3</td>
<td align="center">130,812782650299</td>
<td align="center">129,326273756546</td>
<td align="center">C#7</td>
<td align="center">2.093,00452240479</td>
<td align="center">2.069,22038010473</td>
</tr>
<tr>
<td align="center">D3</td>
<td align="center">138,591315488436</td>
<td align="center">137,016414176067</td>
<td align="center">D7</td>
<td align="center">2.217,46104781498</td>
<td align="center">2.192,26262681708</td>
</tr>
<tr>
<td align="center">D#3</td>
<td align="center">146,832383958704</td>
<td align="center">145,163834140991</td>
<td align="center">D#7</td>
<td align="center">2.349,31814333926</td>
<td align="center">2.322,62134625586</td>
</tr>
<tr>
<td align="center">E3</td>
<td align="center">155,56349186104</td>
<td align="center">153,795724908074</td>
<td align="center">E7</td>
<td align="center">2.489,01586977665</td>
<td align="center">2.460,73159852919</td>
</tr>
<tr>
<td align="center">F3</td>
<td align="center">164,813778456435</td>
<td align="center">162,940894610339</td>
<td align="center">F7</td>
<td align="center">2.637,02045530296</td>
<td align="center">2.607,05431376543</td>
</tr>
<tr>
<td align="center">F#3</td>
<td align="center">174,614115716502</td>
<td align="center">172,629864401542</td>
<td align="center">F#7</td>
<td align="center">2.793,82585146403</td>
<td align="center">2.762,07783042467</td>
</tr>
<tr>
<td align="center">G3</td>
<td align="center">184,997211355817</td>
<td align="center">182,894970317683</td>
<td align="center">G7</td>
<td align="center">2.959,95538169308</td>
<td align="center">2.926,31952508293</td>
</tr>
<tr>
<td align="center">G#3</td>
<td align="center">195,997717990875</td>
<td align="center">193,770471195524</td>
<td align="center">G#7</td>
<td align="center">3.135,96348785399</td>
<td align="center">3.100,32753912838</td>
</tr>
<tr>
<td align="center">A3</td>
<td align="center">207,652348789973</td>
<td align="center">205,292663008268</td>
<td align="center">A7</td>
<td align="center">3.322,43758063956</td>
<td align="center">3.284,68260813229</td>
</tr>
<tr>
<td align="center">A#3</td>
<td align="center">220</td>
<td align="center">217,5</td>
<td align="center">A#7</td>
<td align="center">3.520</td>
<td align="center">3.480</td>
</tr>
<tr>
<td align="center">B3</td>
<td align="center">233,081880759045</td>
<td align="center">230,433223023147</td>
<td align="center">B7</td>
<td align="center">3.729,31009214472</td>
<td align="center">3.686,93156837035</td>
</tr>
</tbody>
</table><p>Con todas las notas calculadas, la cosa no se queda ahí para el chip SID, ya que la frecuencia es representada como un valor entero sin signo de 16 bits. Para convertir, una frecuencia a valores admitidos por los registros del chip, usaremos la siguiente fórmula:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mo>=</mo><mfrac><mrow><mi>F</mi><mo>×</mo><msup><mn>2</mn><mn>24</mn></msup></mrow><mi>R</mi></mfrac><mo>=</mo><mfrac><mrow><mi>F</mi><mo>×</mo><mn>16.777.216</mn></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">
N = \dfrac{F \times 2^{24}}{\mathit{R}} = \dfrac{F \times 16.777.216}{\mathit{R}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.17711em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.49111em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">R</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.04633em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">R</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">16.777.216</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>Donde <em>F</em> es la frecuencia de la nota y <em>R</em> la frecuencia del reloj de la máquina. Recordemos que la versión <strong>PAL</strong> tiene una frecuencia de <strong>985.248,6 Hz</strong> y la <strong>NTSC</strong> de <strong>1.022.727,3 Hz</strong>. El resultado es que tenemos las siguientes fórmulas para cada modelo:</p>

<table>
<thead>
<tr>
<th align="center">Modo</th>
<th align="center">Fórmula</th>
<th align="center">Rango</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>PAL</strong></td>
<td align="center"><code>n = f * (18 * 16777216) / 17734475</code></td>
<td align="center">0 Hz - 3.848 Hz</td>
</tr>
<tr>
<td align="center"><strong>NTSC</strong></td>
<td align="center"><code>n = f * (14 * 16777216) / 14318182</code></td>
<td align="center">0 Hz - 3.995 Hz</td>
</tr>
</tbody>
</table><p>La tabla de valores para las frecuencias es la siguiente:</p>

<table>
<thead>
<tr>
<th align="center">Nota</th>
<th align="center">Manual</th>
<th align="center">PAL (440 Hz)</th>
<th align="center">NTSC (440 Hz)</th>
<th align="center">PAL (435 Hz)</th>
<th align="center">NTSC (435 Hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">C0</td>
<td align="center">268 ($010C)</td>
<td align="center">263 ($0107)</td>
<td align="center">253 ($00FD)</td>
<td align="center">260 ($0104)</td>
<td align="center">250 ($00FA)</td>
</tr>
<tr>
<td align="center">C#0</td>
<td align="center">284 ($011C)</td>
<td align="center">278 ($0116)</td>
<td align="center">268 ($010C)</td>
<td align="center">275 ($0113)</td>
<td align="center">265 ($0109)</td>
</tr>
<tr>
<td align="center">D0</td>
<td align="center">301 ($012D)</td>
<td align="center">295 ($0127)</td>
<td align="center">284 ($011C)</td>
<td align="center">292 ($0124)</td>
<td align="center">281 ($0119)</td>
</tr>
<tr>
<td align="center">D#0</td>
<td align="center">318 ($013E)</td>
<td align="center">313 ($0139)</td>
<td align="center">301 ($012D)</td>
<td align="center">309 ($0135)</td>
<td align="center">298 ($012A)</td>
</tr>
<tr>
<td align="center">E0</td>
<td align="center">337 ($0151)</td>
<td align="center">331 ($014B)</td>
<td align="center">319 ($013F)</td>
<td align="center">327 ($0147)</td>
<td align="center">315 ($013B)</td>
</tr>
<tr>
<td align="center">F0</td>
<td align="center">358 ($0166)</td>
<td align="center">351 ($015F)</td>
<td align="center">338 ($0152)</td>
<td align="center">347 ($015B)</td>
<td align="center">334 ($014E)</td>
</tr>
<tr>
<td align="center">F#0</td>
<td align="center">379 ($017B)</td>
<td align="center">372 ($0174)</td>
<td align="center">358 ($0166)</td>
<td align="center">367 ($016F)</td>
<td align="center">354 ($0162)</td>
</tr>
<tr>
<td align="center">G0</td>
<td align="center">401 ($0191)</td>
<td align="center">394 ($018A)</td>
<td align="center">379 ($017B)</td>
<td align="center">389 ($0185)</td>
<td align="center">375 ($0177)</td>
</tr>
<tr>
<td align="center">G#0</td>
<td align="center">425 ($01A9)</td>
<td align="center">417 ($01A1)</td>
<td align="center">402 ($0192)</td>
<td align="center">412 ($019C)</td>
<td align="center">397 ($018D)</td>
</tr>
<tr>
<td align="center">A0</td>
<td align="center">451 ($01C3)</td>
<td align="center">442 ($01BA)</td>
<td align="center">426 ($01AA)</td>
<td align="center">437 ($01B5)</td>
<td align="center">421 ($01A5)</td>
</tr>
<tr>
<td align="center">A#0</td>
<td align="center">477 ($01DD)</td>
<td align="center">468 ($01D4)</td>
<td align="center">451 ($01C3)</td>
<td align="center">463 ($01CF)</td>
<td align="center">446 ($01BE)</td>
</tr>
<tr>
<td align="center">B0</td>
<td align="center">506 ($01FA)</td>
<td align="center">496 ($01F0)</td>
<td align="center">478 ($01DE)</td>
<td align="center">490 ($01EA)</td>
<td align="center">473 ($01D9)</td>
</tr>
<tr>
<td align="center">C1</td>
<td align="center">536 ($0218)</td>
<td align="center">526 ($020E)</td>
<td align="center">506 ($01FA)</td>
<td align="center">520 ($0208)</td>
<td align="center">501 ($01F5)</td>
</tr>
<tr>
<td align="center">C#1</td>
<td align="center">568 ($0238)</td>
<td align="center">557 ($022D)</td>
<td align="center">536 ($0218)</td>
<td align="center">551 ($0227)</td>
<td align="center">530 ($0212)</td>
</tr>
<tr>
<td align="center">D1</td>
<td align="center">602 ($025A)</td>
<td align="center">590 ($024E)</td>
<td align="center">568 ($0238)</td>
<td align="center">583 ($0247)</td>
<td align="center">562 ($0232)</td>
</tr>
<tr>
<td align="center">D#1</td>
<td align="center">637 ($027D)</td>
<td align="center">625 ($0271)</td>
<td align="center">602 ($025A)</td>
<td align="center">618 ($026A)</td>
<td align="center">595 ($0253)</td>
</tr>
<tr>
<td align="center">E1</td>
<td align="center">675 ($02A3)</td>
<td align="center">662 ($0296)</td>
<td align="center">638 ($027E)</td>
<td align="center">655 ($028F)</td>
<td align="center">631 ($0277)</td>
</tr>
<tr>
<td align="center">F1</td>
<td align="center">716 ($02CC)</td>
<td align="center">702 ($02BE)</td>
<td align="center">676 ($02A4)</td>
<td align="center">694 ($02B6)</td>
<td align="center">668 ($029C)</td>
</tr>
<tr>
<td align="center">F#1</td>
<td align="center">758 ($02F6)</td>
<td align="center">743 ($02E7)</td>
<td align="center">716 ($02CC)</td>
<td align="center">735 ($02DF)</td>
<td align="center">708 ($02C4)</td>
</tr>
<tr>
<td align="center">G1</td>
<td align="center">803 ($0323)</td>
<td align="center">788 ($0314)</td>
<td align="center">759 ($02F7)</td>
<td align="center">779 ($030B)</td>
<td align="center">750 ($02EE)</td>
</tr>
<tr>
<td align="center">G#1</td>
<td align="center">851 ($0353)</td>
<td align="center">834 ($0342)</td>
<td align="center">804 ($0324)</td>
<td align="center">825 ($0339)</td>
<td align="center">795 ($031B)</td>
</tr>
<tr>
<td align="center">A1</td>
<td align="center">902 ($0386)</td>
<td align="center">884 ($0374)</td>
<td align="center">852 ($0354)</td>
<td align="center">874 ($036A)</td>
<td align="center">842 ($034A)</td>
</tr>
<tr>
<td align="center">A#1</td>
<td align="center">955 ($03BB)</td>
<td align="center">937 ($03A9)</td>
<td align="center">902 ($0386)</td>
<td align="center">926 ($039E)</td>
<td align="center">892 ($037C)</td>
</tr>
<tr>
<td align="center">B1</td>
<td align="center">1012 ($03F4)</td>
<td align="center">992 ($03E0)</td>
<td align="center">956 ($03BC)</td>
<td align="center">981 ($03D5)</td>
<td align="center">945 ($03B1)</td>
</tr>
<tr>
<td align="center">C2</td>
<td align="center">1072 ($0430)</td>
<td align="center">1051 ($041B)</td>
<td align="center">1013 ($03F5)</td>
<td align="center">1039 ($040F)</td>
<td align="center">1001 ($03E9)</td>
</tr>
<tr>
<td align="center">C#2</td>
<td align="center">1136 ($0470)</td>
<td align="center">1114 ($045A)</td>
<td align="center">1073 ($0431)</td>
<td align="center">1101 ($044D)</td>
<td align="center">1061 ($0425)</td>
</tr>
<tr>
<td align="center">D2</td>
<td align="center">1204 ($04B4)</td>
<td align="center">1180 ($049C)</td>
<td align="center">1137 ($0471)</td>
<td align="center">1167 ($048F)</td>
<td align="center">1124 ($0464)</td>
</tr>
<tr>
<td align="center">D#2</td>
<td align="center">1275 ($04FB)</td>
<td align="center">1250 ($04E2)</td>
<td align="center">1204 ($04B4)</td>
<td align="center">1236 ($04D4)</td>
<td align="center">1191 ($04A7)</td>
</tr>
<tr>
<td align="center">E2</td>
<td align="center">1351 ($0547)</td>
<td align="center">1324 ($052C)</td>
<td align="center">1276 ($04FC)</td>
<td align="center">1309 ($051D)</td>
<td align="center">1261 ($04ED)</td>
</tr>
<tr>
<td align="center">F2</td>
<td align="center">1432 ($0598)</td>
<td align="center">1403 ($057B)</td>
<td align="center">1352 ($0548)</td>
<td align="center">1387 ($056B)</td>
<td align="center">1336 ($0538)</td>
</tr>
<tr>
<td align="center">F#2</td>
<td align="center">1517 ($05ED)</td>
<td align="center">1487 ($05CF)</td>
<td align="center">1432 ($0598)</td>
<td align="center">1470 ($05BE)</td>
<td align="center">1416 ($0588)</td>
</tr>
<tr>
<td align="center">G2</td>
<td align="center">1607 ($0647)</td>
<td align="center">1575 ($0627)</td>
<td align="center">1517 ($05ED)</td>
<td align="center">1557 ($0615)</td>
<td align="center">1500 ($05DC)</td>
</tr>
<tr>
<td align="center">G#2</td>
<td align="center">1703 ($06A7)</td>
<td align="center">1669 ($0685)</td>
<td align="center">1608 ($0648)</td>
<td align="center">1650 ($0672)</td>
<td align="center">1589 ($0635)</td>
</tr>
<tr>
<td align="center">A2</td>
<td align="center">1804 ($070C)</td>
<td align="center">1768 ($06E8)</td>
<td align="center">1703 ($06A7)</td>
<td align="center">1748 ($06D4)</td>
<td align="center">1684 ($0694)</td>
</tr>
<tr>
<td align="center">A#2</td>
<td align="center">1911 ($0777)</td>
<td align="center">1873 ($0751)</td>
<td align="center">1804 ($070C)</td>
<td align="center">1852 ($073C)</td>
<td align="center">1784 ($06F8)</td>
</tr>
<tr>
<td align="center">B2</td>
<td align="center">2025 ($07E9)</td>
<td align="center">1985 ($07C1)</td>
<td align="center">1912 ($0778)</td>
<td align="center">1962 ($07AA)</td>
<td align="center">1890 ($0762)</td>
</tr>
<tr>
<td align="center">C3</td>
<td align="center">2145 ($0861)</td>
<td align="center">2103 ($0837)</td>
<td align="center">2025 ($07E9)</td>
<td align="center">2079 ($081F)</td>
<td align="center">2002 ($07D2)</td>
</tr>
<tr>
<td align="center">C#3</td>
<td align="center">2273 ($08E1)</td>
<td align="center">2228 ($08B4)</td>
<td align="center">2146 ($0862)</td>
<td align="center">2202 ($089A)</td>
<td align="center">2122 ($084A)</td>
</tr>
<tr>
<td align="center">D3</td>
<td align="center">2408 ($0968)</td>
<td align="center">2360 ($0938)</td>
<td align="center">2274 ($08E2)</td>
<td align="center">2333 ($091D)</td>
<td align="center">2248 ($08C8)</td>
</tr>
<tr>
<td align="center">D#3</td>
<td align="center">2551 ($09F7)</td>
<td align="center">2500 ($09C4)</td>
<td align="center">2409 ($0969)</td>
<td align="center">2472 ($09A8)</td>
<td align="center">2381 ($094D)</td>
</tr>
<tr>
<td align="center">E3</td>
<td align="center">2703 ($0A8F)</td>
<td align="center">2649 ($0A59)</td>
<td align="center">2552 ($09F8)</td>
<td align="center">2619 ($0A3B)</td>
<td align="center">2523 ($09DB)</td>
</tr>
<tr>
<td align="center">F3</td>
<td align="center">2864 ($0B30)</td>
<td align="center">2807 ($0AF7)</td>
<td align="center">2704 ($0A90)</td>
<td align="center">2775 ($0AD7)</td>
<td align="center">2673 ($0A71)</td>
</tr>
<tr>
<td align="center">F#3</td>
<td align="center">3034 ($0BDA)</td>
<td align="center">2973 ($0B9D)</td>
<td align="center">2864 ($0B30)</td>
<td align="center">2940 ($0B7C)</td>
<td align="center">2832 ($0B10)</td>
</tr>
<tr>
<td align="center">G3</td>
<td align="center">3215 ($0C8F)</td>
<td align="center">3150 ($0C4E)</td>
<td align="center">3035 ($0BDB)</td>
<td align="center">3114 ($0C2A)</td>
<td align="center">3000 ($0BB8)</td>
</tr>
<tr>
<td align="center">G#3</td>
<td align="center">3406 ($0D4E)</td>
<td align="center">3338 ($0D0A)</td>
<td align="center">3215 ($0C8F)</td>
<td align="center">3300 ($0CE4)</td>
<td align="center">3179 ($0C6B)</td>
</tr>
<tr>
<td align="center">A3</td>
<td align="center">3608 ($0E18)</td>
<td align="center">3536 ($0DD0)</td>
<td align="center">3406 ($0D4E)</td>
<td align="center">3496 ($0DA8)</td>
<td align="center">3368 ($0D28)</td>
</tr>
<tr>
<td align="center">A#3</td>
<td align="center">3823 ($0EEF)</td>
<td align="center">3746 ($0EA2)</td>
<td align="center">3609 ($0E19)</td>
<td align="center">3704 ($0E78)</td>
<td align="center">3568 ($0DF0)</td>
</tr>
<tr>
<td align="center">B3</td>
<td align="center">4050 ($0FD2)</td>
<td align="center">3969 ($0F81)</td>
<td align="center">3824 ($0EF0)</td>
<td align="center">3924 ($0F54)</td>
<td align="center">3780 ($0EC4)</td>
</tr>
<tr>
<td align="center">C4</td>
<td align="center">4291 ($10C3)</td>
<td align="center">4205 ($106D)</td>
<td align="center">4051 ($0FD3)</td>
<td align="center">4157 ($103D)</td>
<td align="center">4005 ($0FA5)</td>
</tr>
<tr>
<td align="center">C#4</td>
<td align="center">4547 ($11C3)</td>
<td align="center">4455 ($1167)</td>
<td align="center">4292 ($10C4)</td>
<td align="center">4404 ($1134)</td>
<td align="center">4243 ($1093)</td>
</tr>
<tr>
<td align="center">D4</td>
<td align="center">4817 ($12D1)</td>
<td align="center">4720 ($1270)</td>
<td align="center">4547 ($11C3)</td>
<td align="center">4666 ($123A)</td>
<td align="center">4495 ($118F)</td>
</tr>
<tr>
<td align="center">D#4</td>
<td align="center">5103 ($13EF)</td>
<td align="center">5001 ($1389)</td>
<td align="center">4817 ($12D1)</td>
<td align="center">4944 ($1350)</td>
<td align="center">4763 ($129B)</td>
</tr>
<tr>
<td align="center">E4</td>
<td align="center">5407 ($151F)</td>
<td align="center">5298 ($14B2)</td>
<td align="center">5104 ($13F0)</td>
<td align="center">5238 ($1476)</td>
<td align="center">5046 ($13B6)</td>
</tr>
<tr>
<td align="center">F4</td>
<td align="center">5728 ($1660)</td>
<td align="center">5613 ($15ED)</td>
<td align="center">5407 ($151F)</td>
<td align="center">5549 ($15AD)</td>
<td align="center">5346 ($14E2)</td>
</tr>
<tr>
<td align="center">F#4</td>
<td align="center">6069 ($17B5)</td>
<td align="center">5947 ($173B)</td>
<td align="center">5729 ($1661)</td>
<td align="center">5879 ($16F7)</td>
<td align="center">5664 ($1620)</td>
</tr>
<tr>
<td align="center">G4</td>
<td align="center">6430 ($191E)</td>
<td align="center">6300 ($189C)</td>
<td align="center">6070 ($17B6)</td>
<td align="center">6229 ($1855)</td>
<td align="center">6001 ($1771)</td>
</tr>
<tr>
<td align="center">G#4</td>
<td align="center">6812 ($1A9C)</td>
<td align="center">6675 ($1A13)</td>
<td align="center">6430 ($191E)</td>
<td align="center">6599 ($19C7)</td>
<td align="center">6357 ($18D5)</td>
</tr>
<tr>
<td align="center">A4</td>
<td align="center">7217 ($1C31)</td>
<td align="center">7072 ($1BA0)</td>
<td align="center">6813 ($1A9D)</td>
<td align="center">6992 ($1B50)</td>
<td align="center">6735 ($1A4F)</td>
</tr>
<tr>
<td align="center">A#4</td>
<td align="center">7647 ($1DDF)</td>
<td align="center">7492 ($1D44)</td>
<td align="center">7218 ($1C32)</td>
<td align="center">7407 ($1CEF)</td>
<td align="center">7136 ($1BE0)</td>
</tr>
<tr>
<td align="center">B4</td>
<td align="center">8101 ($1FA5)</td>
<td align="center">7938 ($1F02)</td>
<td align="center">7647 ($1DDF)</td>
<td align="center">7848 ($1EA8)</td>
<td align="center">7560 ($1D88)</td>
</tr>
<tr>
<td align="center">C5</td>
<td align="center">8583 ($2187)</td>
<td align="center">8410 ($20DA)</td>
<td align="center">8102 ($1FA6)</td>
<td align="center">8314 ($207A)</td>
<td align="center">8010 ($1F4A)</td>
</tr>
<tr>
<td align="center">C#5</td>
<td align="center">9094 ($2386)</td>
<td align="center">8910 ($22CE)</td>
<td align="center">8584 ($2188)</td>
<td align="center">8809 ($2269)</td>
<td align="center">8486 ($2126)</td>
</tr>
<tr>
<td align="center">D5</td>
<td align="center">9634 ($25A2)</td>
<td align="center">9440 ($24E0)</td>
<td align="center">9094 ($2386)</td>
<td align="center">9333 ($2475)</td>
<td align="center">8991 ($231F)</td>
</tr>
<tr>
<td align="center">D#5</td>
<td align="center">10207 ($27DF)</td>
<td align="center">10001 ($2711)</td>
<td align="center">9635 ($25A3)</td>
<td align="center">9888 ($26A0)</td>
<td align="center">9525 ($2535)</td>
</tr>
<tr>
<td align="center">E5</td>
<td align="center">10814 ($2A3E)</td>
<td align="center">10596 ($2964)</td>
<td align="center">10208 ($27E0)</td>
<td align="center">10476 ($28EC)</td>
<td align="center">10092 ($276C)</td>
</tr>
<tr>
<td align="center">F5</td>
<td align="center">11457 ($2CC1)</td>
<td align="center">11226 ($2BDA)</td>
<td align="center">10815 ($2A3F)</td>
<td align="center">11098 ($2B5A)</td>
<td align="center">10692 ($29C4)</td>
</tr>
<tr>
<td align="center">F#5</td>
<td align="center">12139 ($2F6B)</td>
<td align="center">11894 ($2E76)</td>
<td align="center">11458 ($2CC2)</td>
<td align="center">11758 ($2DEE)</td>
<td align="center">11328 ($2C40)</td>
</tr>
<tr>
<td align="center">G5</td>
<td align="center">12860 ($323C)</td>
<td align="center">12601 ($3139)</td>
<td align="center">12139 ($2F6B)</td>
<td align="center">12458 ($30AA)</td>
<td align="center">12001 ($2EE1)</td>
</tr>
<tr>
<td align="center">G#5</td>
<td align="center">13625 ($3539)</td>
<td align="center">13350 ($3426)</td>
<td align="center">12861 ($323D)</td>
<td align="center">13198 ($338E)</td>
<td align="center">12715 ($31AB)</td>
</tr>
<tr>
<td align="center">A5</td>
<td align="center">14435 ($3863)</td>
<td align="center">14144 ($3740)</td>
<td align="center">13626 ($353A)</td>
<td align="center">13983 ($369F)</td>
<td align="center">13471 ($349F)</td>
</tr>
<tr>
<td align="center">A#5</td>
<td align="center">15294 ($3BBE)</td>
<td align="center">14985 ($3A89)</td>
<td align="center">14436 ($3864)</td>
<td align="center">14815 ($39DF)</td>
<td align="center">14272 ($37C0)</td>
</tr>
<tr>
<td align="center">B5</td>
<td align="center">16203 ($3F4B)</td>
<td align="center">15876 ($3E04)</td>
<td align="center">15294 ($3BBE)</td>
<td align="center">15696 ($3D50)</td>
<td align="center">15120 ($3B10)</td>
</tr>
<tr>
<td align="center">C6</td>
<td align="center">17167 ($430F)</td>
<td align="center">16820 ($41B4)</td>
<td align="center">16204 ($3F4C)</td>
<td align="center">16629 ($40F5)</td>
<td align="center">16020 ($3E94)</td>
</tr>
<tr>
<td align="center">C#6</td>
<td align="center">18188 ($470C)</td>
<td align="center">17820 ($459C)</td>
<td align="center">17167 ($430F)</td>
<td align="center">17618 ($44D2)</td>
<td align="center">16972 ($424C)</td>
</tr>
<tr>
<td align="center">D6</td>
<td align="center">19269 ($4B45)</td>
<td align="center">18880 ($49C0)</td>
<td align="center">18188 ($470C)</td>
<td align="center">18665 ($48E9)</td>
<td align="center">17981 ($463D)</td>
</tr>
<tr>
<td align="center">D#6</td>
<td align="center">20415 ($4FBF)</td>
<td align="center">20003 ($4E23)</td>
<td align="center">19270 ($4B46)</td>
<td align="center">19775 ($4D3F)</td>
<td align="center">19051 ($4A6B)</td>
</tr>
<tr>
<td align="center">E6</td>
<td align="center">21629 ($547D)</td>
<td align="center">21192 ($52C8)</td>
<td align="center">20415 ($4FBF)</td>
<td align="center">20951 ($51D7)</td>
<td align="center">20183 ($4ED7)</td>
</tr>
<tr>
<td align="center">F6</td>
<td align="center">22915 ($5983)</td>
<td align="center">22452 ($57B4)</td>
<td align="center">21629 ($547D)</td>
<td align="center">22197 ($56B5)</td>
<td align="center">21384 ($5388)</td>
</tr>
<tr>
<td align="center">F#6</td>
<td align="center">24278 ($5ED6)</td>
<td align="center">23787 ($5CEB)</td>
<td align="center">22916 ($5984)</td>
<td align="center">23517 ($5BDD)</td>
<td align="center">22655 ($587F)</td>
</tr>
<tr>
<td align="center">G6</td>
<td align="center">25721 ($6479)</td>
<td align="center">25202 ($6272)</td>
<td align="center">24278 ($5ED6)</td>
<td align="center">24915 ($6153)</td>
<td align="center">24002 ($5DC2)</td>
</tr>
<tr>
<td align="center">G#6</td>
<td align="center">27251 ($6A73)</td>
<td align="center">26700 ($684C)</td>
<td align="center">25722 ($647A)</td>
<td align="center">26397 ($671D)</td>
<td align="center">25429 ($6355)</td>
</tr>
<tr>
<td align="center">A6</td>
<td align="center">28871 ($70C7)</td>
<td align="center">28288 ($6E80)</td>
<td align="center">27251 ($6A73)</td>
<td align="center">27966 ($6D3E)</td>
<td align="center">26942 ($693E)</td>
</tr>
<tr>
<td align="center">A#6</td>
<td align="center">30588 ($777C)</td>
<td align="center">29970 ($7512)</td>
<td align="center">28872 ($70C8)</td>
<td align="center">29629 ($73BD)</td>
<td align="center">28544 ($6F80)</td>
</tr>
<tr>
<td align="center">B6</td>
<td align="center">32407 ($7E97)</td>
<td align="center">31752 ($7C08)</td>
<td align="center">30589 ($777D)</td>
<td align="center">31391 ($7A9F)</td>
<td align="center">30241 ($7621)</td>
</tr>
<tr>
<td align="center">C7</td>
<td align="center">34334 ($861E)</td>
<td align="center">33640 ($8368)</td>
<td align="center">32407 ($7E97)</td>
<td align="center">33258 ($81EA)</td>
<td align="center">32039 ($7D27)</td>
</tr>
<tr>
<td align="center">C#7</td>
<td align="center">36376 ($8E18)</td>
<td align="center">35641 ($8B39)</td>
<td align="center">34334 ($861E)</td>
<td align="center">35236 ($89A4)</td>
<td align="center">33944 ($8498)</td>
</tr>
<tr>
<td align="center">D7</td>
<td align="center">38539 ($968B)</td>
<td align="center">37760 ($9380)</td>
<td align="center">36376 ($8E18)</td>
<td align="center">37331 ($91D3)</td>
<td align="center">35963 ($8C7B)</td>
</tr>
<tr>
<td align="center">D#7</td>
<td align="center">40830 ($9F7E)</td>
<td align="center">40005 ($9C45)</td>
<td align="center">38539 ($968B)</td>
<td align="center">39551 ($9A7F)</td>
<td align="center">38101 ($94D5)</td>
</tr>
<tr>
<td align="center">E7</td>
<td align="center">43258 ($A8FA)</td>
<td align="center">42384 ($A590)</td>
<td align="center">40831 ($9F7F)</td>
<td align="center">41902 ($A3AE)</td>
<td align="center">40367 ($9DAF)</td>
</tr>
<tr>
<td align="center">F7</td>
<td align="center">45830 ($B306)</td>
<td align="center">44904 ($AF68)</td>
<td align="center">43259 ($A8FB)</td>
<td align="center">44394 ($AD6A)</td>
<td align="center">42767 ($A70F)</td>
</tr>
<tr>
<td align="center">F#7</td>
<td align="center">48556 ($BDAC)</td>
<td align="center">47574 ($B9D6)</td>
<td align="center">45831 ($B307)</td>
<td align="center">47034 ($B7BA)</td>
<td align="center">45310 ($B0FE)</td>
</tr>
<tr>
<td align="center">G7</td>
<td align="center">51443 ($C8F3)</td>
<td align="center">50403 ($C4E3)</td>
<td align="center">48556 ($BDAC)</td>
<td align="center">49831 ($C2A7)</td>
<td align="center">48004 ($BB84)</td>
</tr>
<tr>
<td align="center">G#7</td>
<td align="center">54502 ($D4E6)</td>
<td align="center">53400 ($D098)</td>
<td align="center">51444 ($C8F4)</td>
<td align="center">52794 ($CE3A)</td>
<td align="center">50859 ($C6AB)</td>
</tr>
<tr>
<td align="center">A7</td>
<td align="center">57743 ($E18F)</td>
<td align="center">56576 ($DD00)</td>
<td align="center">54503 ($D4E7)</td>
<td align="center">55933 ($DA7D)</td>
<td align="center">53883 ($D27B)</td>
</tr>
<tr>
<td align="center">A#7</td>
<td align="center">61176 ($EEF8)</td>
<td align="center">59940 ($EA24)</td>
<td align="center">57743 ($E18F)</td>
<td align="center">59259 ($E77B)</td>
<td align="center">57087 ($DEFF)</td>
</tr>
<tr>
<td align="center">B7</td>
<td align="center">64814 ($FD2E)</td>
<td align="center">63504 ($F810)</td>
<td align="center">61177 ($EEF9)</td>
<td align="center">62783 ($F53F)</td>
<td align="center">60482 ($EC42)</td>
</tr>
</tbody>
</table><p>Como los cálculos de coma flotante derivan en diferentes grados de errores de precisión, podemos encontrar otras tablas con diferentes valores precalculados. Por ejemplo, tenemos la de la referencia del <a href="http://archive.6502.org/datasheets/mos_6581_sid.pdf">MOS 6581</a>, o esta <a href="https://sta.c64.org/cbm64sndfreq.html">versión</a> que incorpora el afinado de 435 Hz, o esta otra <a href="https://gist.github.com/matozoid/18cddcbc9cfade3c455bc6230e1f6da6">versión</a> que incorpora las versiones para PAL y NTSC.</p>
<h3 id="reproduciendo-música">Reproduciendo música</h3>
<p>La composición musical usa una <a href="https://es.wikipedia.org/wiki/Notaci%C3%B3n_musical">notación estándar</a> y dispone del protocolo <a href="https://es.wikipedia.org/wiki/MIDI">MIDI</a> para el mundo digital. Sin embargo, a principio de los años 80 el MIDI no era todavía una realidad palpable. Por ello la composición musical en el C64 implica tener un formato propio para describir la música y una implementación para transformar las notas descritas en frecuencias, mientras se controla su duración. Por ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> DATOS FRECUENCIAS PAL (OCTAVA 7)</span>
<span class="token number">20</span>  <span class="token keyword">DATA</span> <span class="token number">33640</span><span class="token punctuation">,</span><span class="token number">35641</span><span class="token punctuation">,</span><span class="token number">37760</span><span class="token punctuation">,</span><span class="token number">40005</span><span class="token punctuation">,</span><span class="token number">42384</span><span class="token punctuation">,</span><span class="token number">44904</span>
<span class="token number">30</span>  <span class="token keyword">DATA</span> <span class="token number">47574</span><span class="token punctuation">,</span><span class="token number">50403</span><span class="token punctuation">,</span><span class="token number">53400</span><span class="token punctuation">,</span><span class="token number">56576</span><span class="token punctuation">,</span><span class="token number">59940</span><span class="token punctuation">,</span><span class="token number">63504</span>
<span class="token number">40</span>  <span class="token comment"><span class="token keyword">REM</span> DATOS CANCION (FRERE JACQUES)</span>
<span class="token number">50</span>  <span class="token comment"><span class="token keyword">REM</span> NOTA=(OCTAVA,NOTA,DURACION)</span>
<span class="token number">60</span>  <span class="token comment"><span class="token keyword">REM</span> (C=0,D=2,E=4,F=5,G=7,A=9,B=11)</span>
<span class="token number">70</span>  <span class="token comment"><span class="token keyword">REM</span> (R=64,B=32,N=16,C=8,SC=4,F=2,SF=1)</span>
<span class="token number">80</span>  <span class="token comment"><span class="token keyword">REM</span> [=== (C4,D4,E4,C4)X2 ===]</span>
<span class="token number">90</span>  <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token number">100</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token number">110</span> <span class="token comment"><span class="token keyword">REM</span> [=== (E4,F4,G4*2)X2 ===]</span>
<span class="token number">120</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">32</span>
<span class="token number">130</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">32</span>
<span class="token number">140</span> <span class="token comment"><span class="token keyword">REM</span> [=== (G4/2,A4/2,G4/2,F4/2,E4,C4)X2 ===]</span>
<span class="token number">150</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token number">160</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token number">170</span> <span class="token comment"><span class="token keyword">REM</span> [=== (C4,G4,C4*2)X2 ===]</span>
<span class="token number">180</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">32</span>
<span class="token number">190</span> <span class="token keyword">DATA</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">32</span>
<span class="token number">200</span> <span class="token comment"><span class="token keyword">REM</span> CONFIGURAR SID</span>
<span class="token number">210</span> <span class="token keyword">DIM</span> F<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>G<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">220</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">11</span>
<span class="token number">230</span> <span class="token keyword">READ</span> V<span class="token punctuation">:</span>F<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token operator">=</span>V
<span class="token number">240</span> <span class="token keyword">NEXT</span> I
<span class="token number">250</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">260</span> G<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">-</span>I<span class="token punctuation">)</span>
<span class="token number">270</span> <span class="token keyword">NEXT</span> I
<span class="token number">280</span> V1<span class="token operator">=</span><span class="token number">54272</span>      <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> DIR. BASE VOZ 1</span>
<span class="token number">290</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ANCHO PULSO (LOW)</span>
<span class="token number">300</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span>   <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ANCHO PULSO (HIGH)</span>
<span class="token number">310</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">80</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> REG. CONTROL</span>
<span class="token number">320</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">128</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> ATTACK/DECAY</span>
<span class="token number">330</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">248</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> SUSTAIN/RELEASE</span>
<span class="token number">340</span> <span class="token keyword">POKE</span> <span class="token number">54296</span><span class="token punctuation">,</span><span class="token number">15</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> VOLUMEN GLOBAL</span>
<span class="token number">350</span> <span class="token comment"><span class="token keyword">REM</span> REPRODUCIR CANCION</span>
<span class="token number">360</span> CS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">:</span>MS<span class="token operator">=</span><span class="token number">32</span>
<span class="token number">370</span> <span class="token keyword">READ</span> OC<span class="token punctuation">,</span>NT<span class="token punctuation">,</span>LN
<span class="token number">380</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">80</span>
<span class="token number">390</span> NF<span class="token operator">=</span>F<span class="token punctuation">(</span>NT<span class="token punctuation">)</span><span class="token operator">/</span>G<span class="token punctuation">(</span>OC<span class="token punctuation">)</span>
<span class="token number">400</span> HB<span class="token operator">=</span><span class="token function">INT</span><span class="token punctuation">(</span>NF<span class="token operator">/</span><span class="token number">256</span><span class="token punctuation">)</span>
<span class="token number">410</span> <span class="token keyword">POKE</span> V1<span class="token punctuation">,</span>NF<span class="token operator">-</span>HB<span class="token operator">*</span><span class="token number">256</span>
<span class="token number">420</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>HB
<span class="token number">430</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">81</span>
<span class="token number">440</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> LN<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token keyword">NEXT</span> I
<span class="token number">450</span> CS<span class="token operator">=</span>CS<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">460</span> <span class="token keyword">IF</span> CS<span class="token operator">&lt;</span>MS <span class="token keyword">THEN</span> <span class="token number">370</span>
<span class="token number">470</span> <span class="token keyword">POKE</span> V1<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">80</span>
</code></pre>
<p>Este programa reproduce una canción muy sencilla, configurando una voz con una mezcla de la onda cuadrada y la triangular. Se cargan las frecuencias de la séptima octava, para poder dividir entre múltiplos de 2 para calcular el resto de frecuencias. Para reproducirla se lee cada nota de la “partitura”, que indica su octava, la nota dentro de la escala y su duración.</p>
<p>A pesar de lo rudimentario, del método utilizando en el ejemplo, no deja de ser un tanto farragoso describir y reproducir música. El chip SID es capaz de mucho más y por ello se utilizan programas, como <strong>CheeseCutter</strong> o <strong>GoatTracker 2</strong>, para componer música en <a href="https://gist.github.com/cbmeeks/2b107f0a8d36fc461ebb056e94b2f4d6"><strong>formato SID</strong></a>. Este formato se originó para poder reproducir música con un chip SID emulado vía software en otras máquinas. Los ficheros incorporan en su interior un programa, en código máquina del 6510, para reproducir el sonido.</p>
<p>Esta facilidad no está disponible en BASIC, por lo que hay que recurrir al ensamblador para trabajar con ficheros SID. Si queremos incorporar una canción como parte del ejecutable, tenemos que incluir lo siguiente:</p>
<pre><code>* = $C800
incbin "musica.sid",126
</code></pre>
<p>Esto incluye como parte del ejecutable un fichero binario, en la dirección $C800, saltando <strong>126 bytes</strong> de su contenido. Estos bytes corresponden con la <strong>cabecera</strong> que da una descripción útil del contenido del fichero y se usa para los reproductores de música SID en otras plataformas, es por ello que no vamos a necesitar esa parte para el C64. Una vez cargado en memoria el programa, hay que invocar la <strong>subrutina</strong> que <strong>inicializa</strong> la canción, para poder reproducirla. Si se trata de un fichero que contiene varias canciones, usando el <strong>registro A</strong> podemos seleccionar aquella que necesitemos. Una vez inicializada la canción, se configura la rutina de gestión de interrupciones y dentro de esta se invoca la <strong>subrutina</strong> que <strong>actualiza</strong> la <strong>reproducción</strong> de la canción.</p>
<p>Como los ficheros SID tienen en su interior el programa ya compilado, necesitan estar ubicados en la dirección de memoria que indica la cabecera, para poder ejecutarse correctamente. Si esto supusiera un problema, porque necesitamos cambiar de ubicación en la memoria la canción, existe una herramienta llamada <a href="http://www.linusakesson.net/software/sidreloc/">SIDreloc</a> que permite reubicar un fichero SID.</p>
<h2 id="entrada-y-salida">Entrada y salida</h2>
<p>La gestión a bajo nivel de la E/S del C64 se realiza desde los chips CIA1 y CIA2. Con estos chips podemos controlar múltiples tipos de dispositivos, pero nos vamos a centrar en tres áreas: el teclado, los joysticks y la gestión de temporizadores.</p>
<h3 id="direcciones-de-memoria">Direcciones de memoria</h3>
<p>El chip CIA1 se puede acceder desde las siguientes direcciones de memoria:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th align="center">Hexadecimal</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">56320</td>
<td align="center">$DC00</td>
<td>Puerto A: Matriz de teclado y joystick 2.</td>
</tr>
<tr>
<td align="center">56321</td>
<td align="center">$DC01</td>
<td>Puerto B: Matriz de teclado y joystick 1.</td>
</tr>
<tr>
<td align="center">56322</td>
<td align="center">$DC02</td>
<td>Configuración del puerto A.</td>
</tr>
<tr>
<td align="center">56323</td>
<td align="center">$DC03</td>
<td>Configuración del puerto B.</td>
</tr>
<tr>
<td align="center">56324-56325</td>
<td align="center">$DC04-$DC05</td>
<td>Cuenta atrás A.</td>
</tr>
<tr>
<td align="center">56326-56327</td>
<td align="center">$DC06-$DC07</td>
<td>Cuenta atrás B.</td>
</tr>
<tr>
<td align="center">56328</td>
<td align="center">$DC08</td>
<td>TOD/Alarma: Décimas.</td>
</tr>
<tr>
<td align="center">56329</td>
<td align="center">$DC09</td>
<td>TOD/Alarma: Segundos.</td>
</tr>
<tr>
<td align="center">56330</td>
<td align="center">$DC0A</td>
<td>TOD/Alarma: Minutos.</td>
</tr>
<tr>
<td align="center">56331</td>
<td align="center">$DC0B</td>
<td>TOD/Alarma: Horas.</td>
</tr>
<tr>
<td align="center">56332</td>
<td align="center">$DC0C</td>
<td>E/S de datos por el puerto de usuario.</td>
</tr>
<tr>
<td align="center">56333</td>
<td align="center">$DC0D</td>
<td>Registro de control de interrupciones.</td>
</tr>
<tr>
<td align="center">56334</td>
<td align="center">$DC0E</td>
<td>Registro de control de la cuenta atrás A.</td>
</tr>
<tr>
<td align="center">56335</td>
<td align="center">$DC0F</td>
<td>Registro de control de la cuenta atrás B.</td>
</tr>
</tbody>
</table><p>En el mapa de memoria viene indicado cuáles son las posiciones de memoria del CIA2, que sirven para gestionar el puerto serie y el puerto de usuario entre otras cosas. Las interrupciones del CIA1 están conectadas al pin IRQ de la CPU, por lo tanto son enmascarables, mientras que las del CIA2 van al pin NMI y no son enmascarables. Las interrupciones se explican con más detalle en la sección del lenguaje ensamblador.</p>
<h3 id="teclado">Teclado</h3>
<p>Para poder comprobar si una tecla está pulsada necesitamos consultar la matriz del teclado:</p>

<table>
<thead>
<tr>
<th align="center">A/B</th>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>0</strong></td>
<td align="center"><code>INST/DEL</code></td>
<td align="center"><code>RETURN</code></td>
<td align="center"><code>⇐CRSR⇒</code></td>
<td align="center"><code>F7</code></td>
<td align="center"><code>F1</code></td>
<td align="center"><code>F3</code></td>
<td align="center"><code>F5</code></td>
<td align="center"><code>⇑CRSR⇓</code></td>
</tr>
<tr>
<td align="center"><strong>1</strong></td>
<td align="center"><code>3</code></td>
<td align="center"><code>W</code></td>
<td align="center"><code>A</code></td>
<td align="center"><code>4</code></td>
<td align="center"><code>Z</code></td>
<td align="center"><code>S</code></td>
<td align="center"><code>E</code></td>
<td align="center"><code>SHIFT</code> (Iz.)</td>
</tr>
<tr>
<td align="center"><strong>2</strong></td>
<td align="center"><code>5</code></td>
<td align="center"><code>R</code></td>
<td align="center"><code>D</code></td>
<td align="center"><code>6</code></td>
<td align="center"><code>C</code></td>
<td align="center"><code>F</code></td>
<td align="center"><code>T</code></td>
<td align="center"><code>X</code></td>
</tr>
<tr>
<td align="center"><strong>3</strong></td>
<td align="center"><code>7</code></td>
<td align="center"><code>Y</code></td>
<td align="center"><code>G</code></td>
<td align="center"><code>8</code></td>
<td align="center"><code>B</code></td>
<td align="center"><code>H</code></td>
<td align="center"><code>U</code></td>
<td align="center"><code>V</code></td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td align="center"><code>9</code></td>
<td align="center"><code>I</code></td>
<td align="center"><code>J</code></td>
<td align="center"><code>0</code></td>
<td align="center"><code>M</code></td>
<td align="center"><code>K</code></td>
<td align="center"><code>O</code></td>
<td align="center"><code>N</code></td>
</tr>
<tr>
<td align="center"><strong>5</strong></td>
<td align="center"><code>+</code></td>
<td align="center"><code>P</code></td>
<td align="center"><code>L</code></td>
<td align="center"><code>-</code></td>
<td align="center"><code>.</code></td>
<td align="center"><code>:</code></td>
<td align="center"><code>@</code></td>
<td align="center"><code>,</code></td>
</tr>
<tr>
<td align="center"><strong>6</strong></td>
<td align="center"><code>£</code></td>
<td align="center"><code>*</code></td>
<td align="center"><code>;</code></td>
<td align="center"><code>CLR/HOME</code></td>
<td align="center"><code>SHIFT</code> (De.)</td>
<td align="center"><code>=</code></td>
<td align="center"><code>↑</code></td>
<td align="center"><code>/</code></td>
</tr>
<tr>
<td align="center"><strong>7</strong></td>
<td align="center"><code>1</code></td>
<td align="center"><code>←</code></td>
<td align="center"><code>CTRL</code></td>
<td align="center"><code>2</code></td>
<td align="center"><code>SPACE</code></td>
<td align="center"><code>C=</code></td>
<td align="center"><code>Q</code></td>
<td align="center"><code>RUN/STOP</code></td>
</tr>
</tbody>
</table><p>Esta matriz cubre 64 de las 66 teclas del teclado (<code>RESTORE</code> está asociada al pin NMI y <code>SHIFT LOCK</code> está ligada al <code>SHIFT</code> izquierdo). Las filas son los bits que podemos configurar con el puerto A ($DC00) y las columnas los bits que podemos leer del puerto B ($DC01). Para ello hay que configurar el puerto A de escritura ($DC02 = $FF) y el puerto B de lectura ($DC03 = $00). Luego hay que asignar un 0 al bit que representa la fila correspondiente en el puerto A, para comprobar en el puerto B el estado de las teclas de dicha fila (0 = pulsada; 1 = no pulsada). Por ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR DATOS</span>
<span class="token number">20</span>  <span class="token keyword">DIM</span> K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> M%<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">30</span>  N%<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">40</span>  <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">50</span>  M%<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token operator">=</span>N%
<span class="token number">60</span>  N%<span class="token operator">=</span>N%<span class="token operator">*</span><span class="token number">2</span>
<span class="token number">70</span>  <span class="token keyword">NEXT</span> I
<span class="token number">80</span>  K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"DEL"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"RET"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"LRC"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"F7"</span>
<span class="token number">90</span>  K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"F1"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"F3"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"F5"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"UDC"</span>
<span class="token number">100</span> K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"3"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"W"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"A"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"4"</span>
<span class="token number">110</span> K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"Z"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"S"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"E"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"LSH"</span>
<span class="token number">120</span> K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"5"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"R"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"D"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"6"</span>
<span class="token number">130</span> K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"C"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"F"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"T"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"X"</span>
<span class="token number">140</span> K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"7"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"Y"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"G"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"8"</span>
<span class="token number">150</span> K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"B"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"H"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"U"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"V"</span>
<span class="token number">160</span> K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"9"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"I"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"J"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"0"</span>
<span class="token number">170</span> K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"M"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"K"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"O"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"N"</span>
<span class="token number">180</span> K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"+"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"P"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"L"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"-"</span>
<span class="token number">190</span> K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"."</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span>"@<span class="token string">":K$(5,7)="</span><span class="token punctuation">,</span>"
<span class="token number">200</span> K$<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span>"{pound}<span class="token string">":K$(6,1)="</span><span class="token operator">*</span><span class="token string">":K$(6,2)="</span><span class="token punctuation">;</span><span class="token string">":K$(6,3)="</span>HOM"
<span class="token number">210</span> K$<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"RSH"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"="</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"^"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"/"</span>
<span class="token number">220</span> K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>"{arrow <span class="token function">left</span>}<span class="token string">":K$(7,2)="</span>CTR<span class="token string">":K$(7,3)="</span><span class="token number">2</span>"
<span class="token number">230</span> K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"SPC"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"C="</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"Q"</span><span class="token punctuation">:</span>K$<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"STP"</span>
<span class="token number">240</span> <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR PANTALLA</span>
<span class="token number">250</span> <span class="token function">PRINT</span> "{<span class="token keyword">clear</span>}"<span class="token punctuation">;</span>
<span class="token number">260</span> <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">1</span>    <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR CURSOR</span>
<span class="token number">270</span> <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR FONDO</span>
<span class="token number">280</span> <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span><span class="token number">12</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR BORDE</span>
<span class="token number">290</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">300</span> <span class="token keyword">FOR</span> J<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">310</span> <span class="token function">PRINT</span> <span class="token function">TAB</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">*</span>J<span class="token punctuation">)</span><span class="token punctuation">;</span>K$<span class="token punctuation">(</span>I<span class="token punctuation">,</span>J<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">320</span> <span class="token keyword">NEXT</span> J<span class="token punctuation">:</span><span class="token function">PRINT</span>
<span class="token number">330</span> <span class="token keyword">NEXT</span> I
<span class="token number">340</span> <span class="token comment"><span class="token keyword">REM</span> CONFIGURAR TECLADO</span>
<span class="token number">350</span> <span class="token keyword">POKE</span> <span class="token number">56322</span><span class="token punctuation">,</span><span class="token number">255</span>
<span class="token number">360</span> <span class="token keyword">POKE</span> <span class="token number">56323</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">370</span> <span class="token comment"><span class="token keyword">REM</span> BUCLE PRINCIPAL</span>
<span class="token number">380</span> X<span class="token operator">=</span><span class="token number">55296</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> BUFFER DE COLOR</span>
<span class="token number">390</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">400</span> <span class="token keyword">POKE</span> <span class="token number">56320</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token operator">-</span>M%<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
<span class="token number">410</span> K%<span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">56321</span><span class="token punctuation">)</span>
<span class="token number">420</span> <span class="token keyword">FOR</span> J<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">7</span>
<span class="token number">430</span> C%<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>K% <span class="token operator">AND</span> M%<span class="token punctuation">(</span>J<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> C%<span class="token operator">=</span><span class="token number">10</span>
<span class="token number">440</span> <span class="token keyword">POKE</span> X<span class="token punctuation">,</span>C%<span class="token punctuation">:</span>X<span class="token operator">=</span>X<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">450</span> <span class="token keyword">POKE</span> X<span class="token punctuation">,</span>C%<span class="token punctuation">:</span>X<span class="token operator">=</span>X<span class="token operator">+</span><span class="token number">1</span>
<span class="token number">460</span> <span class="token keyword">POKE</span> X<span class="token punctuation">,</span>C%<span class="token punctuation">:</span>X<span class="token operator">=</span>X<span class="token operator">+</span><span class="token number">3</span>
<span class="token number">470</span> <span class="token keyword">NEXT</span> J<span class="token punctuation">,</span>I
<span class="token number">480</span> <span class="token keyword">GOTO</span> <span class="token number">380</span>
</code></pre>
<p>Aquí tenemos un programa BASIC que las líneas <code>20</code>-<code>230</code> inicializan la información que va a utilizar, las líneas <code>250</code>-<code>330</code> pinta en pantalla una tabla de las teclas de la matriz, las líneas <code>350</code>-<code>360</code> configura los puertos de la CIA1, por ultimo, el resto de líneas es un bucle infinito que selecciona en <code>400</code> la fila de la matriz a inspeccionar y en <code>410</code> obtiene su valor, para comprobar las teclas pulsadas de la fila y cambiar de color el texto si está pulsada la tecla. Lo que se puede observar es que intentar consultar el teclado así desde BASIC es muy lento e impracticable. Mientras que el mismo ejemplo en C, usando el compilador CC65:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;conio.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> POKE(A,X)  (*(unsigned char *)A) = (X)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PEEK(A)    (*(unsigned char *)A)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> POKEW(A,X) (*(unsigned int *)A) = (X)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PEEKW(A)   (*(unsigned int *)A)</span>

<span class="token macro property">#<span class="token directive keyword">define</span> MAX_ROWS 8</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAX_COLS 8</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> offset<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> aux<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> mask<span class="token punctuation">[</span>MAX_COLS<span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> color<span class="token punctuation">;</span>
    
    aux <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> MAX_COLS<span class="token punctuation">;</span> <span class="token operator">++</span>col<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mask<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> aux<span class="token punctuation">;</span>
        aux <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">53272</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fuente mayúsculas</span>
    <span class="token function">POKE</span><span class="token punctuation">(</span>  <span class="token number">646</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color cursor</span>
    <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">53281</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color fondo</span>
    <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">53280</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color borde</span>
    
    <span class="token function">clrscr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"keyboard test!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"del  ret  lrc  f7   f1   f3   f5   udc\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"3    w    a    4    z    s    e    lsh\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"5    r    d    6    c    f    t    x\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"7    y    g    8    b    h    u    v\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"9    i    j    0    m    k    o    n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"+    p    l    -    .    :    @    ,\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c    *    ;    hom  rsh  =    %c    /\n"</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1    %c    ctr  2    spc  c=   q    run\n"</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">56322</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// CIA1 Puerto A en escritura</span>
    <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">56323</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// CIA1 Puerto B en lectura</span>
    
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        offset <span class="token operator">=</span> <span class="token number">55296</span> <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> MAX_ROWS<span class="token punctuation">;</span> <span class="token operator">++</span>row<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">POKE</span><span class="token punctuation">(</span><span class="token number">56320</span><span class="token punctuation">,</span> <span class="token number">255</span> <span class="token operator">-</span> mask<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            keys <span class="token operator">=</span> <span class="token function">PEEK</span><span class="token punctuation">(</span><span class="token number">56321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> MAX_COLS<span class="token punctuation">;</span> <span class="token operator">++</span>col<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>keys <span class="token operator">&amp;</span> mask<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    color <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    color <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span>aux <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> aux <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>aux<span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">POKE</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Podemos observar que sin embargo sí reacciona de forma fluida la captura de las pulsaciones de las teclas. Esto conlleva a recurrir desde BASIC al comando <code>GET</code> para la entrada por teclado, intentando no forzar la máquina demasiado frente a la lentitud del interprete.</p>
<h3 id="joysticks">Joysticks</h3>
<p>El C64 permite tener dos joysticks conectados, uno en cada puerto de control del lateral de la máquina. Para poder comprobar el estado del joystick del puerto de control 1 usaremos el puerto B ($DC01) y para el joystick del puerto de control 2 usaremos el puerto A ($DC00). En cada puerto podemos comprobar los cinco elementos del joystick (0 = pulsada; 1 = no pulsada):</p>
<ul>
<li><strong>00011111</strong> = Nada pulsado.</li>
<li><strong>00001111</strong> = Disparo pulsado.</li>
<li><strong>00010111</strong> = Derecha pulsado.</li>
<li><strong>00011011</strong> = Izquierda pulsado.</li>
<li><strong>00011101</strong> = Abajo pulsado.</li>
<li><strong>00011110</strong> = Arriba pulsado.</li>
</ul>
<p>En cuanto a la configuración de los puertos, es irrelevante ya que en modo escritura también se puede leer los puertos, además si configuramos como lectura el puerto A, no se podrán detectar las pulsaciones del teclado. Para comprenderlo mejor, veamos el siguiente ejemplo:</p>
<pre class=" language-basic"><code class="prism  language-basic"><span class="token number">10</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR DATOS</span>
<span class="token number">20</span>  <span class="token keyword">DIM</span> M%<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">30</span>  N%<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">40</span>  <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">4</span>
<span class="token number">50</span>  M%<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token operator">=</span>N%
<span class="token number">60</span>  N%<span class="token operator">=</span>N%<span class="token operator">*</span><span class="token number">2</span>
<span class="token number">70</span>  <span class="token keyword">NEXT</span> I
<span class="token number">80</span>  <span class="token comment"><span class="token keyword">REM</span> INICIALIZAR PANTALLA</span>
<span class="token number">90</span>  <span class="token function">PRINT</span> "{<span class="token keyword">clear</span>}"<span class="token punctuation">;</span>
<span class="token number">100</span> <span class="token keyword">POKE</span> <span class="token number">646</span><span class="token punctuation">,</span><span class="token number">1</span>    <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR CURSOR</span>
<span class="token number">110</span> <span class="token keyword">POKE</span> <span class="token number">53281</span><span class="token punctuation">,</span><span class="token number">0</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR FONDO</span>
<span class="token number">120</span> <span class="token keyword">POKE</span> <span class="token number">53280</span><span class="token punctuation">,</span><span class="token number">12</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> COLOR BORDE</span>
<span class="token number">130</span> <span class="token function">PRINT</span> <span class="token string">"J1: U D L R F"</span>
<span class="token number">140</span> <span class="token function">PRINT</span> <span class="token string">"J2: U D L R F"</span>
<span class="token number">150</span> <span class="token comment"><span class="token keyword">REM</span> CONFIGURAR TECLADO</span>
<span class="token number">160</span> <span class="token keyword">POKE</span> <span class="token number">56322</span><span class="token punctuation">,</span><span class="token number">255</span>
<span class="token number">170</span> <span class="token keyword">POKE</span> <span class="token number">56323</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token number">180</span> <span class="token comment"><span class="token keyword">REM</span> BUCLE PRINCIPAL</span>
<span class="token number">190</span> X<span class="token operator">=</span><span class="token number">55296</span><span class="token operator">+</span><span class="token number">4</span>  <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> BUFFER DE COLOR</span>
<span class="token number">200</span> Y<span class="token operator">=</span><span class="token number">55296</span><span class="token operator">+</span><span class="token number">44</span> <span class="token punctuation">:</span> <span class="token comment"><span class="token keyword">REM</span> BUFFER DE COLOR</span>
<span class="token number">210</span> J2%<span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">56320</span><span class="token punctuation">)</span>
<span class="token number">220</span> J1%<span class="token operator">=</span>PEEK<span class="token punctuation">(</span><span class="token number">56321</span><span class="token punctuation">)</span>
<span class="token number">230</span> <span class="token keyword">FOR</span> I<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">TO</span> <span class="token number">4</span>
<span class="token number">240</span> C%<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>J1% <span class="token operator">AND</span> M%<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> C%<span class="token operator">=</span><span class="token number">10</span>
<span class="token number">250</span> <span class="token keyword">POKE</span> X<span class="token punctuation">,</span>C%<span class="token punctuation">:</span>X<span class="token operator">=</span>X<span class="token operator">+</span><span class="token number">2</span>
<span class="token number">260</span> C%<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>J2% <span class="token operator">AND</span> M%<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> C%<span class="token operator">=</span><span class="token number">10</span>
<span class="token number">270</span> <span class="token keyword">POKE</span> Y<span class="token punctuation">,</span>C%<span class="token punctuation">:</span>Y<span class="token operator">=</span>Y<span class="token operator">+</span><span class="token number">2</span>
<span class="token number">280</span> <span class="token keyword">NEXT</span> I
<span class="token number">290</span> <span class="token keyword">GET</span> K$
<span class="token number">300</span> <span class="token keyword">IF</span> K$<span class="token operator">=</span><span class="token string">" "</span> <span class="token keyword">then</span> <span class="token keyword">end</span>
<span class="token number">310</span> <span class="token keyword">GOTO</span> <span class="token number">190</span>
</code></pre>
<p>Este es un programa BASIC que primero inicializa los datos en las líneas <code>20</code>-<code>70</code>, para luego mostrar por pantalla la información sobre los botones de los joysticks en las líneas <code>90</code>-<code>140</code>. De nuevo se configuran los puertos como en el ejemplo del teclado, para permitir que el interprete pueda luego realizar el comando <code>GET</code>. Por último, llegamos al bucle principal donde se va a cambiar el color del texto dependiendo de si los joysticks están pulsados, para ello en las líneas <code>210</code> y <code>220</code> se leen los puertos A y B, para comprobar en las líneas <code>240</code> y <code>260</code> si está pulsado algún botón o no. Finalmente se ejecuta el comando <code>GET</code>, para dar una opción al programa de salir del bucle.</p>
<h3 id="temporizadores">Temporizadores</h3>
<p>El C64 permite controlar operaciones de tiempo mediante cuentas atrás (<em>timers</em>) o con el reloj del sistema (TOD). Existen dos cuentas atrás, A ($DC04-$DC05) y B ($DC06-$DC07), que son enteros de 16 bits sin signo, donde el primer byte es la parte menos significativa (<em>low</em>) y el segundo byte la más significativa (<em>high</em>). También existen dos registros de control para la cuenta atrás A ($DC0E) y la cuenta atrás B ($DC0F), que tienen las siguientes operaciones:</p>
<ul>
<li><strong>(A/B) Bit 0:</strong> Parar (<strong>0</strong>) o iniciar (<strong>1</strong>) cuenta atrás A/B.</li>
<li><strong>(A/B) Bit 3:</strong> Acción al llegar a cero: reiniciar (<strong>0</strong>) o parar (<strong>1</strong>).</li>
<li><strong>(A) Bit 5:</strong> Usar el reloj interno (<strong>0</strong>) o uno externo (<strong>1</strong>).</li>
<li><strong>(B) Bit 6,5:</strong> Usar el reloj interno (<strong>00</strong>), uno externo (<strong>01</strong>) o contar llegadas a cero de la cuenta atrás A (<strong>10</strong>).</li>
<li><strong>(A) Bit 7:</strong> Velocidad del TOD (<strong>0</strong> = 60 Hz; <strong>1</strong> = 50 Hz).</li>
<li><strong>(B) Bit 7:</strong> Configurar la alarma del TOD (<strong>1</strong>).</li>
</ul>
<p>Una vez configurada la CIA1, para trabajar con operaciones temporales, se deberá configurar la gestión de las interrupciones indicando en $0314-$0315 la dirección de la subrutina encargada de ello. Por defecto el sistema tiene una subrutina en $EA31 para procesar interrupciones. Se podrá consultar desde la subrutina el registro de interrupciones de la CIA1 ($DC0D), cuyos bits de lectura son:</p>
<ul>
<li><strong>Bit 0:</strong> La cuenta atrás A ha cruzado el valor cero.</li>
<li><strong>Bit 1:</strong> La cuenta atrás B ha cruzado el valor cero.</li>
<li><strong>Bit 2:</strong> El reloj del sistema (TOD) y la alarma son iguales.</li>
<li><strong>Bit 7:</strong> Se ha producido una interrupción.</li>
</ul>
<p>En cuanto a los bits de escritura tenemos:</p>
<ul>
<li><strong>Bit 0:</strong> Interrupción por cruzar el valor cero la cuenta atrás A.</li>
<li><strong>Bit 1:</strong> Interrupción por cruzar el valor cero la cuenta atrás B.</li>
<li><strong>Bit 2:</strong> Interrupción por la alarma del reloj del sistema.</li>
<li><strong>Bit 7:</strong> Configuración de la máscara para las interrupciones:
<ul>
<li><strong>Bits 0-6 = 0:</strong> No se modifica la configuración de las interrupciones.</li>
<li><strong>Bits 0-6 = 1:</strong> Si Bit 7 = 0: Desactivar interrupciones; Si Bit 7 = 1: Activar interrupciones.</li>
</ul>
</li>
</ul>
<p>Por defecto están activadas las interrupciones, por lo que se podrá leer el registro para comprobar si se ha activado una interrupción o no.</p>
<p>El otro mecanismo es el reloj del sistema que nos da la hora del día (TOD), en formato hora, minutos, segundos y décimas de segundos. Los valores se almacenan en formato <a href="https://es.wikipedia.org/wiki/Decimal_codificado_en_binario">BCD</a>, aunque el bit 7 en el byte de la hora se utiliza para indicar si se trata de la hora AM (<strong>0</strong>) o PM (<strong>1</strong>). Con el registro de control en $DC0F, si el bit 7 es <strong>1</strong> podemos escribir en los registros de la TOD la hora de la alarma, para poder obtener una interrupción cuando se alcance la hora del día indicada por la alarma. Tanto para la lectura de la TOD, como para la escritura, tiene la CIA un mecanismo de bloqueo (<em>latching</em>) que congela los registros hasta que las décimas sean leídas o escritas, para evitar inconsistencias. Este mecanismo no impide que internamente se siga actualizando la TOD, hasta que se haya escrito o leído entera la información accesible desde la memoria.</p>
<blockquote>
<p><strong>AVISO:</strong> El interprete y la terminal de BASIC usan internamente los temporizadores, por lo que su uso desde un programa escrito en BASIC puede derivar en problemas inesperados. En caso de necesitar gestionar el tiempo se puede usar la variable <code>TIME</code>. El manejo del tiempo mediante el uso de las CIAs deberá hacerse con programas en código máquina que activen la gestión de las interrupciones.</p>
</blockquote>
<h2 id="kernal">KERNAL</h2>
<p>Esta sección es un listado de algunas rutinas que podemos usar del KERNAL y del interprete de BASIC. Para más información sobre las rutinas del C64, en inglés, puedes consultar la siguiente <a href="https://sta.c64.org/cbmdocs.html">documentación</a> o el <a href="http://unusedino.de/ec64/technical/aay/c64/">listado de memoria</a> de la <a href="http://unusedino.de/ec64/technical/aay/c64/basromma.htm">ROM de BASIC</a> y la <a href="http://unusedino.de/ec64/technical/aay/c64/krnromma.htm">ROM del KERNAL</a>.</p>
<h3 id="rutinas-principales">Rutinas principales</h3>
<p>El KERNAL tiene en la zona final de su memoria una tabla de saltos a las diferentes rutinas de servicio que incorpora. Por ello para cada rutina tenemos dos direcciones: la de la tabla y la dirección real entre paréntesis, siendo esta última donde realmente se encuentra el código de la rutina.</p>

<table>
<thead>
<tr>
<th align="center">Nombre</th>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>SCINIT</code></td>
<td align="center">$FF81 ($FF5B)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Inicializar VIC, asignar E/S por defecto (teclado/pantalla), borrar pantalla, configurar flag PAL/NTSC e interrupciones del <em>timer</em>.</td>
</tr>
<tr>
<td align="center"><code>IOINIT</code></td>
<td align="center">$FF84 ($FDA3)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Inicializar CIAs y volumen SID; configurar la memoria; inicializar e iniciar interrupciones del <em>timer</em>.</td>
</tr>
<tr>
<td align="center"><code>RAMTAS</code></td>
<td align="center">$FF87 ($FD50)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Limpiar bloques de memoria $0002-$0101 y $0200-$03FF; iniciar test de memoria y asignar las direcciones de inicio y final de la memoria de programas BASIC; establecer el buffer de pantalla en $0400 y el buffer de <em>datasette</em> en $033C.</td>
</tr>
<tr>
<td align="center"><code>RESTOR</code></td>
<td align="center">$FF8A ($FD15)</td>
<td>-</td>
<td>-</td>
<td align="center">-</td>
<td>Rellenar la tabla de vectores en $0314-$0333 con los valores por defecto.</td>
</tr>
<tr>
<td align="center"><code>VECTOR</code></td>
<td align="center">$FF8D ($FD1A)</td>
<td><strong>Carry:</strong> <strong>0</strong> = Escribir (TV=TU); <strong>1</strong> = Leer (TU=TV).<br><strong>X/Y:</strong> Puntero tabla de usuario.</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Lee o escribe los valores de la tabla de vectores en $0314-$0333.</td>
</tr>
<tr>
<td align="center"><code>SETMSG</code></td>
<td align="center">$FF90 ($FE18)</td>
<td><strong>A:</strong> Valor flag.</td>
<td>-</td>
<td align="center">-</td>
<td>Modifica el flag de mostrar errores del sistema ($009D).</td>
</tr>
<tr>
<td align="center"><code>LSTNSA</code></td>
<td align="center">$FF93 ($EDB9)</td>
<td><strong>A:</strong> Dirección secundaria.</td>
<td>-</td>
<td align="center">A</td>
<td>Envía un <em>LISTEN</em> a la dirección secundaria del puerto serie. (Debe llamarse <code>LISTEN</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>TALKSA</code></td>
<td align="center">$FF96 ($EDC7)</td>
<td><strong>A:</strong> Dirección secundaria.</td>
<td>-</td>
<td align="center">A</td>
<td>Envía un <em>TALK</em> a la dirección secundaria del puerto serie. (Debe llamarse <code>TALK</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>MEMBOT</code></td>
<td align="center">$FF99 ($FE25)</td>
<td><strong>Carry:</strong> <strong>0</strong> = Escribir; <strong>1</strong> = Leer.<br><strong>X/Y:</strong> Dirección (Carry = 0).</td>
<td><strong>X/Y:</strong> Dirección (Carry = 1).</td>
<td align="center">X, Y</td>
<td>Lee o escribe la dirección de inicio de la memoria de trabajo de BASIC.</td>
</tr>
<tr>
<td align="center"><code>MEMTOP</code></td>
<td align="center">$FF9C ($FE34)</td>
<td><strong>Carry:</strong> <strong>0</strong> = Escribir; <strong>1</strong> = Leer.<br><strong>X/Y:</strong> Dirección (Carry = 0).</td>
<td><strong>X/Y:</strong> Dirección (Carry = 1).</td>
<td align="center">X, Y</td>
<td>Lee o escribe la dirección de final de la memoria de trabajo de BASIC.</td>
</tr>
<tr>
<td align="center"><code>SCNKEY</code></td>
<td align="center">$FF9F ($EA87)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Consulta el teclado, pone en $00CB el código de matriz, en $028D el estado actual de las teclas <code>SHIFT</code> y en el buffer de teclado el código PETSCII.</td>
</tr>
<tr>
<td align="center"><code>SETTMO</code></td>
<td align="center">$FFA2 ($FE21)</td>
<td><strong>A:</strong> Valor de <em>timeout</em>.</td>
<td>-</td>
<td align="center">-</td>
<td>Configura el <em>timeout</em> del puerto serie.</td>
</tr>
<tr>
<td align="center"><code>IECIN</code></td>
<td align="center">$FFA5 ($EE13)</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A</td>
<td>Lee un byte del puerto serie. (Debe llamarse <code>TALK</code> y <code>TALKSA</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>IECOUT</code></td>
<td align="center">$FFA8 ($EDDD)</td>
<td><strong>A:</strong> Byte para escribir.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribe un byte en el puerto serie.  (Debe llamarse <code>LISTEN</code> y <code>LSTNSA</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>UNTALK</code></td>
<td align="center">$FFAB ($EDEF)</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>UNTALK</em> al puerto serie.</td>
</tr>
<tr>
<td align="center"><code>UNLSTN</code></td>
<td align="center">$FFAE ($EDFE)</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>UNLISTEN</em> al puerto serie.</td>
</tr>
<tr>
<td align="center"><code>LISTEN</code></td>
<td align="center">$FFB1 ($ED0C)</td>
<td><strong>A:</strong> Número de dispositivo.</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>LISTEN</em> al puerto serie.</td>
</tr>
<tr>
<td align="center"><code>TALK</code></td>
<td align="center">$FFB4 ($ED09)</td>
<td><strong>A:</strong> Número de dispositivo.</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>TALK</em> al puerto serie.</td>
</tr>
<tr>
<td align="center"><code>READST</code></td>
<td align="center">$FFB7 ($FE07)</td>
<td>-</td>
<td><strong>A:</strong> Estado actual del dispositivo.</td>
<td align="center">A</td>
<td>Obtiene el estado actual del dispositivo de E/S con el valor de la variable <code>STATUS</code>. (Para el RS-232, el estado es borrado.)</td>
</tr>
<tr>
<td align="center"><code>SETLFS</code></td>
<td align="center">$FFBA ($FE00)</td>
<td><strong>A:</strong> Número identificador.<br><strong>X:</strong> Número de dispositivo.<br><strong>Y:</strong> Modo o dirección secundaria.</td>
<td>-</td>
<td align="center">-</td>
<td>Configura los parámetros del fichero para trabajar.</td>
</tr>
<tr>
<td align="center"><code>SETNAM</code></td>
<td align="center">$FFBD ($FDF9)</td>
<td><strong>A:</strong> Tamaño de la cadena.<br><strong>X/Y:</strong> Puntero a la cadena.</td>
<td>-</td>
<td align="center">-</td>
<td>Configura el nombre del fichero para trabajar.</td>
</tr>
<tr>
<td align="center"><code>OPEN</code></td>
<td align="center">$FFC0 (($031A) = $F34A)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Abre un fichero. (Debe llamarse <code>SETLFS</code> y <code>SETNAM</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>CLOSE</code></td>
<td align="center">$FFC3 (($031C) = $F291)</td>
<td><strong>A:</strong> Número identificador.</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Cierra un fichero.</td>
</tr>
<tr>
<td align="center"><code>CHKIN</code></td>
<td align="center">$FFC6 (($031E) = $F20E)</td>
<td><strong>X:</strong> Número identificador.</td>
<td>-</td>
<td align="center">A, X</td>
<td>Define un fichero como la entrada por defecto. (Debe llamarse <code>OPEN</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>CHKOUT</code></td>
<td align="center">$FFC9 (($0320) = $F250)</td>
<td><strong>X:</strong> Número identificador.</td>
<td>-</td>
<td align="center">A, X</td>
<td>Define un fichero como la salida por defecto. (Debe llamarse <code>OPEN</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>CLRCHN</code></td>
<td align="center">$FFCC (($0322) = $F333)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Cierra los ficheros de E/S por defecto (para el puerto serie se envía <em>UNTALK</em> y/o <em>UNLISTEN</em>). Restaura la E/S por defecto al teclado y pantalla.</td>
</tr>
<tr>
<td align="center"><code>CHRIN</code></td>
<td align="center">$FFCF (($0324); $F157)</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A, Y</td>
<td>Lee un byte de la entrada por defecto, pero con el teclado lee una línea de la pantalla. (Si no es el teclado, debe llamarse <code>OPEN</code> y <code>CHKIN</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>CHROUT</code></td>
<td align="center">$FFD2 (($0326); $F1CA)</td>
<td><strong>A:</strong> Byte para escribir.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribe un byte en la salida por defecto. (Si no es la pantalla, debe llamarse <code>OPEN</code> y <code>CHKOUT</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>LOAD</code></td>
<td align="center">$FFD5 ($F49E)</td>
<td><strong>A:</strong> <strong>0</strong> = Cargar; <strong>1-255</strong> = Verificar.<br><strong>X/Y:</strong> Dirección de destino (si modo/DS = 0).</td>
<td><strong>Carry:</strong> <strong>0</strong> = Éxito; <strong>1</strong> = Errores.<br> <strong>A:</strong> Código error KERNAL (Carry = 1).<br><strong>X/Y:</strong> Dirección del último byte cargado/verificado (Carry = 0).</td>
<td align="center">A, X, Y</td>
<td>Carga o verifica un fichero. (Debe llamarse <code>SETLFS</code> y <code>SETNAM</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>SAVE</code></td>
<td align="center">$FFD8 ($F5DD)</td>
<td><strong>A:</strong> Dirección en la página cero del registro con la dirección inicial del bloque de memoria a guardar.<br><strong>X/Y:</strong> Dirección final del bloque de memoria más 1.</td>
<td><strong>Carry:</strong> <strong>0</strong> = Éxito; <strong>1</strong> = Errores.<br><strong>A:</strong> Código error KERNAL (Carry = 1).</td>
<td align="center">A, X, Y</td>
<td>Guarda un fichero. (Debe llamarse <code>SETLFS</code> y <code>SETNAM</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>SETTIM</code></td>
<td align="center">$FFDB ($F6E4)</td>
<td><strong>A/X/Y:</strong> Nuevo valor.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribe el valor de <code>TIME</code> ($00A0-$00A2).</td>
</tr>
<tr>
<td align="center"><code>RDTIM</code></td>
<td align="center">$FFDE ($F6DD)</td>
<td>-</td>
<td><strong>A/X/Y:</strong> Valor actual.</td>
<td align="center">A, X, Y</td>
<td>Lee el valor de <code>TIME</code> ($00A0-$00A2).</td>
</tr>
<tr>
<td align="center"><code>STOP</code></td>
<td align="center">$FFE1 (($0328) = $F6ED)</td>
<td>-</td>
<td><strong>Zero:</strong> <strong>0</strong> = Sin pulsar; <strong>1</strong> = Pulsada.<br><strong>Carry:</strong> <strong>1</strong> = Pulsada.</td>
<td align="center">A, X</td>
<td>Consultar el estado de la tecla <code>RUN/STOP</code> ($0091). Si está pulsada, invocar <code>CLRCHN</code> y limpiar el buffer de teclado.</td>
</tr>
<tr>
<td align="center"><code>GETIN</code></td>
<td align="center">$FFE4 (($032A) = $F13E)</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A, X, Y</td>
<td>Lee un byte de la entrada por defecto. (Si no es el teclado, debe llamarse <code>OPEN</code> y <code>CHKIN</code> previamente.)</td>
</tr>
<tr>
<td align="center"><code>CLALL</code></td>
<td align="center">$FFE7 (($032C) = $F32F)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Borra la tabla de ficheros e invoca a <code>CLRCHN</code>.</td>
</tr>
<tr>
<td align="center"><code>UDTIM</code></td>
<td align="center">$FFEA ($F69B)</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Actualiza la variable <code>TIME</code> ($00A0-$00A2) y el estado de la tecla <code>RUN/STOP</code> ($0091).</td>
</tr>
<tr>
<td align="center"><code>SCREEN</code></td>
<td align="center">$FFED ($E505)</td>
<td>-</td>
<td><strong>X:</strong> Columnas (40).<br><strong>Y:</strong> Filas (25).</td>
<td align="center">X, Y</td>
<td>Obtiene el número de filas y columnas de la pantalla.</td>
</tr>
<tr>
<td align="center"><code>PLOT</code></td>
<td align="center">$FFF0 ($E50A)</td>
<td><strong>Carry:</strong> <strong>0</strong> = Escribir; <strong>1</strong> = Leer.<br><strong>X:</strong> Columna (Carry = 0).<br><strong>Y:</strong> Fila (Carry = 0).</td>
<td><strong>X:</strong> Columna (Carry = 1).<br><strong>Y:</strong> Fila (Carry = 1).</td>
<td align="center">X, Y</td>
<td>Lee o escribe la posición del cursor.</td>
</tr>
<tr>
<td align="center"><code>IOBASE</code></td>
<td align="center">$FFF3 ($E500)</td>
<td>-</td>
<td><strong>X/Y:</strong> Dirección base CIA1 ($DC00).</td>
<td align="center">X, Y</td>
<td>Obtener la dirección base de la CIA1.</td>
</tr>
</tbody>
</table><p>Algunas de las rutinas del KERNAL son para trabajar con ficheros. Primero hay que configurar los parámetros del fichero con <code>SETLFS</code> y <code>SETNAM</code>. A continuación se sigue el siguiente esquema:</p>
<ol>
<li>Abrir el fichero con <code>OPEN</code>.</li>
<li>Usar el fichero como E/S por defecto con <code>CHKIN</code>/<code>CHKOUT</code>.</li>
<li>Operaciones de lectura y escritura con <code>GETIN</code>, <code>CHRIN</code> o <code>CHROUT</code>.</li>
<li>Restaurar la E/S por defecto con <code>CLRCHN</code></li>
<li>Cerrar el fichero con <code>CLOSE</code>.</li>
</ol>
<p>Con la rutina <code>READST</code> se podrá obtener en el registro A el estado del dispositivo del fichero con el que se está trabajando, para comprobar si ha habido errores o si se ha llegado al final de fichero, entre otras cosas.</p>
<h3 id="rutinas-de-la-pantalla">Rutinas de la pantalla</h3>
<p>Además de las rutinas <code>SCREEN</code> y <code>PLOT</code>, existen también:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$E4DA</td>
<td><strong>Y:</strong> Columna.</td>
<td>-</td>
<td align="center">A</td>
<td>Poner el color del cursor ($0286) en la posición apuntada por $00F3-$00F4 del buffer de color.</td>
</tr>
<tr>
<td align="center">$E518</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Inicializar VIC, asignar E/S por defecto (teclado/pantalla) y borrar pantalla.</td>
</tr>
<tr>
<td align="center">$E544</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Borrar pantalla.</td>
</tr>
<tr>
<td align="center">$E566</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Mueve el cursor al inicio de la pantalla (esquina superior izquierda).</td>
</tr>
<tr>
<td align="center">$E56C</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Actualiza, a la línea actual, el puntero en $00D1-$00D2 al buffer de pantalla y el puntero en $00F3-$00F4 al buffer de color, en base a la fila ($00D6) y columna ($00D3) del cursor.</td>
</tr>
<tr>
<td align="center">$E59A</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Inicializar VIC, asignar E/S por defecto (teclado/pantalla) y mover el cursor al inicio de la pantalla.</td>
</tr>
<tr>
<td align="center">$E5A0</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Inicializar VIC y asignar E/S por defecto (teclado/pantalla).</td>
</tr>
<tr>
<td align="center">$E5A8</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Inicializar VIC.</td>
</tr>
<tr>
<td align="center">$E632</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A</td>
<td>Lee un byte de la pantalla. Si la línea de entrada está vacía, aparece el cursor y se introduce una línea de datos.</td>
</tr>
<tr>
<td align="center">$E684</td>
<td>-</td>
<td>-</td>
<td align="center">-</td>
<td>Comprueba un código PETSCII. Si es $22 (<code>"</code>), se invierte el modo comillas en $00D4.</td>
</tr>
<tr>
<td align="center">$E6B6</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Recalcula los bytes altos de los punteros ($00D9-$00F1) a las líneas en el buffer de pantalla.</td>
</tr>
<tr>
<td align="center">$E716</td>
<td><strong>A:</strong> Byte para escribir.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribe un byte en pantalla.</td>
</tr>
<tr>
<td align="center">$E8CB</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Comprueba un código PETSCII. Si pertenece a un color, modifica el color del cursor ($0286).</td>
</tr>
<tr>
<td align="center">$E8EA</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Desplaza toda la pantalla hacia arriba.</td>
</tr>
<tr>
<td align="center">$E965</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Inserta una línea antes de la actual y desplaza las siguientes líneas de pantalla hacia abajo.</td>
</tr>
<tr>
<td align="center">$E9F0</td>
<td><strong>X:</strong> Fila.</td>
<td>-</td>
<td align="center">A</td>
<td>Modifica el puntero en $00D1-$00D2 a la línea actual en el buffer de pantalla, consultando el byte alto de la tabla de punteros en $00D9-$00F1.</td>
</tr>
<tr>
<td align="center">$E9FF</td>
<td><strong>X:</strong> Fila.</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Borra una línea de pantalla.</td>
</tr>
<tr>
<td align="center">$EA13</td>
<td><strong>A:</strong> Carácter<br><strong>X:</strong> Color.</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Escribe un carácter y color en pantalla, modificando el tiempo de parpadeo del cursor a 2.</td>
</tr>
<tr>
<td align="center">$EA24</td>
<td>-</td>
<td>-</td>
<td align="center">-</td>
<td>Modifica el puntero en $00F3-$00F4 a la línea actual en el buffer de color, consultando el puntero $00D1-$00D2 a la línea actual en el buffer de pantalla.</td>
</tr>
</tbody>
</table><h3 id="rutinas-del-teclado">Rutinas del teclado</h3>
<p>Además de las rutinas <code>SCNKEY</code> y <code>STOP</code>, existen también:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$E5B4</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A, X, Y</td>
<td>Lee un byte del buffer de teclado, el buffer de las teclas <code>SHIFT</code> y decrementa los punteros al buffer.</td>
</tr>
<tr>
<td align="center">$F142</td>
<td>-</td>
<td><strong>A:</strong> Byte leído (0 = Ninguna tecla pulsada).</td>
<td align="center">A, X, Y</td>
<td>Lee un byte del buffer de teclado, el buffer de las teclas <code>SHIFT</code> y decrementa los punteros al buffer.</td>
</tr>
<tr>
<td align="center">$F6BC</td>
<td>-</td>
<td>-</td>
<td align="center">A, X</td>
<td>Actualiza el estado de la tecla <code>RUN/STOP</code> ($0091).</td>
</tr>
</tbody>
</table><h3 id="rutinas-del-puerto-serie">Rutinas del puerto serie</h3>
<p>Además de las rutinas <code>LSTNSA</code>, <code>TALKSA</code>, <code>SETTMO</code>, <code>IECIN</code>, <code>IECOUT</code>, <code>UNTALK</code>, <code>UNLSTN</code>, <code>LISTEN</code> y <code>TALK</code>, existen también:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$ED40</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td><em>Flush</em> de la caché de salida ($0095) del puerto serie hacia el puerto serie.</td>
</tr>
<tr>
<td align="center">$EE85</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Modifica el <em>CLOCK OUT</em> a <em>high</em>.</td>
</tr>
<tr>
<td align="center">$EE8E</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Modifica el <em>CLOCK OUT</em> a <em>low</em>.</td>
</tr>
<tr>
<td align="center">$EE97</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Modifica el <em>DATA OUT</em> a <em>high</em>.</td>
</tr>
<tr>
<td align="center">$EEA0</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Modifica el <em>DATA OUT</em> a <em>low</em>.</td>
</tr>
<tr>
<td align="center">$EEA9</td>
<td>-</td>
<td><strong>Carry:</strong> <em>DATA IN</em><br><strong>Negative:</strong> <em>CLOCK IN</em><br><strong>A:</strong> <em>CLOCK IN</em> (Bit 7).</td>
<td align="center">A</td>
<td>Lee el CLOCK IN y el DATA IN.</td>
</tr>
<tr>
<td align="center">$F1AD</td>
<td>-</td>
<td><strong>A:</strong> Byte leído</td>
<td align="center">A</td>
<td>Lee un byte del puerto serie. Lee $0D (<code>RETURN</code>), si <code>STATUS &lt;&gt; 0</code>.</td>
</tr>
<tr>
<td align="center">$F237</td>
<td><strong>A:</strong> Número de dispositivo.</td>
<td>-</td>
<td align="center">A, X</td>
<td>Define el puerto serie como entrada por defecto. No se envíe <em>TALK</em> a la dirección secundaria si el bit 7 del modo de apertura vale 1.</td>
</tr>
<tr>
<td align="center">$F279</td>
<td><strong>A:</strong> Número de dispositivo.</td>
<td>-</td>
<td align="center">A, X</td>
<td>Define el puerto serie como salida por defecto. No se envíe <em>LISTEN</em> a la dirección secundaria si el bit 7 del modo de apertura vale <code>1</code>.</td>
</tr>
<tr>
<td align="center">$F3D5</td>
<td>-</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Abre un fichero en el puerto serie. No se envíe el nombre de fichero si el bit 7 del modo de apertura vale <code>1</code> o si el tamaño del nombre de fichero es <code>0</code>.</td>
</tr>
<tr>
<td align="center">$F528</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>UNTALK</em> y <em>CLOSE</em> al puerto serie.</td>
</tr>
<tr>
<td align="center">$F63F</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Enviar el comando <em>UNLISTEN</em> y <em>CLOSE</em> al puerto serie.</td>
</tr>
<tr>
<td align="center">$F642</td>
<td>-</td>
<td>-</td>
<td align="center">-</td>
<td>Cierra un fichero en el puerto serie. No se envíe <em>CLOSE</em> a la dirección secundaria si el bit 7 del modo de apertura vale <code>1</code>.</td>
</tr>
</tbody>
</table><h3 id="rutinas-del-datasette">Rutinas del <em>datasette</em></h3>
<p>Estas son las rutinas que existen para manejar el <em>datasette</em>:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$F179</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A, Y</td>
<td>Leer un byte del <em>datasette</em> (sólo ficheros de datos).</td>
</tr>
<tr>
<td align="center">$F1DD</td>
<td><strong>Carry = 1:</strong> Escribir byte; <strong>A:</strong> Byte para escribir; <strong>Carry = 0:</strong> Escribir EOF.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribir un byte en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F22A</td>
<td><strong>A = 1</strong></td>
<td>-</td>
<td align="center">A, X</td>
<td>Define el <em>datasette</em> como entrada por defecto.</td>
</tr>
<tr>
<td align="center">$F26F</td>
<td><strong>A = 1</strong></td>
<td>-</td>
<td align="center">A, X</td>
<td>Define el <em>datasette</em> como salida por defecto.</td>
</tr>
<tr>
<td align="center">$F2C8</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Cerrar un fichero en el <em>datasette</em> (sólo ficheros de datos). Primero escribe $00 y fin de fichero (EOF). (Previamente se debe meter en la pila el número identificador de fichero.)</td>
</tr>
<tr>
<td align="center">$F38B</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Abrir un fichero en el <em>datasette</em> (sólo ficheros de datos). Se lanza un <code>ILLEGAL DEVICE NUMBER</code> si el puntero al buffer del <em>datasette</em> ($00B2-$00B3) está por debajo de $0200.</td>
</tr>
<tr>
<td align="center">$F72C</td>
<td>-</td>
<td><strong>X:</strong> Tipo de cabecera; <strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>; <strong>Carry = 1 y Zero = 0:</strong> Interrumpido por alcanzarse el final de cinta (EOT).</td>
<td align="center">A, X, Y</td>
<td>Leer la cabecera en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F76A</td>
<td><strong>A:</strong> Tipo de cabecera.</td>
<td><strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, X, Y</td>
<td>Generar y escribir la cabecera en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F7D0</td>
<td>-</td>
<td><strong>Carry = 0:</strong> Puntero por debajo de $0200; <strong>X/Y:</strong> Puntero.</td>
<td align="center">X, Y</td>
<td>Obtener el puntero al buffer del <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F7EA</td>
<td>-</td>
<td><strong>X:</strong> Tipo de cabecera; <strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>; <strong>Carry = 1 y Zero = 0:</strong> Interrumpido por alcanzarse el final de cinta (EOT).</td>
<td align="center">A, X, Y</td>
<td>Buscar un fichero en el <em>datasette</em>. (Debe llamarse <code>SETLFS</code> y <code>SETNAM</code> previamente.)</td>
</tr>
<tr>
<td align="center">$F80D</td>
<td>-</td>
<td><strong>Zero = 1:</strong> Buffer lleno; <strong>Carry = 1 y Zero = 0:</strong> Desbordamiento del buffer.</td>
<td align="center">X, Y</td>
<td>Incrementar el puntero al buffer del <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F817</td>
<td>-</td>
<td><strong>Carry = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, Y</td>
<td>Esperar a que se pulse <em>PLAY</em> en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F82E</td>
<td>-</td>
<td><strong>Zero:</strong> <strong>0</strong> = Nada pulsado; <strong>1</strong> = <em>PLAY</em>, <em>RECORD</em>, <em>F.FWD</em> y/o <em>REW</em> pulsados.</td>
<td align="center">-</td>
<td>Detecta si se ha pulsado algún botón en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F838</td>
<td>-</td>
<td><strong>Carry = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, Y</td>
<td>Esperar a que se pulse <em>RECORD</em> en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F841</td>
<td>-</td>
<td><strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, X, Y</td>
<td>Lee un bloque del <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F84A</td>
<td>-</td>
<td><strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, X, Y</td>
<td>Lee un fichero de programa del <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F864</td>
<td>-</td>
<td><strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, X, Y</td>
<td>Escribe un bloque en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$F86B</td>
<td>-</td>
<td><strong>Carry = 1 y Zero = 1:</strong> Interrumpido por pulsarse <em>STOP</em>.</td>
<td align="center">A, X, Y</td>
<td>Escribe un fichero de programa en el <em>datasette</em>.</td>
</tr>
<tr>
<td align="center">$FC93</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Apaga el motor del <em>datasette</em>; cambia la pantalla hacia atrás; restaura la dirección de ejecución de la rutina de servicio de interrupciones desde $029F-$02A0.</td>
</tr>
<tr>
<td align="center">$FCCA</td>
<td>-</td>
<td>-</td>
<td align="center">A</td>
<td>Apaga el motor del <em>datasette</em>.</td>
</tr>
</tbody>
</table><h3 id="rutinas-del-rs-232">Rutinas del RS-232</h3>
<p>Estas son las rutinas que existen para manejar el RS-232:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Entradas</th>
<th>Salidas</th>
<th align="center">Usados</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$EF4A</td>
<td>-</td>
<td><strong>X:</strong> Número de bits de datos.</td>
<td align="center">A, X</td>
<td>Calcular el número de bits de datos, de acuerdo a $0293.</td>
</tr>
<tr>
<td align="center">$EFE1</td>
<td><strong>A = 2</strong></td>
<td>-</td>
<td align="center">A</td>
<td>Definir el RS-232 como salida por defecto.</td>
</tr>
<tr>
<td align="center">$F017</td>
<td>-</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Escribir un byte en el RS-232, desde la caché de salida del RS-232.</td>
</tr>
<tr>
<td align="center">$F04D</td>
<td><strong>A = 2</strong></td>
<td>-</td>
<td align="center">A</td>
<td>Definir el RS-232 como entrada por defecto.</td>
</tr>
<tr>
<td align="center">$F086</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">-</td>
<td>Leer un byte del RS-232.</td>
</tr>
<tr>
<td align="center">$F0A4</td>
<td>-</td>
<td>-</td>
<td align="center">-</td>
<td>Esperar al final de la transferencia y desactivar las interrupciones del RS-232. (Para que registros de chips comunes puedan utilizarse por el puerto serie o la E/S del <em>datasette</em>.)</td>
</tr>
<tr>
<td align="center">$F14E</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A</td>
<td>Leer un byte del RS-232.</td>
</tr>
<tr>
<td align="center">$F1B8</td>
<td>-</td>
<td><strong>A:</strong> Byte leído.</td>
<td align="center">A</td>
<td>Leer un byte del RS-232; reintentar ante un byte $00.</td>
</tr>
<tr>
<td align="center">$F1DD</td>
<td><strong>Carry = 0</strong>; <strong>A:</strong> Byte para escribir.</td>
<td>-</td>
<td align="center">-</td>
<td>Escribir un byte en el RS-232.</td>
</tr>
<tr>
<td align="center">$F2AF</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Cerrar un fichero en el RS-232; liberar, si existe, los buffers de E/S del RS-232.</td>
</tr>
<tr>
<td align="center">$F409</td>
<td>-</td>
<td>-</td>
<td align="center">A, X, Y</td>
<td>Abrir un fichero en el RS-232; ubicar, si no existen, los buffers de E/S del RS-232.</td>
</tr>
<tr>
<td align="center">$F483</td>
<td>-</td>
<td>-</td>
<td align="center">A, Y</td>
<td>Inicializar la CIA2 para abrir/cerrar el RS-232.</td>
</tr>
</tbody>
</table><h3 id="rutinas-basic-de-conversión">Rutinas BASIC de conversión</h3>
<p>El interprete de BASIC tiene implementada su propia representación de <a href="https://www.c64-wiki.com/wiki/Floating_point_arithmetic">números de coma flotante</a> y tiene algunas rutinas para trabajar con ellos:</p>

<table>
<thead>
<tr>
<th align="center">Dirección</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$A96B</td>
<td>Lee el número de línea del programa BASIC y lo escribe en $0014-$0015. Si el primer carácter no es un dígito, el resultado será <code>0</code>. Si el resultado es igual o superior a <code>64000</code>, se lanzará un <code>SYNTAX ERROR</code>. (NOTA: Necesita que <code>CHRGET</code> haya sido invocado previamente para consultar $0073.)</td>
</tr>
<tr>
<td align="center">$A9C4</td>
<td>Convierte el FAC a entero y lo escribe en la variable apuntada por $0049-$004A.</td>
</tr>
<tr>
<td align="center">$A9DA</td>
<td>Asigna un valor a una variable de cadena, incluida <code>TI$</code>. (NOTA: Consultar también la rutina $AA2C.)</td>
</tr>
<tr>
<td align="center">$A9E0</td>
<td>Asigna un valor a <code>TI$</code> y cambia el TOD. Lee el valor de la cadena apuntada por $0064-$0065.</td>
</tr>
<tr>
<td align="center">$AA2C</td>
<td>Asigna un valor a una variable de cadena, excluyendo <code>TI$</code>. Lee el valor de la cadena apuntada por $0064-$0065 y escribe el valor en la cadena apuntada por $0049-$004A.</td>
</tr>
<tr>
<td align="center">$AD8A</td>
<td>Lee el valor de una expresión numérica del programa BASIC y lo escribe en el FAC.</td>
</tr>
<tr>
<td align="center">$AD8D</td>
<td>Comprueba si una expresión es numérica, si no lo es lanza un <code>TYPE MISMATCH</code>.</td>
</tr>
<tr>
<td align="center">$AD8F</td>
<td>Comprueba si una expresión es una cadena, si no lo es lanza un <code>TYPE MISMATCH</code>.</td>
</tr>
<tr>
<td align="center">$AD9E</td>
<td>Lee el valor de una expresión del programa BASIC. Para expresiones numéricas se escribe el valor en el FAC; para expresiones de cadena, el tamaño se escribe en $0061 y la dirección del valor en $0062-$0063.</td>
</tr>
<tr>
<td align="center">$AEF1</td>
<td>Lee el valor de una expresión entre paréntesis del programa BASIC. (NOTA: Consultar también la rutina $AD9E.)</td>
</tr>
<tr>
<td align="center">$AF28</td>
<td>Lee el nombre de una variable del programa BASIC y carga su valor. La dirección de la variable se escribe en $0064-$0065; para variables numéricas, se escribe su valor en el FAC, en formato de coma flotante; para <code>ST</code>, <code>TI</code> y <code>TI$</code>, toma el valor de sus direcciones de memoria del sistema; para variables que no existen devuelve el valor vacío (<code>0</code> para números y <code>""</code> para cadenas).</td>
</tr>
<tr>
<td align="center">$AF48</td>
<td>Calcular el valor de <code>TI$</code>.</td>
</tr>
<tr>
<td align="center">$AF61</td>
<td>Escribe en el FAC, en formato de coma flotante, el valor de la variable entera apuntada por $0064-$0065.</td>
</tr>
<tr>
<td align="center">$AF6E</td>
<td>Escribe en el FAC el valor de una variable flotante, incluidas <code>ST</code> y <code>TI</code>. (NOTA: Consultar también la rutina $AFA0.)</td>
</tr>
<tr>
<td align="center">$AF7B</td>
<td>Calcular el valor de <code>TI</code> en el FAC.</td>
</tr>
<tr>
<td align="center">$AF9A</td>
<td>Calcular el valor de <code>ST</code> en el FAC.</td>
</tr>
<tr>
<td align="center">$AFA0</td>
<td>Escribe en el FAC el valor de la variable flotante apuntada por $0064-$0065, excluyendo <code>ST</code> y <code>TI</code>.</td>
</tr>
<tr>
<td align="center">$B08B</td>
<td>Lee el nombre de una variable del programa BASIC y la busca. Si la encuentra, la dirección de la variable es escrita en $005F-$0060, la dirección del valor es escrita en $0047-$0048; si no la encuentra, y el invocador es $AF28, devuelve el valor vacío (<code>0</code> para números y <code>""</code> para cadenas), sino crea una nueva variable con el valor vacío.</td>
</tr>
<tr>
<td align="center">$B128</td>
<td>Crea una nueva variable con el valor vacío (<code>0</code> para números y <code>""</code> para cadenas). El nombre de la variable está en $0045-$0046.</td>
</tr>
<tr>
<td align="center">$B1B2</td>
<td>Lee un valor entero del programa BASIC y lo escribe en $0064-$0065. Si el valor no está dentro del rango [-32768, 32767], se lanza un <code>ILLEGAL QUANTITY</code>.</td>
</tr>
<tr>
<td align="center">$B391</td>
<td>Escribe el entero en A/Y en el FAC en formato de coma flotante.</td>
</tr>
<tr>
<td align="center">$B3A2</td>
<td>Escribe el entero en Y en el FAC en formato de coma flotante.</td>
</tr>
<tr>
<td align="center">$B794</td>
<td>Escribe el entero en A en el FAC en formato de coma flotante.</td>
</tr>
<tr>
<td align="center">$B79B</td>
<td>Lee un BYTE del programa BASIC y lo escribe en X. Si el valor no está dentro del rango [0, 255], se lanza un <code>ILLEGAL QUANTITY</code>.</td>
</tr>
<tr>
<td align="center">$B7EB</td>
<td>Lee un WORD y un BYTE, separados por una coma, del programa BASIC y lo escribe en $0014-$0015 y X.</td>
</tr>
<tr>
<td align="center">$B7F7</td>
<td>Convierte el FAC en un valor entero sin signo y lo escribe en $0014-$0015. Si el valor no está dentro del rango [0, 65535], se lanza un <code>ILLEGAL QUANTITY</code>.</td>
</tr>
<tr>
<td align="center">$B849</td>
<td><code>FAC = FAC + 0.5</code></td>
</tr>
<tr>
<td align="center">$B850</td>
<td><code>FAC = (valor flotante apuntado por A/Y) – FAC</code></td>
</tr>
<tr>
<td align="center">$B853</td>
<td><code>FAC = ARG – FAC</code></td>
</tr>
<tr>
<td align="center">$B867</td>
<td><code>FAC = (valor flotante apuntado por A/Y) + FAC</code></td>
</tr>
<tr>
<td align="center">$B86A</td>
<td><code>FAC = ARG + FAC</code> (Requiere un <code>LDA $61</code> previo.)</td>
</tr>
<tr>
<td align="center">$B947</td>
<td><code>FAC = ComplementoA2(FAC)</code>, invierte la mantisa del FAC.</td>
</tr>
<tr>
<td align="center">$BA28</td>
<td><code>FAC := (valor flotante apuntado por A/Y) * FAC</code></td>
</tr>
<tr>
<td align="center">$BA2B</td>
<td><code>FAC = ARG * FAC</code> (Requiere un <code>LDA $61</code> previo.)</td>
</tr>
<tr>
<td align="center">$BA8C</td>
<td><code>ARG = (valor flotante apuntado por A/Y)</code></td>
</tr>
<tr>
<td align="center">$BAE2</td>
<td><code>FAC = FAC * 10</code></td>
</tr>
<tr>
<td align="center">$BAFE</td>
<td><code>FAC = FAC / 10</code></td>
</tr>
<tr>
<td align="center">$BB0F</td>
<td><code>FAC = (valor flotante apuntado por A/Y) / FAC</code></td>
</tr>
<tr>
<td align="center">$BB12</td>
<td><code>FAC = ARG / FAC</code>; si el FAC es <code>0</code>, lanzar un <code>DIVISION BY ZERO</code>. (Requiere un <code>LDA $61</code> previo.)</td>
</tr>
<tr>
<td align="center">$BBA2</td>
<td><code>FAC = (valor flotante apuntado por A/Y)</code></td>
</tr>
<tr>
<td align="center">$BBC7</td>
<td><code>Registro Aritmético 4 = FAC</code></td>
</tr>
<tr>
<td align="center">$BBCA</td>
<td><code>Registro Aritmético 3 = FAC</code></td>
</tr>
<tr>
<td align="center">$BBD0</td>
<td>Escribe el FAC en la variable flotante apuntada por $0049-$004A.</td>
</tr>
<tr>
<td align="center">$BBD4</td>
<td>Escribe el FAC en la variable flotante apuntada por X/Y.</td>
</tr>
<tr>
<td align="center">$BBFC</td>
<td><code>FAC = ARG</code></td>
</tr>
<tr>
<td align="center">$BC0C</td>
<td><code>ARG = Entero(FAC)</code></td>
</tr>
<tr>
<td align="center">$BC0F</td>
<td><code>ARG = FAC</code></td>
</tr>
<tr>
<td align="center">$BC1B</td>
<td><code>FAC = Entero(FAC)</code></td>
</tr>
<tr>
<td align="center">$BC2B</td>
<td>Escribe signo del FAC en A: 1 = Positivo; 0 = Cero; 255 = Negativo.</td>
</tr>
<tr>
<td align="center">$BC5B</td>
<td>Compara el valor flotante apuntado por A/Y con el FAC y lo escribe en A: 1 = FAC menor; 0 = Igual; 255 = FAC mayor.</td>
</tr>
<tr>
<td align="center">$BC9B</td>
<td>Convierte el FAC a entero y lo escribe en $0064-$0065.</td>
</tr>
<tr>
<td align="center">$BCF3</td>
<td>Lee un valor flotante del programa BASIC y lo escribe en el FAC.</td>
</tr>
<tr>
<td align="center">$BDCD</td>
<td>Escribe en pantalla el entero en A/X en formato de coma flotante.</td>
</tr>
<tr>
<td align="center">$BDDD</td>
<td>Convierte el FAC a una cadena terminada en <code>0</code> almacenada en $0100-$010A.</td>
</tr>
<tr>
<td align="center">$BF71</td>
<td><code>FAC = RaízCuadrada(FAC)</code></td>
</tr>
<tr>
<td align="center">$BF78</td>
<td><code>FAC = ARG ^ (valor flotante apuntado por A/Y)</code></td>
</tr>
<tr>
<td align="center">$BF7B</td>
<td><code>FAC = ARG ^ FAC</code></td>
</tr>
<tr>
<td align="center">$BFB4</td>
<td><code>FAC := –FAC</code></td>
</tr>
</tbody>
</table>
    </div>
  </div>
</body>

</html>
